{"version":3,"sources":["Action.js","DeleteAction.js","GroupAction.js","PlaceAction.js","PlaceWireAction.js","SelectAction.js","SplitWireAction.js","TransformAction.js","Camera.js","Clipboard.js","Context.js","CopyUtils.js","HistoryManager.js","Bezier.js","Matrix.js","Transform.js","Vector.js","Module.js","Popup.js","Propogation.js","UIDManager.js","Utils.js","ContextMenu.js","CopyModule.js","CutModule.js","PasteModule.js","RedoModule.js","SelectAllModule.js","UndoModule.js","Exporter.js","Importer.js","Input.js","ItemNavController.js","PlaceItemController.js","SelectionBox.js","BusButtonModule.js","ColorPickerModule.js","ICButtonModule.js","InputCountModule.js","PositionXModule.js","PositionYModule.js","SelectionPopup.js","TitleModule.js","SideNavController.js","Tool.js","ItemTool.js","SelectionTool.js","WiringTool.js","TransformController.js","WireController.js","IOObject.js","SRFlipFlop.js","Gate.js","ANDGate.js","BUFGate.js","ORGate.js","XORGate.js","Button.js","Clock.js","ConstantHigh.js","ConstantLow.js","Keyboard.js","Switch.js","Decoder.js","Demultiplexer.js","Encoder.js","IC.js","ICData.js","Label.js","Multiplexer.js","LED.js","SevenSegmentDisplay.js","IOPort.js","IPort.js","OPort.js","Wire.js","WirePort.js","CircuitDesigner.js","ICDesigner.js","Main.js","Renderer.js"],"names":["Action","context","getCurrentContext","saved","DeleteAction","obj","oldinput","oldconnection","add","undefined","connect","remove","GroupAction","actions","action","push","i","length","undo","redo","PlaceAction","addObject","PlaceWireAction","wire","input","connection","disconnect","SelectAction","flip","reselect","deselect","selectionTool","select","SplitWireAction","wireport","newwire","TransformAction","t0","t1","setTransform","updatePopup","selected","recalculateMidpoint","popup","onMove","Camera","designer","startPos","startZoom","canvas","renderer","pos","V","zoom","center","transform","Transform","dirty","width","height","scale","mat","Matrix2x3","translate","inv","inverse","p1","getWorldPos","p2","setPos","setSize","sub","dx","dy","x","y","s","transformContains","getTransform","updateMatrix","v","getInverseMatrix","mul","getMatrix","Clipboard","document","addEventListener","copy","e","cut","paste","selections","things","getAllThingsBetween","objects","wires","Wire","ctx","getObjects","getWires","data","Exporter","write","clipboardData","setData","preventDefault","RemoveObjects","console","log","group","Importer","load","getData","getPos","addAction","deselectAll","render","clipboard","Context","uidmanager","UIDManager","reset","sender","receiver","signal","propogate","o","addWire","giveUIDTo","arr","w","history","cursor","setCursor","index","getIndexOf","splice","redistribute","camera","CopyArray","getIndexOfWire","getIndexOfObject","uid","findObjectByUID","findWireByUID","find","currentContext","copyGroup","copies","WirePort","wireCopies","j","outputs","connections","k","ww","findIPort","port","lastConnection","isOn","inputs","activate","target","iports","HistoryManager","undoStack","redoStack","code","Input","getModifierKeyDown","Y_KEY","Z_KEY","getShiftKeyDown","pop","update","BezierCurve","c1","c2","boundingBox","getCamera","min","max","end1","end2","a","b","c","discriminant1","Math","sqrt","clamp","t2","getY","discriminant2","t3","t4","getX","style","size","parent","getScreenPos","curve","t","it","getDX","getDY","m","mx","my","dbx","dby","getDDX","getDDY","minDist","tt","WIRE_DIST_ITERATIONS","dist","getDist","findRoots","WIRE_NEWTON_ITERATIONS","getDistDenominator","getDistDenominatorDerivative","getDist2","WIRE_DIST_THRESHOLD2","getDistNumerator","getDistNumeratorDerivative","updateBoundingBox","node","bezierNode","createChildNode","createTextElement","getFloatValue","getChildNode","other","identity","zero","result","theta","cos","sin","m11","m12","m21","m22","Array","det","toFixed","angle","corners","localCorners","dirtySize","dirtyCorners","matrix","rotate","mult","radius","getLocalCorners","toWorldSpace","setAngle","xx","yy","p","h","updateSize","updateCorners","m1","m2","print","trans","Vector","set","len","invLen","dot","len2","Module","divName","divTextName","div","getElementById","divtext","oninput","onChange","onclick","onClick","onfocus","onFocus","onblur","onBlur","blur","val","value","placeholder","display","disabled","focused","Popup","onKeyDown","keyCode","onKeyUp","position","modules","hide","onShow","hidden","visibility","focus","left","top","window","innerWidth","clientWidth","ItemNavController","isOpen","ITEMNAV_WIDTH","innerHeight","clientHeight","header","PROPOGATION_TIME","updateRequests","Propogation","setTimeout","counter","concat","DEFAULT_SIZE","GRID_SIZE","DEFAULT_FILL_COLOR","DEFAULT_BORDER_COLOR","DEFAULT_ON_COLOR","IO_PORT_LENGTH","IO_PORT_RADIUS","IO_PORT_BORDER_WIDTH","IO_PORT_LINE_WIDTH","WIRE_DIST_THRESHOLD","WIRE_SNAP_THRESHOLD","ROTATION_CIRCLE_RADIUS","ROTATION_CIRCLE_THICKNESS","ROTATION_CIRCLE_THRESHOLD","ROTATION_CIRCLE_R1","pow","ROTATION_CIRCLE_R2","SIDENAV_WIDTH","LEFT_MOUSE_BUTTON","RIGHT_MOUSE_BUTTON","OPTION_KEY","SHIFT_KEY","BACKSPACE_KEY","DELETE_KEY","ENTER_KEY","ESC_KEY","A_KEY","C_KEY","V_KEY","X_KEY","CONTROL_KEY","COMMAND_KEY","rectContains","tr","bl","toLocalSpace","circleContains","A","B","abs","getAngle","aPos","aSize","getSize","bPos","bSize","r1","getRadius","r2","sr","dpos","bworld","getCorners","minA","maxA","minB","maxB","normals","normal","Infinity","s2","getNearestPointOnRect","wiresAndPorts","IOObject","allTheThings","iport","OPort","findByUID","oport","IPort","getAllWires","doAction","findIC","id","ics","icuid","createTransformAction","origin","equals","getNearestT","iterations","f","df","dv","separateGroup","components","object","Switch","Button","Clock","LED","getBrowser","navigator","ua","userAgent","tem","M","match","test","exec","name","version","appName","appVersion","ContextMenu","CutModule","CopyModule","PasteModule","SelectAllModule","UndoModule","RedoModule","getRawMousePos","setDisabled","execCommand","selectAll","projectNameInput","ROOT","saveFile","projectName","filename","file","Blob","type","msSaveOrOpenBlob","createElement","url","URL","createObjectURL","href","download","body","appendChild","click","removeChild","revokeObjectURL","root","DOMParser","parseFromString","projectNode","icNode","writeICs","writeGroup","xml","XMLSerializer","serializeToString","objectsNode","wiresNode","writeTo","ICData","ICs","ic","ICNode","iportNode","oportNode","oports","componentsNode","tag","child","text","createTextNode","fileInput","types","openFile","open","confirm","reader","FileReader","onload","readAsText","files","documentElement","nodeName","project","icsNode","loadICs","loadGroup","addObjects","addWires","redistributeUIDs","nodes","getChildrenByTagName","getXMLName","wiresArr","loadConnections","icNodes","getIntValue","create","childNodes","children","getBooleanValue","def","nodeValue","parseInt","parseFloat","getStringValue","rawMousePos","mousePos","prevMousePos","worldMousePos","mouseDown","mouseDownPos","mouseListeners","z","shiftKeyDown","modifierKeyDown","optionKeyDown","isDragging","startTapTime","activeElement","Keyboard","getHistoryManager","CurrentTool","onDoubleClick","onWheel","delta","deltaY","factor","zoomBy","newMousePos","onMouseDown","getRenderer","rect","getBoundingClientRect","Date","now","clientX","clientY","button","shouldRender","contextmenu","listener","onMouseMove","dPos","onMouseUp","registerContext","PlaceItemController","drag","show","addMouseListener","l","getWorldMousePos","getOptionKeyDown","getIsDragging","tab","container","marginLeft","getTabOffset","borderColor","backgroundColor","fontSize","innerHTML","close","toggle","offsetWidth","place","item","not","itemTool","onDragEnd","event","srcElement","parentElement","SelectionBox","pos1","pos2","getSelections","selectionBoxTransform","output","somethingHappened","isActive","contains","sContains","oPortContains","iPortContains","draw","save","globalAlpha","restore","BusButtonModule","setVisibility","createBus","maxDist","maxDistIndex","maxMinDistIndex","opos","minDistIndex","straight","ColorPickerModule","allLEDs","allSame","color","setValue","getValue","ICButtonModule","count","icdesigner","InputCountModule","maxMinValue","minMaxValue","maxInputs","noChange","getInputAmount","getMinInputFieldCount","getMaxInputFieldCount","setPlaceholder","setInputAmount","Number","PositionXModule","PositionYModule","SelectionPopup","TitleModule","midpoint","getName","setName","SideNavController","tab2","otherContent","overlay","opacity","getWidth","Tool","deactivate","ItemTool","SelectionTool","isPressable","press","release","deselectAction","selectAction","combined","sendToFront","error","indexOf","r","br","TransformController","circle","WiringTool","clickOPort","removeWire","success","ii","wiringTool","pressedObj","isRotating","dragPos","dragObjects","startAngle","prevAngle","realAngles","rotateObjects","startTransforms","shift","newPos","floor","dAngle","atan2","newAngle","PI","setRotationAbout","startDrag","startRotation","objs","d","fillStyle","strokeStyle","lineWidth","beginPath","moveTo","da","arc","fill","closePath","WireController","pressedPort","pressedWire","wireSplitPoint","split","img","maxOutputs","selectionBoxWidth","selectionBoxHeight","cullTransform","getDisplayName","setOutputAmount","updatePosition","onTransformChange","setScale","getScale","updateCullTransform","on","transformCtx","localSpace","getCol","getBorderColor","image","getImageTint","setCamera","rotateAbout","constructor","objNode","SRFlipFlop","clock","Gate","ratio","_not","gateNode","inputCount","ANDGate","images","l1","l2","line","BUFGate","ORGate","quadCurveXAt","amt","quadCurve","XORGate","frequency","tick","ConstantHigh","ConstantLow","setOrigin","setTarget","dir","codeMap","num","codeCount","addKey","switchNode","Decoder","Demultiplexer","selectLines","p3","p4","shape","Encoder","indx","IC","setup","getOutputAmount","inputObjects","outputObjects","setWidth","setHeight","getHeight","align","padding","getTextWidth","normalize","getUID","longestName","recalculatePorts","inp","targ","orig","v1","v2","out","separate","Label","Multiplexer","connectorWidth","lineColor","LEDNode","SevenSegmentDisplay","segmentWidth","segmentHeight","getIndex","getArray","sw","sh","segmentPositions","segmentSizes","segmentImages","segmentOnImages","IOPort","prevParentLength","setParent","distanceTo","pos0","lineCol","circleFillCol","circleBorderCol","n","toLowerCase","replace","ioPortNode","originx","originy","targetx","targety","prevConnection","getODir","getDir","getBoundingBox","wireNode","inputNode","connectionNode","bezier","sourceUID","sourceIndx","source","targetUID","targetIndx","_input","hasSetTransform","snap","CircuitDesigner","vw","vh","Renderer","propogationQueue","resize","tempQueue","send","inScene","clear","step","cpos","cpx","cpy","setStyles","_line","stroke","cull","getCullBox","ICDesigner","dragObj","dragEdge","confirmButton","cancelButton","setContext","getDesigner","transform1","transform2","browser","onbeforeunload","dialogText","returnValue","start","loadImage","onFinishLoading","renderQueue","requestAnimationFrame","actualRender","imgs","imageNames","onFinish","Image","src","tintCanvas","getContext","tintContext","clearRect","borderStyle","borderSize","alpha","tint","drawImage","tintImage","fillRect","globalCompositeOperation","txt","textAlign","font","textBaseline","fillText","measureText","x1","y1","x2","y2","lineTo","cx1","cy1","cx2","cy2","bezierCurveTo","cx","cy","quadraticCurveTo","points"],"mappings":"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","file":"combined-min.js","sourcesContent":["class Action {\r\n    constructor() {\r\n        this.context = getCurrentContext();\r\n        // Anytime an action is performed, user should need to save\r\n        saved = false;\r\n    }\r\n    undo() {\r\n    }\r\n    redo() {\r\n    }\r\n}\r\n","class DeleteAction extends Action {\r\n    constructor(obj, oldinput, oldconnection) {\r\n        super();\r\n        this.obj = obj;\r\n        this.oldinput = oldinput;\r\n        this.oldconnection = oldconnection;\r\n    }\r\n    undo() {\r\n        this.context.add(this.obj);\r\n        if (this.oldinput != undefined)\r\n            this.oldinput.connect(this.obj);\r\n        if (this.oldconnection != undefined)\r\n            this.obj.connect(this.oldconnection);\r\n    }\r\n    redo() {\r\n        this.obj.remove();\r\n    }\r\n}\r\n","class GroupAction extends Action {\r\n    constructor() {\r\n        super();\r\n        this.actions = [];\r\n    }\r\n    add(action) {\r\n        this.actions.push(action);\r\n    }\r\n    undo() {\r\n        for (var i = this.actions.length-1; i >= 0; i--)\r\n            this.actions[i].undo();\r\n    }\r\n    redo() {\r\n        for (var i = 0; i < this.actions.length; i++)\r\n            this.actions[i].redo();\r\n    }\r\n}\r\n","class PlaceAction extends Action {\r\n    constructor(obj) {\r\n        super();\r\n        this.obj = obj;\r\n    }\r\n    undo() {\r\n        this.context.remove(this.obj);\r\n    }\r\n    redo() {\r\n        this.context.addObject(this.obj);\r\n    }\r\n}\r\n","class PlaceWireAction extends Action {\r\n    constructor(wire) {\r\n        super();\r\n        this.wire = wire;\r\n        this.input = this.wire.input;\r\n        this.connection = this.wire.connection;\r\n    }\r\n    undo() {\r\n        this.context.remove(this.wire);\r\n        this.wire.disconnect();\r\n        this.wire.input.disconnect(this.wire);\r\n    }\r\n    redo() {\r\n        this.context.add(this.wire);\r\n        this.wire.connect(this.connection);\r\n        this.input.connect(this.wire);\r\n    }\r\n}\r\n","class SelectAction extends Action {\r\n    constructor(obj, flip) {\r\n        super();\r\n        this.obj = obj;\r\n        this.flip = flip;\r\n    }\r\n    undo() {\r\n        if (this.flip)\r\n            this.reselect();\r\n        else\r\n            this.deselect();\r\n    }\r\n    redo() {\r\n        if (this.flip)\r\n            this.deselect();\r\n        else\r\n            this.reselect();\r\n    }\r\n    reselect() {\r\n        selectionTool.select([this.obj]);\r\n    }\r\n    deselect() {\r\n        selectionTool.deselect([this.obj]);\r\n    }\r\n}\r\n","class SplitWireAction extends Action {\r\n    constructor(wire) {\r\n        super();\r\n        this.wireport = wire.connection;\r\n        this.wire = wire;\r\n        this.newwire = this.wireport.connection;\r\n        this.connection = this.newwire.connection;\r\n    }\r\n    undo() {\r\n        this.context.remove(this.wireport);\r\n        this.context.remove(this.newwire);\r\n        \r\n        this.wire.disconnect();\r\n        this.newwire.disconnect();\r\n        \r\n        this.wire.connect(this.connection);\r\n    }\r\n    redo() {\r\n        this.context.add(this.wireport);\r\n        this.context.add(this.newwire);\r\n        \r\n        this.wire.disconnect();\r\n        \r\n        this.wire.connect(this.wireport);\r\n        this.newwire.connect(this.connection);\r\n    }\r\n}\r\n","class TransformAction extends Action {\r\n    constructor(obj, t0, t1) {\r\n        super();\r\n        this.obj = obj;\r\n        this.t0 = t0;\r\n        this.t1 = t1;\r\n    }\r\n    undo() {\r\n        this.obj.setTransform(this.t0);\r\n        this.updatePopup();\r\n    }\r\n    redo() {\r\n        this.obj.setTransform(this.t1);\r\n        this.updatePopup();\r\n    }\r\n    updatePopup() {\r\n        if (this.obj.selected) {\r\n            selectionTool.recalculateMidpoint();\r\n            popup.onMove();\r\n        }\r\n    }\r\n}\r\n","class Camera {\r\n    constructor(designer, startPos, startZoom) {\r\n        this.canvas = designer.renderer.canvas;\r\n        this.pos = (startPos ? startPos : V(0, 0));\r\n        this.zoom = (startZoom ? startZoom : 1);\r\n        this.center = V(0,0);\r\n        this.transform = new Transform(V(0,0), V(0,0), 0, this);\r\n        this.dirty = true;\r\n    }\r\n    resize() {\r\n        this.center = V(this.canvas.width, this.canvas.height).scale(0.5);\r\n    }\r\n    updateMatrix() {\r\n        if (!this.dirty)\r\n            return;\r\n        this.dirty = false;\r\n\r\n        this.mat = new Matrix2x3();\r\n        this.mat.translate(this.pos);\r\n        this.mat.scale(V(this.zoom, this.zoom));\r\n        this.inv = this.mat.inverse();\r\n\r\n        var p1 = this.getWorldPos(V(0, 0));\r\n        var p2 = this.getWorldPos(V(this.canvas.width, this.canvas.height));\r\n        this.transform.setPos(p2.add(p1).scale(0.5));\r\n        this.transform.setSize(p2.sub(p1));\r\n    }\r\n    translate(dx, dy) {\r\n        this.dirty = true;\r\n        this.pos.x += dx;\r\n        this.pos.y += dy;\r\n    }\r\n    zoomBy(s) {\r\n        this.dirty = true;\r\n        this.zoom *= s;\r\n    }\r\n    cull(transform) {\r\n        // getCurrentContext().getRenderer().save();\r\n        // transform.transformCtx(getCurrentContext().getRenderer().context);\r\n        // getCurrentContext().getRenderer().rect(0, 0, transform.size.x, transform.size.y, '#ff00ff');\r\n        // getCurrentContext().getRenderer().restore();\r\n\r\n        return (transformContains(transform, this.getTransform()));\r\n    }\r\n    getTransform() {\r\n        this.updateMatrix();\r\n        return this.transform;\r\n    }\r\n    getMatrix() {\r\n        this.updateMatrix();\r\n        return this.mat;\r\n    }\r\n    getInverseMatrix() {\r\n        this.updateMatrix();\r\n        return this.inv;\r\n    }\r\n    getScreenPos(v) {\r\n        return this.getInverseMatrix().mul(v).add(this.center);\r\n    }\r\n    getWorldPos(v) {\r\n        return this.getMatrix().mul(v.sub(this.center));\r\n    }\r\n}\r\n","class Clipboard {\r\n    constructor() {\r\n        document.addEventListener('copy', e => {this.copy(e)}, false);\r\n        document.addEventListener('cut', e => {this.cut(e)}, false);\r\n        document.addEventListener('paste', e => {this.paste(e)}, false);\r\n    }\r\n    copy(e) {\r\n        var selections = selectionTool.selections;\r\n        var things = getAllThingsBetween(selections);\r\n        var objects = [];\r\n        var wires = [];\r\n        for (var i = 0; i < things.length; i++) {\r\n            if (things[i] instanceof Wire)\r\n                wires.push(things[i]);\r\n            else\r\n                objects.push(things[i]);\r\n        }\r\n        var ctx = {getObjects: function() {return objects;}, getWires: function() {return wires;}};\r\n        var data = Exporter.write(ctx);\r\n        e.clipboardData.setData(\"text/plain\", data);\r\n        e.preventDefault();\r\n    }\r\n    cut(e) {\r\n        this.copy(e);\r\n        RemoveObjects(getCurrentContext(), selectionTool.selections, true);\r\n        e.preventDefault();\r\n    }\r\n    paste(e) {\r\n        console.log(\"ASd\");\r\n        var group = Importer.load(e.clipboardData.getData(\"text/plain\"), getCurrentContext());\r\n        var objects = group.objects;\r\n        var wires = group.wires;\r\n\r\n        var action = new GroupAction();\r\n\r\n        for (var i = 0; i < objects.length; i++) {\r\n            objects[i].setPos(objects[i].getPos().add(V(5, 5)));\r\n            action.add(new PlaceAction(objects[i]));\r\n        }\r\n\r\n        getCurrentContext().addAction(action);\r\n\r\n        selectionTool.deselectAll();\r\n        selectionTool.select(objects);\r\n\r\n        render();\r\n        e.preventDefault();\r\n    }\r\n}\r\nvar clipboard = new Clipboard();","class Context {\r\n    constructor(designer) {\r\n        this.uidmanager = new UIDManager(this);\r\n        this.designer = designer;\r\n    }\r\n    reset() {\r\n        this.designer.reset();\r\n    }\r\n    render() {\r\n        this.designer.render();\r\n    }\r\n    propogate(sender, receiver, signal) {\r\n        this.designer.propogate(sender, receiver, signal);\r\n    }\r\n    add(o) {\r\n        if (o instanceof Wire)\r\n            this.addWire(o);\r\n        else\r\n            this.addObject(o);\r\n    }\r\n    addObject(o) {\r\n        this.designer.addObject(o);\r\n        this.uidmanager.giveUIDTo(o);\r\n    }\r\n    addObjects(arr) {\r\n        for (var i = 0; i < arr.length; i++)\r\n            this.addObject(arr[i]);\r\n    }\r\n    addWire(w) {\r\n        this.designer.addWire(w);\r\n        this.uidmanager.giveUIDTo(w);\r\n    }\r\n    addWires(arr) {\r\n        for (var i = 0; i < arr.length; i++)\r\n            this.addWire(arr[i]);\r\n    }\r\n    addAction(action) {\r\n        this.designer.history.add(action);\r\n    }\r\n    setCursor(cursor) {\r\n        this.designer.renderer.setCursor(cursor);\r\n    }\r\n    remove(o) {\r\n        var index = this.getIndexOf(o);\r\n        if (index === -1)\r\n            return;\r\n        if (o instanceof Wire)\r\n            this.designer.getWires().splice(index, 1);\r\n        else\r\n            this.designer.getObjects().splice(index, 1);\r\n    }\r\n    undo() {\r\n        this.designer.history.undo();\r\n    }\r\n    redo() {\r\n        this.designer.history.redo();\r\n    }\r\n    redistributeUIDs() {\r\n        this.uidmanager.redistribute();\r\n    }\r\n    getDesigner() {\r\n        return this.designer;\r\n    }\r\n    getRenderer() {\r\n        return this.designer.renderer;\r\n    }\r\n    getCamera() {\r\n        return this.designer.camera;\r\n    }\r\n    getHistoryManager() {\r\n        return this.designer.history;\r\n    }\r\n    getObjects() {\r\n        // Copy to avoid confusing bugs when\r\n        // modifying the objects through add/remove\r\n        // and have it edit the returned array\r\n        return CopyArray(this.designer.objects);\r\n    }\r\n    getWires() {\r\n        // Copy to avoid confusing bugs when\r\n        // modifying the objects through add/remove\r\n        // and have it edit the returned array\r\n        return CopyArray(this.designer.wires);\r\n    }\r\n    getIndexOf(o) {\r\n        if (o instanceof Wire)\r\n            return this.designer.getIndexOfWire(o);\r\n        else\r\n            return this.designer.getIndexOfObject(o);\r\n    }\r\n    findByUID(uid) {\r\n        return findObjectByUID(uid) || findWireByUID(uid);\r\n    }\r\n    findObjectByUID(uid) {\r\n        return UIDManager.find(this.getObjects(), uid);\r\n    }\r\n    findWireByUID(uid) {\r\n        return UIDManager.find(this.getWires(), uid);\r\n    }\r\n}\r\n\r\nfunction getCurrentContext() {\r\n    return currentContext;\r\n}\r\n","function copyGroup(objects) {\r\n    if (objects.length === 0)\r\n        return [];\r\n\r\n    var copies = [];\r\n    for (var i = 0; i < objects.length; i++) {\r\n        if (objects[i] instanceof WirePort)\r\n            objects.splice(i--, 1);\r\n        else\r\n            copies[i] = objects[i].copy();\r\n    }\r\n\r\n    // Copy and reconnect all wires\r\n    var wireCopies = [];\r\n    for (var i = 0; i < objects.length; i++) {\r\n        var obj = objects[i];\r\n        for (var j = 0; j < obj.outputs.length; j++) {\r\n            var wires = obj.outputs[j].connections;\r\n            for (var k = 0; k < wires.length; k++) {\r\n                // See if connection was also copied\r\n                var ww = wires[k];\r\n                while (ww instanceof Wire || ww instanceof WirePort)\r\n                    ww = ww.connection;\r\n                if (findIPort(objects, ww, copies) == undefined)\r\n                    break;\r\n\r\n                var wire = wires[k].copy();\r\n                copies[i].outputs[j].connect(wire);\r\n                var w = wires[k];\r\n                // Iterate through all wires connected to other wires\r\n                while(w.connection instanceof WirePort) {\r\n                    var port = new WirePort(obj.context);\r\n                    wire.connect(port);\r\n                    wireCopies.push(wire);\r\n                    w = w.connection.connection;\r\n                    wire = w.copy();\r\n                    port.connect(wire);\r\n                    copies.push(port);\r\n                }\r\n                var lastConnection = findIPort(objects, w.connection, copies);\r\n                wire.connect(lastConnection);\r\n                wireCopies.push(wire);\r\n            }\r\n        }\r\n    }\r\n    for (var i = 0; i < objects.length; i++) {\r\n        copies[i].isOn = objects[i].isOn;\r\n        if (objects[i].inputs.length === 0)\r\n            copies[i].activate(objects[i].isOn);\r\n    }\r\n    for (var i = 0; i < wireCopies.length; i++) {\r\n        if (objects[i].inputs.length === 0)\r\n            copies[i].activate(objects[i].isOn);\r\n    }\r\n\r\n    return {objects:copies, wires:wireCopies};\r\n}\r\n\r\nfunction findIPort(objects, target, copies) {\r\n    for (var i = 0; i < objects.length; i++) {\r\n        var iports = objects[i].inputs;\r\n        for (var j = 0; j < iports.length; j++) {\r\n            if (iports[j] === target)\r\n                return copies[i].inputs[j];\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\n","class HistoryManager {\r\n    constructor() {\r\n        this.undoStack = [];\r\n        this.redoStack = [];\r\n    }\r\n    onKeyDown(code, input) {\r\n        if (Input.getModifierKeyDown()) {\r\n            if (code === Y_KEY || (code === Z_KEY && Input.getShiftKeyDown()))\r\n                this.redo();\r\n            else if (code === Z_KEY)\r\n                this.undo();\r\n        }\r\n    }\r\n    add(action) {\r\n        // Check for empty group action\r\n        if (action instanceof GroupAction &&\r\n            action.actions.length == 0) {\r\n                return;\r\n        }\r\n        \r\n        this.redoStack = [];\r\n        this.undoStack.push(action);\r\n    }\r\n    undo() {\r\n        if (this.undoStack.length > 0) {\r\n            var action = this.undoStack.pop();\r\n            action.undo();\r\n            this.redoStack.push(action);\r\n            // Update popup's values\r\n            popup.update();\r\n            render();\r\n        }\r\n    }\r\n    redo() {\r\n        if (this.redoStack.length > 0) {\r\n            var action = this.redoStack.pop();\r\n            action.redo();\r\n            this.undoStack.push(action);\r\n            // Update popup's values\r\n            popup.update();\r\n            render();\r\n        }\r\n    }\r\n}\r\n","class BezierCurve {\r\n    constructor(p1, p2, c1, c2) {\r\n        this.p1 = V(p1.x,p1.y);\r\n        this.p2 = V(p2.x,p2.y);\r\n        this.c1 = V(c1.x,c1.y);\r\n        this.c2 = V(c2.x,c2.y);\r\n        this.dirty = true;\r\n        this.boundingBox = new Transform(0,0,0,getCurrentContext().getCamera());\r\n    }\r\n    update(p1, p2, c1, c2) {\r\n        this.p1.x = p1.x;\r\n        this.p1.y = p1.y;\r\n        this.p2.x = p2.x;\r\n        this.p2.y = p2.y;\r\n        this.c1.x = c1.x;\r\n        this.c1.y = c1.y;\r\n        this.c2.x = c2.x;\r\n        this.c2.y = c2.y;\r\n    }\r\n    updateBoundingBox() {\r\n        if (!this.dirty)\r\n            return;\r\n        this.dirty = false;\r\n\r\n        var min = V(0, 0);\r\n        var max = V(0, 0);\r\n        var end1 = this.getPos(0);\r\n        var end2 = this.getPos(1);\r\n        var a = this.c1.sub(this.c2).scale(3).add(this.p2.sub(this.p1));\r\n        var b = this.p1.sub(this.c1.scale(2).add(this.c2)).scale(2);\r\n        var c = this.c1.sub(this.p1);\r\n\r\n        var discriminant1 = b.y*b.y - 4*a.y*c.y;\r\n        discriminant1 = (discriminant1 >= 0 ? Math.sqrt(discriminant1) : -1);\r\n        var t1 = (discriminant1 !== -1 ? clamp((-b.y + discriminant1)/(2*a.y),0,1) : 0);\r\n        var t2 = (discriminant1 !== -1 ? clamp((-b.y - discriminant1)/(2*a.y),0,1) : 0);\r\n        max.y = Math.max(this.getY(t1), this.getY(t2), end1.y, end2.y);\r\n        min.y = Math.min(this.getY(t1), this.getY(t2), end1.y, end2.y);\r\n\r\n        var discriminant2 = b.x*b.x - 4*a.x*c.x;\r\n        discriminant2 = (discriminant2 >= 0 ? Math.sqrt(discriminant2) : -1);\r\n        var t3 = (discriminant2 !== -1 ? clamp((-b.x + discriminant2)/(2*a.x),0,1) : 0);\r\n        var t4 = (discriminant2 !== -1 ? clamp((-b.x - discriminant2)/(2*a.x),0,1) : 0);\r\n        max.x = Math.max(this.getX(t1), this.getX(t2), end1.x, end2.x);\r\n        min.x = Math.min(this.getX(t1), this.getX(t2), end1.x, end2.x);\r\n\r\n        this.boundingBox.setSize(V(max.x - min.x, max.y - min.y));\r\n        this.boundingBox.setPos(V((max.x - min.x)/2 + min.x, (max.y - min.y)/2 + min.y));\r\n    }\r\n    draw(style, size, renderer) {\r\n        var camera = renderer.parent.camera;\r\n\r\n        var p1 = camera.getScreenPos(this.p1);\r\n        var p2 = camera.getScreenPos(this.p2);\r\n        var c1 = camera.getScreenPos(this.c1);\r\n        var c2 = camera.getScreenPos(this.c2);\r\n\r\n        renderer.curve(p1.x, p1.y, p2.x, p2.y, c1.x, c1.y, c2.x, c2.y, style, size);\r\n    }\r\n    getX(t) {\r\n        var it = 1 - t;\r\n        return this.p1.x*it*it*it + 3*this.c1.x*t*it*it + 3*this.c2.x*t*t*it + this.p2.x*t*t*t;\r\n    }\r\n    getY(t) {\r\n        var it = 1 - t;\r\n        return this.p1.y*it*it*it + 3*this.c1.y*t*it*it + 3*this.c2.y*t*t*it + this.p2.y*t*t*t;\r\n    }\r\n    getPos(t) {\r\n        return V(this.getX(t), this.getY(t));\r\n    }\r\n    getDX(t) {\r\n        var it = 1 - t;\r\n        return -3*this.p1.x*it*it + 3*this.c1.x*it*(1-3*t) + 3*this.c2.x*t*(2-3*t) + 3*this.p2.x*t*t;\r\n    }\r\n    getDY(t) {\r\n        var it = 1 - t;\r\n        return -3*this.p1.y*it*it + 3*this.c1.y*it*(1-3*t) + 3*this.c2.y*t*(2-3*t) + 3*this.p2.y*t*t;\r\n    }\r\n    getVel(t) {\r\n        return V(this.getDX(t), this.getDY(t));\r\n    }\r\n    getDDX(t) {\r\n        var m = -this.p1.x + 3*this.c1.x - 3*this.c2.x + this.p2.x;\r\n        var b = this.p1.x - 2*this.c1.x + this.c2.x;\r\n        return 6*(m * t + b);\r\n    }\r\n    getDDY(t) {\r\n        var m = -this.p1.y + 3*this.c1.y - 3*this.c2.y + this.p2.y;\r\n        var b = this.p1.y - 2*this.c1.y + this.c2.y;\r\n        return 6*(m * t + b);\r\n    }\r\n    getDist(t, mx, my) {\r\n        var dx = this.getX(t) - mx;\r\n        var dy = this.getY(t) - my;\r\n        return Math.sqrt(dx*dx + dy*dy);\r\n    }\r\n    getDist2(t, mx, my) {\r\n        var dx = this.getX(t) - mx;\r\n        var dy = this.getY(t) - my;\r\n        return dx*dx + dy*dy;\r\n    }\r\n    getDistDenominator(t, mx, my) {\r\n        var dx = this.getX(t) - mx;\r\n        var dy = this.getY(t) - my;\r\n        return dx*dx + dy*dy;\r\n    }\r\n    getDistDenominatorDerivative(t, mx, my) {\r\n        return  2*(this.getX(t) - mx) * this.getDX(t) +\r\n                2*(this.getY(t) - my) * this.getDY(t);\r\n    }\r\n    getDistNumerator(t, mx, my) {\r\n        var dx = this.getX(t) - mx;\r\n        var dy = this.getY(t) - my;\r\n        return  this.getDX(t)*dx +\r\n                this.getDY(t)*dy;\r\n    }\r\n    getDistNumeratorDerivative(t, mx, my) {\r\n        var dx = this.getX(t) - mx;\r\n        var dy = this.getY(t) - my;\r\n        var dbx = this.getDX(t);\r\n        var dby = this.getDY(t);\r\n        return  dbx*dbx + dx*this.getDDX(t) +\r\n                dby*dby + dy*this.getDDY(t);\r\n    }\r\n    getNearestT(mx, my) {\r\n        var minDist = 1e20;\r\n        var t0 = -1;\r\n        for (var tt = 0; tt <= 1.0; tt += 1.0 / WIRE_DIST_ITERATIONS) {\r\n            var dist = this.getDist(tt, mx, my);\r\n            if (dist < minDist) {\r\n                t0 = tt;\r\n                minDist = dist;\r\n            }\r\n        }\r\n\r\n        // Newton's method to find parameter for when slope is undefined AKA denominator function = 0\r\n        var t1 = findRoots(WIRE_NEWTON_ITERATIONS, t0, mx, my, (t,x,y)=>this.getDistDenominator(t,x,y), (t,x,y)=>this.getDistDenominatorDerivative(t,x,y));\r\n        if (this.getDist2(t1, mx, my) < WIRE_DIST_THRESHOLD2)\r\n            return t1;\r\n\r\n        // Newton's method to find parameter for when slope is 0 AKA numerator function = 0\r\n        var t2 = findRoots(WIRE_NEWTON_ITERATIONS, t0, mx, my, (t,x,y)=>this.getDistNumerator(t,x,y), (t,x,y)=>this.getDistNumeratorDerivative(t,x,y));\r\n        if (this.getDist2(t2, mx, my) < WIRE_DIST_THRESHOLD2)\r\n            return t2;\r\n\r\n        return -1;\r\n    }\r\n    getBoundingBox() {\r\n        this.updateBoundingBox();\r\n        return this.boundingBox;\r\n    }\r\n    copy() {\r\n        return new BezierCurve(this.p1.copy(), this.p2.copy(), this.c1.copy(), this.c2.copy());\r\n    }\r\n    writeTo(node) {\r\n        var bezierNode = createChildNode(node, \"bezier\");\r\n        createTextElement(bezierNode, \"p1x\", this.p1.x);\r\n        createTextElement(bezierNode, \"p1y\", this.p1.y);\r\n        createTextElement(bezierNode, \"p2x\", this.p2.x);\r\n        createTextElement(bezierNode, \"p2y\", this.p2.y);\r\n        createTextElement(bezierNode, \"c1x\", this.c1.x);\r\n        createTextElement(bezierNode, \"c1y\", this.c1.y);\r\n        createTextElement(bezierNode, \"c2x\", this.c2.x);\r\n        createTextElement(bezierNode, \"c2y\", this.c2.y);\r\n    }\r\n    load(node) {\r\n        var p1 = V(getFloatValue(getChildNode(node, \"p1x\")), getFloatValue(getChildNode(node, \"p1y\")));\r\n        var p2 = V(getFloatValue(getChildNode(node, \"p2x\")), getFloatValue(getChildNode(node, \"p2y\")));\r\n        var c1 = V(getFloatValue(getChildNode(node, \"c1x\")), getFloatValue(getChildNode(node, \"c1y\")));\r\n        var c2 = V(getFloatValue(getChildNode(node, \"c2x\")), getFloatValue(getChildNode(node, \"c2y\")));\r\n        this.update(p1, p2, c1, c2);\r\n    }\r\n}\r\n","class Matrix2x3 {\r\n    constructor(other) {\r\n        this.mat = [];\r\n        this.identity();\r\n        if (other instanceof Matrix2x3) {\r\n            for (var i = 0; i < 2*3; i++)\r\n                this.mat[i] = other.mat[i];\r\n        }\r\n    }\r\n    zero() {\r\n        for (var i = 0; i < 2*3; i++)\r\n            this.mat[i] = 0;\r\n        return this;\r\n    }\r\n    identity() {\r\n        this.zero();\r\n\r\n        this.mat[0] = 1.0;\r\n        this.mat[3] = 1.0;\r\n\r\n        return this;\r\n    }\r\n    mul(v) {\r\n        var result = V(0,0);\r\n        result.x = this.mat[0] * v.x + this.mat[2] * v.y + this.mat[4];\r\n        result.y = this.mat[1] * v.x + this.mat[3] * v.y + this.mat[5];\r\n        return result;\r\n    }\r\n    mult(m) {\r\n        var result = new Matrix2x3();\r\n        result.mat[0] = this.mat[0]*m.mat[0] + this.mat[2]*m.mat[1];\r\n        result.mat[1] = this.mat[1]*m.mat[0] + this.mat[3]*m.mat[1];\r\n        result.mat[2] = this.mat[0]*m.mat[2] + this.mat[2]*m.mat[3];\r\n        result.mat[3] = this.mat[1]*m.mat[2] + this.mat[3]*m.mat[3];\r\n        result.mat[4] = this.mat[0]*m.mat[4] + this.mat[2]*m.mat[5] + this.mat[4];\r\n        result.mat[5] = this.mat[1]*m.mat[4] + this.mat[3]*m.mat[5] + this.mat[5];\r\n        return result;\r\n    }\r\n    translate(v) {\r\n        this.mat[4] += this.mat[0] * v.x + this.mat[2] * v.y;\r\n        this.mat[5] += this.mat[1] * v.x + this.mat[3] * v.y;\r\n    }\r\n    rotate(theta) {\r\n        var c = Math.cos(theta);\r\n        var s = Math.sin(theta);\r\n        var m11 = this.mat[0] * c + this.mat[2] * s;\r\n        var m12 = this.mat[1] * c + this.mat[3] * s;\r\n        var m21 = this.mat[0] * -s + this.mat[2] * c;\r\n        var m22 = this.mat[1] * -s + this.mat[3] * c;\r\n        this.mat[0] = m11;\r\n        this.mat[1] = m12;\r\n        this.mat[2] = m21;\r\n        this.mat[3] = m22;\r\n    }\r\n    scale(s) {\r\n        this.mat[0] *= s.x;\r\n        this.mat[1] *= s.x;\r\n        this.mat[2] *= s.y;\r\n        this.mat[3] *= s.y;\r\n    }\r\n    inverse() {\r\n        var inv = new Array(3*2);\r\n        var det;\r\n\r\n        inv[0] = this.mat[3];\r\n        inv[1] = -this.mat[1];\r\n        inv[2] = -this.mat[2];\r\n        inv[3] = this.mat[0];\r\n        inv[4] = this.mat[2] * this.mat[5] -\r\n                 this.mat[4] * this.mat[3];\r\n        inv[5] = this.mat[4] * this.mat[1] -\r\n                 this.mat[0] * this.mat[5];\r\n\r\n        det = this.mat[0]*this.mat[3] - this.mat[1]*this.mat[2];\r\n\r\n        if (det == 0)\r\n            return undefined;\r\n\r\n        det = 1.0 / det;\r\n\r\n        var m = new Matrix2x3();\r\n        for (var i = 0; i < 2*3; i++)\r\n            m.mat[i] = inv[i] * det;\r\n\r\n        return m;\r\n    }\r\n    print() {\r\n        console.log(\"[\" + this.mat[0].toFixed(3) + \", \" + this.mat[2].toFixed(3) + \", \" + this.mat[4].toFixed(3) + \"]\\n\" +\r\n                    \"[\" + this.mat[1].toFixed(3) + \", \" + this.mat[3].toFixed(3) + \", \" + this.mat[5].toFixed(3) + \"]\");\r\n    }\r\n}\r\n","class Transform {\r\n    constructor(pos, size, angle, camera) {\r\n        this.parent = undefined;\r\n        this.pos = V(pos.x, pos.y);\r\n        this.size = V(size.x, size.y);\r\n        this.angle = angle;\r\n        this.scale = V(1, 1);\r\n        this.corners = [];\r\n        this.localCorners = [];\r\n        this.camera = camera;\r\n        this.dirty = true;\r\n        this.dirtySize = true;\r\n        this.dirtyCorners = true;\r\n        this.updateMatrix();\r\n    }\r\n    updateMatrix(c) {\r\n        if (!this.dirty)\r\n            return;\r\n        this.dirty = false;\r\n\r\n        this.matrix = new Matrix2x3();\r\n        this.matrix.translate(this.pos);\r\n        this.matrix.rotate(this.angle);\r\n        this.matrix.scale(this.scale);\r\n\r\n        if (this.parent != undefined)\r\n            this.matrix = this.parent.getMatrix().mult(this.matrix);\r\n\r\n        this.inverse = this.matrix.inverse();\r\n    }\r\n    updateSize() {\r\n        if (!this.dirtySize)\r\n            return;\r\n        this.dirtySize = false;\r\n\r\n        this.localCorners = [this.size.scale(V(-0.5, 0.5)), this.size.scale(V(0.5, 0.5)),\r\n                             this.size.scale(V(0.5, -0.5)), this.size.scale(V(-0.5, -0.5))];\r\n\r\n        this.radius = Math.sqrt(this.size.x*this.size.x + this.size.y*this.size.y)/2;\r\n    }\r\n    updateCorners() {\r\n        if (!this.dirtyCorners)\r\n            return;\r\n        this.dirtyCorners = false;\r\n\r\n        var corners = this.getLocalCorners();\r\n        for (var i = 0; i < 4; i++)\r\n            this.corners[i] = this.toWorldSpace(corners[i]);\r\n    }\r\n    transformCtx(ctx) {\r\n        this.updateMatrix();\r\n        var m = new Matrix2x3(this.matrix);\r\n        var v = this.camera.getScreenPos(V(m.mat[4], m.mat[5]));\r\n        m.mat[4] = v.x, m.mat[5] = v.y;\r\n        m.scale(V(1/this.camera.zoom, 1/this.camera.zoom));\r\n        ctx.setTransform(m.mat[0], m.mat[1], m.mat[2], m.mat[3], m.mat[4], m.mat[5]);\r\n    }\r\n    rotateAbout(a, c) {\r\n        this.setAngle(a);\r\n        this.setPos(this.pos.sub(c));\r\n        var cos = Math.cos(a), sin = Math.sin(a);\r\n        var xx = this.pos.x * cos - this.pos.y * sin;\r\n        var yy = this.pos.y * cos + this.pos.x * sin;\r\n        this.setPos(V(xx, yy).add(c));\r\n        this.dirty = true;\r\n        this.dirtyCorners = true;\r\n    }\r\n    setParent(t) {\r\n        this.parent = t;\r\n        this.dirty = true;\r\n        this.dirtyCorners = true;\r\n    }\r\n    setCamera(c) {\r\n        this.camera = c;\r\n    }\r\n    setPos(p) {\r\n        this.pos.x = p.x;\r\n        this.pos.y = p.y;\r\n        this.dirty = true;\r\n        this.dirtyCorners = true;\r\n    }\r\n    setAngle(a) {\r\n        this.angle = a;\r\n        this.dirty = true;\r\n        this.dirtyCorners = true;\r\n    }\r\n    setScale(s) {\r\n        this.scale.x = s.x;\r\n        this.scale.y = s.y;\r\n        this.dirty = true;\r\n    }\r\n    setSize(s) {\r\n        this.size.x = s.x;\r\n        this.size.y = s.y;\r\n        this.dirtySize = true;\r\n        this.dirtyCorners = true;\r\n    }\r\n    setWidth(w) {\r\n        this.size.x = w;\r\n        this.dirtySize = true;\r\n        this.dirtyCorners = true;\r\n    }\r\n    setHeight(h) {\r\n        this.size.y = h;\r\n        this.dirtySize = true;\r\n        this.dirtyCorners = true;\r\n    }\r\n    toLocalSpace(v) { // v must be in world coords\r\n        return this.getInverseMatrix().mul(v);\r\n    }\r\n    toWorldSpace(v) { // v must be in local coords\r\n        return this.getMatrix().mul(v);\r\n    }\r\n    getPos() {\r\n        return V(this.pos.x, this.pos.y);\r\n    }\r\n    getAngle() {\r\n        return this.angle;\r\n    }\r\n    getScale() {\r\n        return V(this.scale.x, this.scale.y);\r\n    }\r\n    getSize() {\r\n        return this.size;\r\n    }\r\n    getRadius() {\r\n        this.updateSize();\r\n        return this.radius;\r\n    }\r\n    getMatrix() {\r\n        this.updateMatrix();\r\n        return this.matrix;\r\n    }\r\n    getInverseMatrix() {\r\n        this.updateMatrix();\r\n        return this.inverse;\r\n    }\r\n    getBottomLeft() {\r\n        this.updateCorners();\r\n        return this.corners[0];\r\n    }\r\n    getBottomRight() {\r\n        this.updateCorners();\r\n        return this.corners[1];\r\n    }\r\n    getTopRight() {\r\n        this.updateCorners();\r\n        return this.corners[2];\r\n    }\r\n    getTopLeft() {\r\n        this.updateCorners();\r\n        return this.corners[3];\r\n    }\r\n    getCorners() {\r\n        this.updateCorners();\r\n        return this.corners;\r\n    }\r\n    getLocalCorners() {\r\n        this.updateSize();\r\n        return this.localCorners;\r\n    }\r\n    equals(other) {\r\n        if (!(other instanceof Transform))\r\n            return false;\r\n\r\n        var m1 = this.getMatrix().mat;\r\n        var m2 = other.getMatrix().mat;\r\n        for (var i = 0; i < m1.length; i++) {\r\n            if (m1[i] !== m2[i])\r\n                return false;\r\n        }\r\n        return true;\r\n    }\r\n    print() {\r\n        this.updateMatrix();\r\n        this.matrix.print();\r\n    }\r\n    copy() {\r\n        var trans = new Transform(this.pos.copy(), this.size.copy(), this.angle, this.camera);\r\n        trans.scale = this.scale.copy();\r\n        trans.dirty = true;\r\n        return trans;\r\n    }\r\n}\r\n","\r\n// Utility method for a new Vector\r\nfunction V(x, y) {\r\n    return new Vector(x, y);\r\n}\r\n\r\nclass Vector {\r\n    constructor(x, y) {\r\n        this.set(x, y);\r\n    }\r\n    set(x, y) {\r\n        if (x instanceof Vector) {\r\n            this.x = (x.x ? x.x : 0);\r\n            this.y = (x.y ? x.y : 0);\r\n        } else {\r\n            this.x = (x ? x : 0);\r\n            this.y = (y ? y : 0);\r\n        }\r\n    }\r\n    translate(dx, dy) {\r\n        if (dx instanceof Vector)\r\n            this.set(this.add(dx));\r\n        else\r\n            this.set(this.x + dx, this.y + dy);\r\n    }\r\n    add(x, y) {\r\n        if (x instanceof Vector)\r\n            return new Vector(this.x + x.x, this.y + x.y);\r\n        else\r\n            return new Vector(this.x + x, this.y + y);\r\n    }\r\n    sub(x, y) {\r\n        if (x instanceof Vector)\r\n            return new Vector(this.x - x.x, this.y - x.y);\r\n        else\r\n            return new Vector(this.x - x, this.y - y);\r\n    }\r\n    scale(a) {\r\n        if (a instanceof Vector)\r\n            return new Vector(a.x * this.x, a.y * this.y);\r\n        else\r\n            return new Vector(a * this.x, a * this.y);\r\n    }\r\n    normalize() {\r\n        var len = this.len();\r\n        if (len === 0) {\r\n            return new Vector(0, 0);\r\n        } else {\r\n            var invLen = 1 / len;\r\n            return new Vector(this.x * invLen, this.y * invLen);\r\n        }\r\n    }\r\n    len() {\r\n        return Math.sqrt(this.x*this.x + this.y*this.y);\r\n    }\r\n    len2() {\r\n        return this.x*this.x + this.y*this.y;\r\n    }\r\n    distanceTo(v) {\r\n        return this.sub(v).len();\r\n    }\r\n    dot(v) {\r\n        return this.x * v.x + this.y * v.y;\r\n    }\r\n    project(v) {\r\n        return this.scale(v.dot(this) / this.len2());\r\n    }\r\n    copy() {\r\n        return new Vector(this.x, this.y);\r\n    }\r\n}\r\n","class Module {\r\n    constructor(parent, divName, divTextName) {\r\n        this.parent = parent;\r\n        this.div = document.getElementById(divName);\r\n        this.divtext = (divTextName ? document.getElementById(divTextName) : undefined);\r\n        this.div.oninput = () => { render(); this.onChange(); };\r\n        this.div.onclick = () => this.onClick();\r\n        this.div.onfocus = () => this.onFocus();\r\n        this.div.onblur =  () => this.onBlur();\r\n    }\r\n    blur() {\r\n        this.div.blur();\r\n    }\r\n    onShow() {}\r\n    setValue(val) {\r\n        this.div.value = val;\r\n    }\r\n    setPlaceholder(val) {\r\n        this.div.placeholder = val;\r\n    }\r\n    setVisibility(val) {\r\n        this.div.style.display = val;\r\n        if (this.divtext != undefined)\r\n            this.divtext.style.display = val;\r\n    }\r\n    setDisabled(val) {\r\n        this.div.disabled = val;\r\n    }\r\n    getValue() {\r\n        return this.div.value;\r\n    }\r\n    onChange() {}\r\n    onClick() {}\r\n    onFocus() {\r\n        this.parent.focused = true;\r\n    }\r\n    onBlur() {\r\n        this.parent.focused = false;\r\n    }\r\n}\r\n","class Popup {\r\n    constructor(divName) {\r\n        this.div = document.getElementById(divName);\r\n        this.div.addEventListener('keydown', e => {this.onKeyDown(e.keyCode);}, false);\r\n        this.div.addEventListener('keyup', e => {this.onKeyUp(e.keyCode);}, false);\r\n        this.div.style.position = \"absolute\";\r\n        this.focused = false;\r\n\r\n        this.modules = [];\r\n\r\n        this.setPos(V(0,0));\r\n        this.hide();\r\n    }\r\n    onKeyDown(code) {\r\n    }\r\n    onKeyUp(code) {\r\n    }\r\n    add(m) {\r\n        this.modules.push(m);\r\n    }\r\n    update() {\r\n        this.onShow();\r\n    }\r\n    onShow() {\r\n        for (var i = 0; i < this.modules.length; i++)\r\n            this.modules[i].onShow();\r\n    }\r\n    blur() {\r\n        for (var i = 0; i < this.modules.length; i++)\r\n            this.modules[i].blur();\r\n    }\r\n    show() {\r\n        this.hidden = false;\r\n        this.div.style.visibility = \"visible\";\r\n        this.div.focus();\r\n        this.onShow();\r\n    }\r\n    hide() {\r\n        this.hidden = true;\r\n        this.div.style.visibility = \"hidden\";\r\n        this.div.blur();\r\n    }\r\n    setPos(v) {\r\n        this.pos = V(v.x, v.y);\r\n        this.clamp();\r\n\r\n        this.div.style.left = this.pos.x + \"px\";\r\n        this.div.style.top = this.pos.y + \"px\";\r\n    }\r\n    clamp() {\r\n        this.pos.x = Math.max(Math.min(this.pos.x, window.innerWidth -this.div.clientWidth -1), ItemNavController.isOpen ? ITEMNAV_WIDTH+5 : 5);\r\n        this.pos.y = Math.max(Math.min(this.pos.y, window.innerHeight-this.div.clientHeight-1), (header ? header.clientHeight : 0)+5);\r\n    }\r\n}\r\n","/* Should be const instead of var\r\n   but Safari does not allow it */\r\nvar PROPOGATION_TIME = 1;\r\n\r\nvar updateRequests = 0;\r\n\r\nclass Propogation {\r\n    constructor(sender, receiver, signal, update) {\r\n        this.sender = sender;\r\n        this.receiver = receiver;\r\n        this.signal = signal;\r\n\r\n        if (updateRequests === 0) {\r\n            updateRequests++;\r\n            setTimeout(update, PROPOGATION_TIME);\r\n        }\r\n    }\r\n    send() {\r\n        this.receiver.activate(this.signal);\r\n    }\r\n}\r\n","class UIDManager {\r\n    constructor(context) {\r\n        this.context = context;\r\n        this.counter = 0;\r\n    }\r\n    giveUIDTo(obj) {\r\n        if (!obj.uid)\r\n            obj.uid = (this.counter++);\r\n    }\r\n    redistribute() {\r\n        var things = this.context.getObjects().concat(this.context.getWires());\r\n        this.counter = 0;\r\n        for (var i = 0; i < things.length; i++)\r\n            things[i].uid = (this.counter++);\r\n    }\r\n}\r\n\r\n/**\r\n * Finds and returns the thing in the given\r\n * array that has the given uid (Unique Identification)\r\n *\r\n * @param  {Array} things\r\n *         The group of things to search\r\n *\r\n * @param  {Integer} uid\r\n *         The target unique identification to search for\r\n *\r\n * @return {IOObject}\r\n *         The object with the given uid or undefined if\r\n *         the object is not found\r\n */\r\nUIDManager.find = function(things, target) {\r\n    for (var i = 0; i < things.length; i++) {\r\n        if (things[i].uid === target)\r\n            return things[i];\r\n    }\r\n    return undefined;\r\n}\r\n","\r\n/* Should be const instead of var\r\n   but Safari does not allow it */\r\nvar DEFAULT_SIZE = 50;\r\nvar GRID_SIZE = 50;\r\nvar DEFAULT_FILL_COLOR = \"#ffffff\";\r\nvar DEFAULT_BORDER_COLOR = \"#000000\";\r\nvar DEFAULT_ON_COLOR = \"#3cacf2\";\r\n\r\nvar IO_PORT_LENGTH = 60;\r\nvar IO_PORT_RADIUS = 7;\r\nvar IO_PORT_BORDER_WIDTH = 1;\r\nvar IO_PORT_LINE_WIDTH = 2;\r\n\r\nvar WIRE_DIST_THRESHOLD = 5;\r\nvar WIRE_DIST_THRESHOLD2 = WIRE_DIST_THRESHOLD*WIRE_DIST_THRESHOLD;\r\nvar WIRE_DIST_ITERATIONS = 10;\r\nvar WIRE_NEWTON_ITERATIONS = 5;\r\nvar WIRE_SNAP_THRESHOLD = 10;\r\n\r\nvar ROTATION_CIRCLE_RADIUS = 75;\r\nvar ROTATION_CIRCLE_THICKNESS = 5;\r\nvar ROTATION_CIRCLE_THRESHOLD = 5;\r\nvar ROTATION_CIRCLE_R1 = Math.pow(ROTATION_CIRCLE_RADIUS - ROTATION_CIRCLE_THRESHOLD, 2);\r\nvar ROTATION_CIRCLE_R2 = Math.pow(ROTATION_CIRCLE_RADIUS + ROTATION_CIRCLE_THRESHOLD, 2);\r\n\r\nvar SIDENAV_WIDTH = 200;\r\nvar ITEMNAV_WIDTH = 200;\r\n\r\nvar LEFT_MOUSE_BUTTON = 0;\r\nvar RIGHT_MOUSE_BUTTON = 1;\r\n\r\nvar OPTION_KEY = 18;\r\nvar SHIFT_KEY = 16;\r\nvar BACKSPACE_KEY = 8;\r\nvar DELETE_KEY = 46;\r\nvar ENTER_KEY = 13;\r\nvar ESC_KEY = 27;\r\nvar A_KEY = 65;\r\nvar C_KEY = 67;\r\nvar V_KEY = 86;\r\nvar X_KEY = 88;\r\nvar Y_KEY = 89;\r\nvar Z_KEY = 90;\r\nvar CONTROL_KEY = 17;\r\nvar COMMAND_KEY = 91;\r\n\r\n/**\r\n * Determines whether the given point is\r\n * within the rectangle defined by the\r\n * given transform\r\n *\r\n * @param  {Transform} transform\r\n *         The transform that represents the rectangle\r\n *\r\n * @param  {Vector} pos\r\n *         * Must be in world coordinates *\r\n *         The point to determine whether or not\r\n *         it's within the rectangle\r\n *\r\n * @return {Boolean}\r\n *         True if the point is within the rectangle,\r\n *         false otherwise\r\n */\r\nfunction rectContains(transform, pos) {\r\n    var tr = transform.size.scale(0.5);\r\n    var bl = transform.size.scale(-0.5);\r\n    var p  = transform.toLocalSpace(pos);\r\n\r\n    return (p.x > bl.x &&\r\n            p.y > bl.y &&\r\n            p.x < tr.x &&\r\n            p.y < tr.y);\r\n}\r\n\r\n/**\r\n * Determines whether the given point\r\n * is within the circle defined by the\r\n * given transform\r\n *\r\n * @param  {Transform} transform\r\n *         The transform that represents the circle\r\n *\r\n * @param  {Vector} pos\r\n *         * Must be in world coordinates *\r\n *         The point to determine whether or not\r\n *         it's within the rectangle\r\n *\r\n * @return {Boolean}\r\n *          True if the point is within the rectangle,\r\n *          false otherwise\r\n */\r\nfunction circleContains(transform, pos) {\r\n    var v = transform.toLocalSpace(pos);\r\n    return (v.len2() <= transform.size.x*transform.size.x/4);\r\n}\r\n\r\n/**\r\n * Compares two transforms to see if they overlap.\r\n * First tests it using a quick circle-circle\r\n * intersection using the 'radius' of the transform\r\n *\r\n * Then uses a SAT (Separating Axis Theorem) method\r\n * to determine whether or not the two transforms\r\n * are intersecting\r\n *\r\n * @param  {Transform} a\r\n *         The first transform\r\n *\r\n * @param  {Transform} b\r\n *         The second transform\r\n *\r\n * @return {Boolean}\r\n *         True if the two transforms are overlapping,\r\n *         false otherwise\r\n */\r\nfunction transformContains(A, B) {\r\n    // If both transforms are non-rotated\r\n    if (Math.abs(A.getAngle()) <= 1e-5 && Math.abs(B.getAngle()) <= 1e-5) {\r\n        var aPos = A.getPos(), aSize = A.getSize();\r\n        var bPos = B.getPos(), bSize = B.getSize();\r\n        return (Math.abs(aPos.x - bPos.x) * 2 < (aSize.x + bSize.x)) &&\r\n               (Math.abs(aPos.y - bPos.y) * 2 < (aSize.y + bSize.y));\r\n    }\r\n\r\n    // Quick check circle-circle intersection\r\n    var r1 = A.getRadius();\r\n    var r2 = B.getRadius();\r\n    var sr = r1 + r2;                       // Sum of radius\r\n    var dpos = A.getPos().sub(B.getPos());  // Delta position\r\n    if (dpos.dot(dpos) > sr*sr)\r\n        return false;\r\n\r\n    /* Perform SAT */\r\n\r\n    // Get corners in local space of transform A\r\n    var a = A.getLocalCorners();\r\n\r\n    // Transform B's corners into A local space\r\n    var bworld = B.getCorners();\r\n    var b = [];\r\n    for (var i = 0; i < 4; i++) {\r\n        b[i] = A.toLocalSpace(bworld[i]);\r\n\r\n        // Offsets x and y to fix perfect lines\r\n        // where b[0] = b[1] & b[2] = b[3]\r\n        b[i].x += 0.0001*i;\r\n        b[i].y += 0.0001*i;\r\n    }\r\n\r\n    var corners = a.concat(b);\r\n\r\n    var minA, maxA, minB, maxB;\r\n\r\n    // SAT w/ x-axis\r\n    // Axis is <1, 0>\r\n    // So dot product is just the x-value\r\n    minA = maxA = corners[0].x;\r\n    minB = maxB = corners[4].x;\r\n    for (var j = 1; j < 4; j++) {\r\n        minA = Math.min(corners[j].x, minA);\r\n        maxA = Math.max(corners[j].x, maxA);\r\n        minB = Math.min(corners[j+4].x, minB);\r\n        maxB = Math.max(corners[j+4].x, maxB);\r\n    }\r\n    if (maxA < minB || maxB < minA)\r\n        return false;\r\n\r\n    // SAT w/ y-axis\r\n    // Axis is <1, 0>\r\n    // So dot product is just the y-value\r\n    minA = maxA = corners[0].y;\r\n    minB = maxB = corners[4].y;\r\n    for (var j = 1; j < 4; j++) {\r\n        minA = Math.min(corners[j].y, minA);\r\n        maxA = Math.max(corners[j].y, maxA);\r\n        minB = Math.min(corners[j+4].y, minB);\r\n        maxB = Math.max(corners[j+4].y, maxB);\r\n    }\r\n    if (maxA < minB || maxB < minA)\r\n        return false;\r\n\r\n    // SAT w/ other two axes\r\n    var normals = [b[3].sub(b[0]), b[3].sub(b[2])];\r\n    for (var i = 0; i < normals.length; i++) {\r\n        var normal = normals[i];\r\n        var minA = undefined, maxA = undefined;\r\n        var minB = undefined, maxB = undefined;\r\n        for (var j = 0; j < 4; j++) {\r\n            var s = corners[j].dot(normal);\r\n            minA = Math.min(s, (minA ? minA :  Infinity));\r\n            maxA = Math.max(s, (maxA ? maxA : -Infinity));\r\n            var s2 = corners[j+4].dot(normal);\r\n            minB = Math.min(s2, (minB ? minB :  Infinity));\r\n            maxB = Math.max(s2, (maxB ? maxB : -Infinity));\r\n        }\r\n        if (maxA < minB || maxB < minA)\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n/**\r\n * Returns the nearest point on the edge\r\n * of the given rectangle.\r\n *\r\n * @param  {Vector} bl\r\n *         Bottom left corner of the rectangle\r\n *\r\n * @param  {Vector} tr\r\n *         Top right corner of the rectangle\r\n *\r\n * @param  {Vector} pos\r\n *         The position to get the nearest point on\r\n *\r\n * @return {Vector}\r\n *         The closest position on the edge of\r\n *         the rectangle from 'pos'\r\n */\r\nfunction getNearestPointOnRect(bl, tr, pos) {\r\n    if (pos.x < bl.x)\r\n        return V(bl.x, clamp(pos.y, bl.y, tr.y));\r\n    if (pos.x > tr.x)\r\n        return V(tr.x, clamp(pos.y, bl.y, tr.y));\r\n    if (pos.y < bl.y)\r\n        return V(clamp(pos.x, bl.x, tr.x), bl.y);\r\n    if (pos.y > tr.y)\r\n        return V(clamp(pos.x, bl.x, tr.x), tr.y);\r\n    return V(0, 0);\r\n}\r\n\r\n// Okay, I know this is awful but it's like 5:47 am and I'm tired\r\nfunction getAllThingsBetween(things) {\r\n    var objects = [];\r\n    var wiresAndPorts = [];\r\n    for (var i = 0; i < things.length; i++) {\r\n        if (things[i] instanceof Wire || things[i] instanceof WirePort)\r\n            wiresAndPorts.push(things[i]);\r\n        else if (things[i] instanceof IOObject)\r\n            objects.push(things[i]);\r\n    }\r\n    var allTheThings = [];\r\n    for (var i = 0; i < objects.length; i++) {\r\n        allTheThings.push(objects[i]);\r\n        for (var j = 0; j < objects[i].inputs.length; j++) {\r\n            var iport = objects[i].inputs[j];\r\n            obj = iport.input;\r\n            while (obj != undefined && !(obj instanceof OPort)) {\r\n                if (findByUID(allTheThings, obj.uid) == undefined) // If not added yet\r\n                    allTheThings.push(obj);\r\n                obj = obj.input;\r\n            }\r\n        }\r\n        for (var j = 0; j < objects[i].outputs.length; j++) {\r\n            var oport = objects[i].outputs[j];\r\n            for (var k = 0; k < oport.connections.length; k++) {\r\n                obj = oport.connections[k];\r\n                while (obj != undefined && !(obj instanceof IPort)) {\r\n                    if (findByUID(allTheThings, obj.uid) == undefined) // If not added yet\r\n                        allTheThings.push(obj);\r\n                    obj = obj.connection;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    for (var i = 0; i < wiresAndPorts.length; i++) {\r\n        allTheThings.push(wiresAndPorts[i]);\r\n        var obj = wiresAndPorts[i].input;\r\n        while (obj != undefined && !(obj instanceof OPort)) {\r\n            if (findByUID(allTheThings, obj.uid) == undefined) // If not added yet\r\n                allTheThings.push(obj);\r\n            obj = obj.input;\r\n        }\r\n        obj = wiresAndPorts[i].connection;\r\n        while (obj != undefined && !(obj instanceof IPort)) {\r\n            if (findByUID(allTheThings, obj.uid) == undefined) // If not added yet\r\n                allTheThings.push(obj);\r\n            obj = obj.connection;\r\n        }\r\n    }\r\n    return allTheThings;\r\n}\r\n\r\n/**\r\n * Finds and returns all the inter-connected wires\r\n * in a given group of objects\r\n *\r\n * @param  {Array} objects\r\n *         The group of objects to find the wires\r\n *         in between\r\n *\r\n * @return {Array}\r\n *         The resulting wires\r\n */\r\nfunction getAllWires(objects) {\r\n    var wires = [];\r\n    for (var i = 0; i < objects.length; i++) {\r\n        var obj = objects[i];\r\n        for (var j = 0; j < obj.outputs.length; j++) {\r\n            var connections = obj.outputs[j].connections;\r\n            for (var k = 0; k < connections.length; k++) {\r\n                var wire = connections[k];\r\n                while (wire.connection instanceof WirePort) {\r\n                    wires.push(wire);\r\n                    wire = wire.connection.connection;\r\n                }\r\n                wires.push(wire);\r\n            }\r\n        }\r\n    }\r\n    return wires;\r\n}\r\n\r\n/**\r\n * Removes all objects and wires+wireports\r\n * between them\r\n *\r\n * @param  {Context} ctx\r\n *         The context which the objects are apart of\r\n *\r\n * @param  {Array} objects\r\n *         The array of objects in which to remove\r\n *\r\n * @param  {Boolean} doAction\r\n *         True if the action should be re/undoable,\r\n *         False otherwise\r\n */\r\nfunction RemoveObjects(ctx, objects, doAction) {\r\n    if (objects.length === 0)\r\n        return;\r\n\r\n    var action = new GroupAction();\r\n    var things = getAllThingsBetween(objects);\r\n    for (var i = 0; i < things.length; i++) {\r\n        if (things[i].selected)\r\n            selectionTool.deselect([things[i]]);\r\n        if (things[i] instanceof Wire || things[i] instanceof WirePort) {\r\n            var oldinput = things[i].input;\r\n            var oldconnection = things[i].connection;\r\n            things[i].remove();\r\n            if (doAction)\r\n                action.add(new DeleteAction(things[i], oldinput, oldconnection));\r\n        }\r\n    }\r\n    for (var i = 0; i < things.length; i++) {\r\n        if (!(things[i] instanceof Wire || things[i] instanceof WirePort)) {\r\n            things[i].remove();\r\n            if (doAction)\r\n                action.add(new DeleteAction(things[i]));\r\n        }\r\n    }\r\n    if (doAction)\r\n        ctx.addAction(action);\r\n    render();\r\n}\r\n\r\n/**\r\n * Simply copies all elements of an array into\r\n * another array and returns that array\r\n * [DOES NOT COPY EACH OBJECT IN THE ARRAY]\r\n *\r\n * @param  {Array} arr\r\n *         The array to copy\r\n *\r\n * @return {Array}\r\n *         The copied array\r\n */\r\nfunction CopyArray(arr) {\r\n    var copy = [];\r\n    for (var i = 0; i < arr.length; i++)\r\n        copy.push(arr[i]);\r\n    return copy;\r\n}\r\n\r\n/**\r\n * Finds and returns the IC from a given icuid\r\n *\r\n * @param  {Integer} id\r\n *         The icuid of the target IC\r\n *         (Integrated Circuit Unique Identification)\r\n *\r\n * @return {IC}\r\n *         The ic with the given icuid or undefined if\r\n *         the IC is not found\r\n */\r\nfunction findIC(id, ics) {\r\n    for (var i = 0; i < ics.length; i++) {\r\n        if (ics[i].icuid === id)\r\n            return ics[i];\r\n    }\r\n    return undefined;\r\n}\r\n\r\nfunction findByUID(objects, id) {\r\n    for (var i = 0; i < objects.length; i++) {\r\n        if (objects[i].uid === id)\r\n            return objects[i];\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Creates a group transform action given\r\n * the relevant objects and their original\r\n * transforms\r\n *\r\n * @param  {Array} objects\r\n *         The array of objects who have been transformed\r\n *\r\n * @param  {Array} t0\r\n *         The array of transforms that correspond to\r\n *         the original transform of the object in objects\r\n */\r\nfunction createTransformAction(objects, t0) {\r\n    var action = new GroupAction();\r\n    for (var i = 0; i < objects.length; i++) {\r\n        var origin = t0[i];\r\n        var target = objects[i].transform.copy();\r\n        if (origin.equals(target))\r\n            continue;\r\n        action.add(new TransformAction(objects[i], origin, target));\r\n    }\r\n    return action;\r\n}\r\n\r\n/**\r\n * Finds and returns the closest 't' value\r\n * of the parametric equation for a line.\r\n *\r\n * Parametric function defined by\r\n * X(t) = t(p2.x - p1.x) + p1.x\r\n * Y(t) = t(p2.y - p1.y) + p1.y\r\n *\r\n * Solves for 't' from root of the derivative of\r\n * the distance function between the line and <mx, my>\r\n * D(t) = sqrt((X(t) - mx)^2 + (Y(t) - my)^2)\r\n *\r\n * @param  {Vector} p1\r\n *         The first point of the line\r\n *\r\n * @param  {Vector} p2\r\n *         The second point of the line\r\n *\r\n * @param  {Number} mx\r\n *         The x-value of the point\r\n *         to determine the 't' value\r\n *\r\n * @param  {Number} my\r\n *         The y-value of the point\r\n *         to determine the 't' value\r\n *\r\n * @return {Number}\r\n *         The nearest 't' value of <mx, my>\r\n *         on the line p1->p2 or -1 if the\r\n *         dist < WIRE_DIST_THRESHOLD\r\n */\r\nfunction getNearestT(p1, p2, mx, my) {\r\n    var dx = p2.x - p1.x;\r\n    var dy = p2.y - p1.y;\r\n    var t = (dx*(mx - p1.x) + dy*(my - p1.y))/(dx*dx + dy*dy);\r\n    t = clamp(t, 0, 1);\r\n    var pos = V(dx * t + p1.x, dy * t + p1.y);\r\n    if (pos.sub(V(mx, my)).len2() < WIRE_DIST_THRESHOLD2)\r\n        return t;\r\n    else\r\n        return -1;\r\n}\r\n\r\n/**\r\n * Uses Newton's method to find the roots of\r\n * the function 'f' given a derivative 'df'\r\n *\r\n * @param  {Number} iterations\r\n *         The number of iterations to perform\r\n *         Newton's method with; the smaller\r\n *         the better but less accurate\r\n *\r\n * @param  {Number} t0\r\n *         The starting root value parameter\r\n *\r\n * @param  {Number} x\r\n *         Parameter 1 for the function\r\n *\r\n * @param  {Number} y\r\n *         Parameter 2 for the function\r\n *\r\n * @param  {Function} f\r\n *         The function to find the roots of\r\n *         In the form f(t, x, y) = ...\r\n *\r\n * @param  {Function} df\r\n *         The derivative of the function\r\n *         In the form of df(t, x, y)\r\n *\r\n * @return {Number}\r\n *         The parameter 't' that results in\r\n *         f(t, x, y) = 0\r\n */\r\nfunction findRoots(iterations, t0, x, y, f, df) {\r\n    var t = t0;\r\n    do {\r\n        var v = f(t, x, y);\r\n        var dv = df(t, x, y);\r\n        if (dv === 0)\r\n            break;\r\n        t = t - v / dv;\r\n        t = clamp(t, 0.01, 0.99);\r\n    } while((iterations--) > 0);\r\n    return t;\r\n}\r\n\r\n// Separates an array of objects into three sub-groups\r\n// of input-type objects (switch and buttons),\r\n// output-type objects (LEDs),\r\n// and other components.\r\nfunction separateGroup(group) {\r\n    var inputs = [];\r\n    var components = [];\r\n    var outputs = [];\r\n    for (var i = 0; i < group.length; i++) {\r\n        var object = group[i];\r\n        if (object instanceof Switch || object instanceof Button || object instanceof Clock)\r\n            inputs.push(object);\r\n        else if (object instanceof LED)\r\n            outputs.push(object);\r\n        else\r\n            components.push(object);\r\n    }\r\n    return {inputs:inputs, components:components, outputs:outputs};\r\n}\r\n\r\n/**\r\n * Clamps a number between a given min and max\r\n *\r\n * @param  {Number} x\r\n *         The number to clamp\r\n *\r\n * @param  {Number} min\r\n *         The minimum\r\n *\r\n * @param  {Number} max\r\n *         The maximum\r\n *\r\n * @return {Number}\r\n *         The clamped number\r\n */\r\nfunction clamp(x, min, max) {\r\n    return Math.min(Math.max(x, min), max);\r\n}\r\n\r\n// Code from https://stackoverflow.com/questions/5916900/how-can-you-detect-the-version-of-a-browser\r\nfunction getBrowser() {\r\n    if (navigator == undefined)\r\n        return;\r\n    var ua=navigator.userAgent,tem,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\\/))\\/?\\s*(\\d+)/i) || [];\r\n    if(/trident/i.test(M[1])) {\r\n        tem=/\\brv[ :]+(\\d+)/g.exec(ua) || [];\r\n        return {name:'IE',version:(tem[1]||'')};\r\n    }\r\n    if(M[1]==='Chrome') {\r\n        tem=ua.match(/\\bOPR|Edge\\/(\\d+)/)\r\n        if(tem!=null)   {return {name:'Opera', version:tem[1]};}\r\n    }\r\n    M=M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];\r\n    if((tem=ua.match(/version\\/(\\d+)/i))!=null) {M.splice(1,1,tem[1]);}\r\n    return {\r\n      name: M[0],\r\n      version: M[1]\r\n    };\r\n }\r\n","class ContextMenu extends Popup {\r\n    constructor() {\r\n        super(\"context-menu\");\r\n\r\n        this.add(new CutModule(this, \"context-menu-cut\"));\r\n        this.add(new CopyModule(this, \"context-menu-copy\"));\r\n        this.add(new PasteModule(this, \"context-menu-paste\"));\r\n        this.add(new SelectAllModule(this, \"context-menu-select-all\"))\r\n\r\n        this.add(new UndoModule(this, \"context-menu-undo\"));\r\n        this.add(new RedoModule(this, \"context-menu-redo\"))\r\n    }\r\n    onKeyDown(code) {\r\n        if (code === ESC_KEY && !this.hidden) {\r\n            this.hide();\r\n            return;\r\n        }\r\n    }\r\n    onShow() {\r\n        super.onShow();\r\n\r\n        var pos = Input.getRawMousePos();\r\n        this.setPos(V(pos.x, pos.y));\r\n    }\r\n}\r\n","class CopyModule extends Module {\r\n    constructor(parent, divName) {\r\n        super(parent, divName);\r\n    }\r\n    onShow() {\r\n        this.setDisabled(selectionTool.selections.length == 0);\r\n    }\r\n    onClick() {\r\n        this.parent.hide();\r\n        document.execCommand(\"copy\");\r\n    }\r\n}\r\n","class CutModule extends Module {\r\n    constructor(parent, divName) {\r\n        super(parent, divName);\r\n    }\r\n    onShow() {\r\n        this.setDisabled(selectionTool.selections.length == 0);\r\n    }\r\n    onClick() {\r\n        this.parent.hide();\r\n        document.execCommand(\"cut\");\r\n    }\r\n}\r\n","class PasteModule extends Module {\r\n    constructor(parent, divName) {\r\n        super(parent, divName);\r\n    }\r\n    onShow() {\r\n        this.setDisabled(false);\r\n    }\r\n    onClick() {\r\n        this.parent.hide();\r\n        document.execCommand(\"copy\");\r\n    }\r\n}\r\n","class RedoModule extends Module {\r\n    constructor(parent, divName) {\r\n        super(parent, divName);\r\n    }\r\n    onShow() {\r\n        this.setDisabled(getCurrentContext().designer.history.redoStack.length == 0);\r\n    }\r\n    onClick() {\r\n        this.parent.hide();\r\n        getCurrentContext().designer.history.redo();\r\n    }\r\n}\r\n","class SelectAllModule extends Module {\r\n    constructor(parent, divName) {\r\n        super(parent, divName);\r\n    }\r\n    onShow() {\r\n        this.setDisabled(false);\r\n    }\r\n    onClick() {\r\n        this.parent.hide();\r\n        selectionTool.selectAll();\r\n        render();\r\n    }\r\n}\r\n","class UndoModule extends Module {\r\n    constructor(parent, divName) {\r\n        super(parent, divName);\r\n    }\r\n    onShow() {\r\n        this.setDisabled(getCurrentContext().designer.history.undoStack.length == 0);\r\n    }\r\n    onClick() {\r\n        this.parent.hide();\r\n        getCurrentContext().designer.history.undo();\r\n    }\r\n}\r\n","var Exporter = (function() {    \r\n    var projectNameInput = document.getElementById(\"project-name\");\r\n\r\n    return {\r\n        ROOT: undefined,\r\n        saveFile: function() {\r\n            var data = this.write(getCurrentContext());\r\n            var projectName = projectNameInput.value;\r\n            if (projectName === \"Untitled Circuit*\")\r\n                projectName = \"Untitled Circuit\";\r\n            var filename = projectName + \".circuit\";\r\n\r\n            var file = new Blob([data], {type: \"text/plain\"});\r\n            if (window.navigator.msSaveOrOpenBlob) { // IE10+\r\n                window.navigator.msSaveOrOpenBlob(file, filename);\r\n                saved = true;\r\n            } else { // Others\r\n                var a = document.createElement(\"a\");\r\n                var url = URL.createObjectURL(file);\r\n                a.href = url;\r\n                a.download = filename;\r\n                document.body.appendChild(a);\r\n                a.click();\r\n                setTimeout(function() {\r\n                    document.body.removeChild(a);\r\n                    window.URL.revokeObjectURL(url);\r\n                    saved = true;\r\n                }, 0);\r\n            }\r\n        },\r\n        write: function(context) {\r\n            var root = new window.DOMParser().parseFromString(\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?><project></project>\", \"text/xml\");\r\n            this.ROOT = root;\r\n\r\n            var objects = context.getObjects();\r\n            var wires = context.getWires();\r\n\r\n            var projectNode = getChildNode(root, \"project\");\r\n\r\n            var icNode = createChildNode(projectNode, \"ics\");\r\n\r\n            this.writeICs(icNode);\r\n            this.writeGroup(projectNode, objects, wires);\r\n\r\n            return root.xml ? root.xml : (new XMLSerializer()).serializeToString(root);\r\n        },\r\n        writeGroup: function(node, objects, wires) {\r\n            var objectsNode = createChildNode(node, \"objects\");\r\n            var wiresNode = createChildNode(node, \"wires\");\r\n\r\n            for (var i = 0; i < objects.length; i++)\r\n                objects[i].writeTo(objectsNode);\r\n\r\n            for (var i = 0; i < wires.length; i++)\r\n                wires[i].writeTo(wiresNode);\r\n        },\r\n        writeICs: function(node) {\r\n            for (var i = 0; i < ICData.ICs.length; i++) {\r\n                var ic = ICData.ICs[i];\r\n                var ICNode = createChildNode(node, \"ic\");\r\n                createTextElement(ICNode, \"icuid\", ic.icuid);\r\n                createTextElement(ICNode, \"width\", ic.transform.size.x);\r\n                createTextElement(ICNode, \"height\", ic.transform.size.y);\r\n\r\n                var iportNode = createChildNode(ICNode, \"iports\");\r\n                for (var j = 0; j < ic.iports.length; j++)\r\n                    ic.iports[j].writeTo(iportNode);\r\n\r\n                var oportNode = createChildNode(ICNode, \"oports\");\r\n                for (var j = 0; j < ic.oports.length; j++)\r\n                    ic.oports[j].writeTo(oportNode);\r\n\r\n                var componentsNode = createChildNode(ICNode, \"components\");\r\n                var objects = ic.inputs.concat(ic.components, ic.outputs);\r\n                var wires = getAllWires(objects);\r\n                this.writeGroup(componentsNode, objects, wires);\r\n            }\r\n        }\r\n    };\r\n})();\r\n\r\n// UTILS\r\nfunction createChildNode(parent, tag) {\r\n    var child = Exporter.ROOT.createElement(tag);\r\n    parent.appendChild(child);\r\n    return child;\r\n}\r\n\r\nfunction createTextElement(node, tag, text) {\r\n    var a = Exporter.ROOT.createElement(tag);\r\n    var b = Exporter.ROOT.createTextNode(text);\r\n    a.appendChild(b);\r\n    node.appendChild(a);\r\n}\r\n","var Importer = (function() {   \r\n    var fileInput = document.getElementById('file-input');\r\n     \r\n    return {\r\n        types: [],\r\n        openFile: function() {\r\n            // TODO: Custom popup w/ option to save\r\n            var open = confirm(\"Are you sure you want to overwrite your current scene?\");\r\n\r\n            if (open) {\r\n                reset();\r\n\r\n                var reader = new FileReader();\r\n\r\n                reader.onload = function(e) {\r\n                    Importer.load(reader.result, getCurrentContext());\r\n                    render();\r\n                }\r\n\r\n                reader.readAsText(fileInput.files[0]);\r\n            }\r\n        },\r\n        load: function(text, context) {\r\n            //\r\n            // Why?!?!\r\n            // \r\n            // // Remove all whitespace from XML file except for header\r\n            // var header = text.substring(0, text.indexOf(\">\")+1);\r\n            // text = header + text.substring(text.indexOf(\">\")+1).replace(/\\s/g,'');\r\n\r\n            var root = new window.DOMParser().parseFromString(text, \"text/xml\");\r\n            if (root.documentElement.nodeName == \"parsererror\")\r\n                return;\r\n\r\n            var project = getChildNode(root, \"project\");\r\n            var icsNode = getChildNode(project, \"ics\");\r\n\r\n            var ics = this.loadICs(icsNode, context);\r\n\r\n            var group = this.loadGroup(project, context, ics);\r\n            context.addObjects(group.objects);\r\n            context.addWires(group.wires);\r\n\r\n            for (var i = 0; i < ics.length; i++)\r\n                ICData.add(ics[i]);\r\n\r\n            context.redistributeUIDs();\r\n            ICData.redistributeUIDs();\r\n\r\n            return group;\r\n        },\r\n        loadGroup: function(node, context, ics) {\r\n            var objectsNode = getChildNode(node, \"objects\");\r\n            var wiresNode = getChildNode(node, \"wires\");\r\n\r\n            var objects = [];\r\n            var wires = [];\r\n\r\n            for (var i = 0; i < this.types.length; i++) {\r\n                var type = this.types[i];\r\n                var nodes = getChildrenByTagName(objectsNode, type.getXMLName());\r\n                for (var j = 0; j < nodes.length; j++)\r\n                    objects.push(new type(context).load(nodes[j], ics));\r\n            }\r\n\r\n            var wiresArr = getChildrenByTagName(wiresNode, \"wire\");\r\n            for (var i = 0; i < wiresArr.length; i++)\r\n                wires.push(new Wire(context).load(wiresArr[i]));\r\n\r\n            for (var i = 0; i < wires.length; i++)\r\n                wires[i].loadConnections(wiresArr[i], objects);\r\n\r\n            return {objects:objects, wires:wires};\r\n        },\r\n        loadICs: function(node, context) {\r\n            var ics = [];\r\n            var icNodes = getChildrenByTagName(node, \"ic\");\r\n            for (var i = 0; i < icNodes.length; i++) {\r\n                var icNode = icNodes[i];\r\n                var icuid = getIntValue(getChildNode(icNode, \"icuid\"));\r\n                var width = getIntValue(getChildNode(icNode, \"width\"));\r\n                var height = getIntValue(getChildNode(icNode, \"height\"));\r\n\r\n                var componentsNode = getChildNode(icNode, \"components\");\r\n                var group = this.loadGroup(componentsNode, context, ics);\r\n                var data = ICData.create(group.objects);\r\n\r\n                data.icuid = icuid;\r\n                data.transform.setSize(V(width, height));\r\n\r\n                var iports = getChildrenByTagName(getChildNode(icNode, \"iports\"), \"iport\");\r\n                for (var j = 0; j < iports.length; j++)\r\n                    data.iports[j] = new IPort().load(iports[j]);\r\n\r\n                var oports = getChildrenByTagName(getChildNode(icNode, \"oports\"), \"oport\");\r\n                for (var j = 0; j < oports.length; j++)\r\n                    data.oports[j] = new OPort().load(oports[j]);\r\n\r\n                ics.push(data);\r\n            }\r\n            return ics;\r\n        }\r\n    };\r\n})();\r\n\r\n// UTILS\r\nfunction getChildNode(parent, name) {\r\n    for (var i = 0; i < parent.childNodes.length; i++) {\r\n        if (parent.childNodes[i].nodeName === name)\r\n            return parent.childNodes[i];\r\n    }\r\n    return undefined;\r\n}\r\nfunction getChildrenByTagName(parent, name) {\r\n    var children = [];\r\n    for (var i = 0; i < parent.childNodes.length; i++) {\r\n        if (parent.childNodes[i].nodeName === name)\r\n            children.push(parent.childNodes[i]);\r\n    }\r\n    return children;\r\n}\r\nfunction getBooleanValue(node, def) {\r\n    if (node == undefined)\r\n        return def;\r\n    return node.childNodes[0].nodeValue === \"true\" ? true : false;\r\n}\r\nfunction getIntValue(node, def) {\r\n    if (node == undefined)\r\n        return def;\r\n    return parseInt(node.childNodes[0].nodeValue);\r\n}\r\nfunction getFloatValue(node, def) {\r\n    if (node == undefined)\r\n        return def;\r\n    return parseFloat(node.childNodes[0].nodeValue);\r\n}\r\nfunction getStringValue(node, def) {\r\n    if (node == undefined)\r\n        return def;\r\n    return node.childNodes[0].nodeValue;\r\n}\r\n","var Input = (function () {\r\n    var rawMousePos = new Vector(0, 0);\r\n    var mousePos = new Vector(0,0);\r\n    var prevMousePos = new Vector(0,0);\r\n    var worldMousePos = new Vector(0,0);\r\n\r\n    var mouseDown = false;\r\n    var mouseDownPos = undefined;\r\n    \r\n    var mouseListeners = [];\r\n\r\n    var z = 0;\r\n\r\n    var shiftKeyDown = false;\r\n    var modifierKeyDown = false;\r\n    var optionKeyDown = false;\r\n\r\n    var isDragging = false;\r\n    var startTapTime = undefined;\r\n    \r\n    console.log(shiftKeyDown);\r\n    \r\n    var onKeyDown = function(e) {\r\n        var code = e.keyCode;\r\n        \r\n        console.log(shiftKeyDown);\r\n        \r\n        switch (code) {\r\n            case SHIFT_KEY:\r\n                shiftKeyDown = true;\r\n                break;\r\n            case CONTROL_KEY:\r\n            case COMMAND_KEY:\r\n                modifierKeyDown = true;\r\n                break;\r\n            case OPTION_KEY:\r\n                optionKeyDown = true;\r\n                getCurrentContext().setCursor(\"pointer\");\r\n                break;\r\n            case ENTER_KEY:\r\n                if (document.activeElement !== document.body)\r\n                    document.activeElement.blur();\r\n                break;\r\n        }\r\n\r\n        var objects = getCurrentContext().getObjects();\r\n        for (var i = 0; i < objects.length; i++) {\r\n            if (objects[i] instanceof Keyboard)\r\n                objects[i].onKeyDown(code);\r\n        }\r\n\r\n        getCurrentContext().getHistoryManager().onKeyDown(code);\r\n        if (CurrentTool.onKeyDown(code))\r\n            render();\r\n    }\r\n    var onKeyUp = function(e) {\r\n        var code = e.keyCode;\r\n\r\n        switch (code) {\r\n            case SHIFT_KEY:\r\n                shiftKeyDown = false;\r\n                break;\r\n            case CONTROL_KEY:\r\n            case COMMAND_KEY:\r\n                modifierKeyDown = false;\r\n                break;\r\n            case OPTION_KEY:\r\n                optionKeyDown = false;\r\n                getCurrentContext().setCursor(\"default\");\r\n                break;\r\n        }\r\n\r\n        var objects = getCurrentContext().getObjects();\r\n        for (var i = 0; i < objects.length; i++) {\r\n            if (objects[i] instanceof Keyboard)\r\n                objects[i].onKeyUp(code);\r\n        }\r\n\r\n        if (CurrentTool.onKeyUp(code))\r\n            render();\r\n    }\r\n    var onDoubleClick = function(e) {\r\n    }\r\n    var onWheel = function(e) {\r\n        var camera = getCurrentContext().getCamera();\r\n        var delta = -e.deltaY / 120.0;\r\n\r\n        var factor = 0.95;\r\n        if (delta < 0)\r\n            factor = 1 / factor;\r\n\r\n        var worldMousePos = camera.getWorldPos(mousePos);\r\n        camera.zoomBy(factor);\r\n        var newMousePos = camera.getScreenPos(worldMousePos);\r\n        var dx = (mousePos.x - newMousePos.x) * camera.zoom;\r\n        var dy = (mousePos.y - newMousePos.y) * camera.zoom;\r\n\r\n        camera.translate(-dx, -dy);\r\n\r\n        popup.onWheel();\r\n\r\n        render();\r\n    }\r\n    var onMouseDown = function(e) {\r\n        var canvas = getCurrentContext().getRenderer().canvas;\r\n        var rect = canvas.getBoundingClientRect();\r\n        isDragging = false;\r\n        startTapTime = Date.now();\r\n        mouseDown = true;\r\n        mouseDownPos = new Vector(e.clientX - rect.left, e.clientY - rect.top);\r\n\r\n        if (e.button === LEFT_MOUSE_BUTTON) {\r\n            var shouldRender = false;\r\n            contextmenu.hide();\r\n            shouldRender = CurrentTool.onMouseDown(shouldRender);\r\n            for (var i = 0; i < mouseListeners.length; i++) {\r\n                var listener = mouseListeners[i];\r\n                if (!listener.disabled && listener.onMouseDown(shouldRender))\r\n                    shouldRender = true;\r\n            }\r\n            if (shouldRender)\r\n                render();\r\n        }\r\n    }\r\n    var onMouseMove = function(e) {\r\n        var canvas = getCurrentContext().getRenderer().canvas;\r\n        var camera = getCurrentContext().getCamera();\r\n        var rect = canvas.getBoundingClientRect();\r\n\r\n        prevMousePos.x = mousePos.x;\r\n        prevMousePos.y = mousePos.y;\r\n\r\n        rawMousePos = new Vector(e.clientX, e.clientY);\r\n        mousePos = new Vector(e.clientX - rect.left, e.clientY - rect.top);\r\n        worldMousePos = camera.getWorldPos(mousePos);\r\n\r\n        isDragging = (mouseDown && (Date.now() - startTapTime > 50));\r\n\r\n        var shouldRender = false;\r\n\r\n        if (optionKeyDown && isDragging) {\r\n            var pos = new Vector(mousePos.x, mousePos.y);\r\n            var dPos = mouseDownPos.sub(pos);\r\n            camera.translate(camera.zoom * dPos.x, camera.zoom * dPos.y);\r\n            mouseDownPos = mousePos;\r\n\r\n            popup.onMove();\r\n            shouldRender = true;\r\n        }\r\n\r\n        shouldRender = CurrentTool.onMouseMove(shouldRender) || shouldRender;\r\n        for (var i = 0; i < mouseListeners.length; i++) {\r\n            var listener = mouseListeners[i];\r\n            if (!listener.disabled && listener.onMouseMove(shouldRender))\r\n                shouldRender = true;\r\n        }       \r\n        if (shouldRender)\r\n            render();\r\n    }\r\n    var onMouseUp = function(e) {\r\n        mouseDown = false;\r\n\r\n        var shouldRender = false;\r\n        shouldRender = CurrentTool.onMouseUp(shouldRender);\r\n        for (var i = 0; i < mouseListeners.length; i++) {\r\n            var listener = mouseListeners[i];\r\n            if (!listener.disabled && listener.onMouseUp(shouldRender))\r\n                shouldRender = true;\r\n        }       \r\n        if (shouldRender)\r\n            render();\r\n    }\r\n    var onClick = function(e) {\r\n        var shouldRender = false;\r\n        shouldRender = CurrentTool.onClick(shouldRender);\r\n        for (var i = 0; i < mouseListeners.length; i++) {\r\n            var listener = mouseListeners[i];\r\n            if (!listener.disabled && listener.onClick(shouldRender))\r\n                shouldRender = true;\r\n        }\r\n        if (shouldRender)\r\n            render();\r\n    }\r\n    \r\n    window.addEventListener('keydown', e => {onKeyDown(e);}, false);\r\n    window.addEventListener('keyup', e => {onKeyUp(e);}, false);\r\n    \r\n    return {\r\n        registerContext: function(ctx) {\r\n            var canvas = ctx.getRenderer().canvas;\r\n            canvas.addEventListener('click', e => onClick(e), false);\r\n            canvas.addEventListener('dblclick', e => onDoubleClick(e), false);\r\n            // if (browser.name !== \"Firefox\")\r\n                canvas.addEventListener('wheel', e => onWheel(e), false);\r\n            // else\r\n            //     canvas.addEventListener('DOMMouseScroll', e => onWheel(e), false);\r\n            canvas.addEventListener('mousedown', e => onMouseDown(e), false);\r\n            canvas.addEventListener('mouseup', e => onMouseUp(e), false);\r\n            canvas.addEventListener('mousemove', e => onMouseMove(e), false);\r\n            canvas.addEventListener('mouseenter', e => { if (PlaceItemController.drag) { onMouseMove(e); onClick(e); PlaceItemController.drag = false; }}, false);\r\n            canvas.addEventListener(\"mouseleave\", e => { if (mouseDown) { onMouseUp(e); onClick(e); } });\r\n\r\n            canvas.addEventListener(\"contextmenu\", function(e) {\r\n                contextmenu.show(e);\r\n                e.preventDefault();\r\n            });\r\n        },\r\n        addMouseListener: function(l) {\r\n            mouseListeners.push(l);\r\n        },\r\n        getWorldMousePos() {\r\n            return V(worldMousePos);\r\n        },\r\n        getRawMousePos() {\r\n            return V(rawMousePos);\r\n        },\r\n        getShiftKeyDown() {\r\n            return shiftKeyDown;\r\n        },\r\n        getModifierKeyDown() {\r\n            return modifierKeyDown;\r\n        },\r\n        getOptionKeyDown() {\r\n            return optionKeyDown;\r\n        },\r\n        getIsDragging() {\r\n            return isDragging;\r\n        }\r\n    }\r\n})();","var ItemNavController = (function() {\r\n    var tab = document.getElementById(\"open-items-tab\");\r\n    var container = document.getElementById(\"items\");\r\n\r\n    var open = function() {\r\n        container.style.width       = ITEMNAV_WIDTH + \"px\";\r\n        tab.style.marginLeft        = (ItemNavController.getTabOffset()) + \"px\";\r\n        tab.style.borderColor       = \"rgba(153, 153, 153, 0.0)\";\r\n        tab.style.backgroundColor   = \"rgba(200, 200, 200, 0.0)\";\r\n        tab.style.fontSize          = \"2.5em\";\r\n        tab.innerHTML               = \"&times;\";\r\n    }\r\n    var close = function() {\r\n        container.style.width       = \"0px\";\r\n        tab.style.marginLeft        = (ItemNavController.getTabOffset()) + \"px\";\r\n        tab.style.borderColor       = \"rgba(153, 153, 153, 0.7)\";\r\n        tab.style.backgroundColor   = \"rgba(200, 200, 200, 0.7)\";\r\n        tab.style.fontSize          = \"2em\";\r\n        tab.innerHTML               = \"&#9776;\";\r\n    }\r\n\r\n    return {\r\n        disabled: false,\r\n        isOpen: false,\r\n        toggle: function() {\r\n            if (this.isOpen) {\r\n                this.isOpen = false;\r\n                close();\r\n            } else {\r\n                this.isOpen = true;\r\n                open();\r\n            }\r\n\r\n            // if (popup)\r\n            //     popup.onMove();\r\n        },\r\n        getTabOffset: function() {\r\n            return (this.isOpen ? ITEMNAV_WIDTH - tab.offsetWidth : 0);\r\n        }\r\n    };\r\n})();\r\n// ItemNavController.toggle();\r\n","var PlaceItemController = (function() {\r\n    return {\r\n        disabled: false,\r\n        drag: false,\r\n        place: function(item, not) {\r\n            if (not)\r\n                item.not = not;\r\n            var canvas = getCurrentContext().getRenderer().canvas;\r\n            var rect = canvas.getBoundingClientRect();\r\n            itemTool.activate(item, getCurrentContext());\r\n        },\r\n        onDragEnd: function(event) {\r\n            this.drag = true;\r\n            event.srcElement.parentElement.onclick();\r\n        }\r\n    };\r\n})();\r\n","var SelectionBox = (function () {\r\n    var pos1 = undefined; // First corner\r\n    var pos2 = undefined; // Second corner\r\n    \r\n    var getSelections = function() {\r\n        var objects = getCurrentContext().getObjects();\r\n        var selections = [];\r\n        if (pos1 != undefined) {\r\n            var trans = new Transform(V((pos1.x+pos2.x)/2, (pos1.y+pos2.y)/2), \r\n                                      V(Math.abs(pos2.x-pos1.x), Math.abs(pos2.y-pos1.y)), \r\n                                      0, getCurrentContext().getCamera());\r\n            for (var i = 0; i < objects.length; i++) {\r\n                var obj = objects[i];\r\n                var t = (obj.selectionBoxTransform != undefined ? obj.selectionBoxTransform : obj.transform);\r\n                if (transformContains(t, trans)) {\r\n                    selections.push(obj);\r\n                } else if (obj.inputs != undefined && obj.outputs != undefined) {\r\n                    // Check if an iport or oport is selected\r\n                    for (var j = 0; j < obj.inputs.length; j++) {\r\n                        var input = obj.inputs[j];\r\n                        if (rectContains(trans, input.getPos()))\r\n                            selections.push(input);\r\n                    }\r\n                    for (var j = 0; j < obj.outputs.length; j++) {\r\n                        var output = obj.outputs[j];\r\n                        if (rectContains(trans, output.getPos()))\r\n                            selections.push(output);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return selections;\r\n    }\r\n    \r\n    return {\r\n        disabled: false,\r\n        onMouseDown: function(somethingHappened) {\r\n            var objects = getCurrentContext().getObjects();\r\n            var wires = getCurrentContext().getWires();\r\n            var worldMousePos = Input.getWorldMousePos();\r\n            \r\n            // Make sure nothing but blank canvas was clicked\r\n            if (somethingHappened || !selectionTool.isActive \r\n                || Input.getOptionKeyDown())\r\n                return;\r\n            for (var i = 0; i < objects.length; i++) {\r\n                var obj = objects[i];\r\n                if (obj.contains(worldMousePos) || obj.sContains(worldMousePos) ||\r\n                    obj.oPortContains(worldMousePos) !== -1 || obj.iPortContains(worldMousePos) !== -1)\r\n                    return;\r\n            }\r\n            for (var i = 0; i < wires.length; i++) {\r\n                var wire = wires[i];\r\n                if (wire.getNearestT(worldMousePos.x, worldMousePos.y) !== -1)\r\n                    return;\r\n            }\r\n            \r\n            pos1 = V(worldMousePos);\r\n            popup.hide();\r\n        },\r\n        onMouseMove: function() {\r\n            var objects = getCurrentContext().getObjects();\r\n            var worldMousePos = Input.getWorldMousePos();\r\n\r\n            if (pos1 != undefined) {\r\n                pos2 = V(worldMousePos);\r\n                popup.hide();\r\n                return true;\r\n            }\r\n        },\r\n        onMouseUp: function() {\r\n        },\r\n        onClick: function(somethingHappened) {\r\n            var objects = getCurrentContext().getObjects();\r\n            var worldMousePos = Input.getWorldMousePos();\r\n\r\n            // Stop selection box\r\n            if (pos1 != undefined) {\r\n                pos2 = V(worldMousePos);\r\n                var selections = getSelections();\r\n                if (!Input.getShiftKeyDown())\r\n                    selectionTool.deselectAll(true);\r\n                selectionTool.select(selections, true);\r\n                pos1 = undefined;\r\n                pos2 = undefined;\r\n                return true;\r\n            }\r\n        },\r\n        draw(renderer) {\r\n            var camera = renderer.getCamera();\r\n            if (pos1 != undefined && pos2 != undefined) {\r\n                var p1 = camera.getScreenPos(pos1);\r\n                var p2 = camera.getScreenPos(pos2);\r\n                var w = p2.x - p1.x, h = p2.y - p1.y;\r\n                renderer.save();\r\n                renderer.context.globalAlpha = 0.4;\r\n                renderer.rect(p1.x+w/2, p1.y+h/2, w, h, '#ffffff', '#6666ff', 2 / camera.zoom);\r\n                renderer.restore();\r\n            }\r\n        }\r\n    }\r\n})();\r\n","class BusButtonModule extends Module {\r\n    constructor(parent, divName) {\r\n        super(parent, divName);\r\n    }\r\n    onShow() {\r\n        var iports = 0, oports = 0;\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++) {\r\n            if (selections[i] instanceof IPort) {\r\n                iports++;\r\n            } else if (selections[i] instanceof OPort) {\r\n                oports++;\r\n            } else {\r\n                this.setVisibility(\"none\");\r\n                return;\r\n            }\r\n        }\r\n        this.setVisibility(iports === oports ? \"inherit\" : \"none\");\r\n    }\r\n    onClick() {\r\n        this.createBus();\r\n    }\r\n    createBus() {\r\n        var selections = selectionTool.selections;\r\n        \r\n        var iports = [], oports = [];\r\n        for (var i = 0; i < selections.length; i++) {\r\n            if (selections[i] instanceof IPort)\r\n                iports.push(selections[i]);\r\n            else\r\n                oports.push(selections[i]);\r\n        }\r\n\r\n        while (oports.length > 0) {\r\n            var maxDist = -Infinity, maxDistIndex = -1, maxMinDistIndex = -1;\r\n            for (var i = 0; i < oports.length; i++) {\r\n                var oport = oports[i];\r\n                var opos = oport.getPos();\r\n                var minDist = Infinity, minDistIndex = -1;\r\n                for (var j = 0; j < iports.length; j++) {\r\n                    var iport = iports[j];\r\n                    var dist = opos.sub(iport.getPos()).len2();\r\n                    if (dist < minDist) {\r\n                        minDist = dist;\r\n                        minDistIndex = j;\r\n                    }\r\n                }\r\n                if (minDist > maxDist) {\r\n                    maxDist = minDist;\r\n                    maxDistIndex = i;\r\n                    maxMinDistIndex = minDistIndex;\r\n                }\r\n            }\r\n            var wire = new Wire(context);\r\n            getCurrentContext().add(wire);\r\n            oports[maxDistIndex].connect(wire);\r\n            wire.connect(iports[maxMinDistIndex]);\r\n            wire.set = true;\r\n            wire.straight = true;\r\n            oports.splice(maxDistIndex, 1);\r\n            iports.splice(maxMinDistIndex, 1);\r\n        }\r\n        render();\r\n    }\r\n}\r\n","class ColorPickerModule extends Module {\r\n    constructor(parent, divName, divTextName) {\r\n        super(parent, divName, divTextName);\r\n    }\r\n    onShow() {\r\n        var allLEDs = true, allSame = true;\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++) {\r\n            allLEDs = allLEDs && selections[i] instanceof LED;\r\n            if (allLEDs)\r\n                allSame = allSame && selections[i].color === selections[0].color;\r\n        }\r\n        this.setVisibility(allLEDs ? \"inherit\" : \"none\");\r\n        this.setValue(allLEDs && allSame ? selections[0].color : '#ffffff');\r\n    }\r\n    onChange() {\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++)\r\n            selections[i].color = this.getValue();\r\n    }\r\n    onFocus() {\r\n        this.parent.focused = true;\r\n    }\r\n    onBlur() {\r\n        this.parent.focused = false;\r\n        this.onChange();\r\n    }\r\n}\r\n","class ICButtonModule extends Module {\r\n    constructor(parent, divName) {\r\n        super(parent, divName);\r\n    }\r\n    onShow() {\r\n        var count = 0;\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++) {\r\n            if (selections[i] instanceof IOObject && !(selections[i] instanceof WirePort))\r\n                count++;\r\n        }\r\n        this.setVisibility(count >= 2 ? \"inherit\" : \"none\");\r\n    }\r\n    onClick() {\r\n        icdesigner.show(selectionTool.selections);\r\n    }\r\n}\r\n","class InputCountModule extends Module {\r\n    constructor(parent, divName, divTextName) {\r\n        super(parent, divName, divTextName);\r\n    }\r\n    onShow() {\r\n        var allSame = true, display = true;\r\n        var maxMinValue = 0;\r\n        var minMaxValue = 999;\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++) {\r\n            display = display && (selections[i].maxInputs > 1 && selections[i].noChange !== true);\r\n            allSame = allSame && selections[i].getInputAmount() === selections[0].getInputAmount();\r\n            maxMinValue = Math.max(selections[i].getMinInputFieldCount(), maxMinValue);\r\n            minMaxValue = Math.min(selections[i].getMaxInputFieldCount(), minMaxValue);\r\n        }\r\n        this.setValue(allSame ? selections[0].getInputAmount() : \"\");\r\n        this.setPlaceholder(allSame ? \"\" : \"-\");\r\n        this.setVisibility(display ? \"inherit\" : \"none\");\r\n        this.div.min = maxMinValue;\r\n        this.div.max = minMaxValue;\r\n    }\r\n    onChange() {\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++)\r\n            selections[i].setInputAmount(Number(this.getValue()));\r\n    }\r\n}\r\n","class PositionXModule extends Module {\r\n    constructor(parent, divName) {\r\n        super(parent, divName);\r\n    }\r\n    onShow() {\r\n        var allSame = true;\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++)\r\n            allSame = allSame && selections[i].getPos().x === selections[0].getPos().x;\r\n        this.setValue(allSame ? +(selections[0].getPos().x/GRID_SIZE - 0.5).toFixed(3) : \"\");\r\n        this.setPlaceholder(allSame ? \"\" : \"-\");\r\n    }\r\n    onChange() {\r\n        var action = new GroupAction();\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++) {\r\n            if (!selections[i].transform) {\r\n                this.onShow(); // Update value before exiting\r\n                return;\r\n            }\r\n            var origin = selections[i].transform.copy();\r\n            selections[i].setPos(V(GRID_SIZE*(Number(this.getValue())+0.5), selections[i].transform.getPos().y));\r\n            var target = selections[i].transform.copy();\r\n            action.add(new TransformAction(selections[i], origin, target));\r\n        }\r\n        getCurrentContext().addAction(action);\r\n    }\r\n}\r\n","class PositionYModule extends Module {\r\n    constructor(parent, divName) {\r\n        super(parent, divName);\r\n    }\r\n    onShow() {\r\n        var allSame = true;\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++)\r\n            allSame = allSame && selections[i].getPos().y === selections[0].getPos().y;\r\n        this.setValue(allSame ? +(selections[0].getPos().y/GRID_SIZE - 0.5).toFixed(3) : \"\");\r\n        this.setPlaceholder(allSame ? \"\" : \"-\");\r\n    }\r\n    onChange() {\r\n        var action = new GroupAction();\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++) {\r\n            if (!selections[i].transform) {\r\n                this.onShow(); // Update value before exiting\r\n                return;\r\n            }\r\n            var origin = selections[i].transform.copy();\r\n            selections[i].setPos(V(selections[i].transform.getPos().x, GRID_SIZE*(Number(this.getValue())+0.5)));\r\n            var target = selections[i].transform.copy();\r\n            action.add(new TransformAction(selections[i], origin, target));\r\n        }\r\n        getCurrentContext().addAction(action);\r\n    }\r\n}\r\n","class SelectionPopup extends Popup {\r\n    constructor() {\r\n        super(\"popup\");\r\n\r\n        this.add(new TitleModule(this, \"popup-name\"));\r\n\r\n        this.add(new PositionXModule(this, \"popup-position-x\"));\r\n        this.add(new PositionYModule(this, \"popup-position-y\"));\r\n\r\n        this.add(new InputCountModule(this, \"popup-input-count\", \"popup-input-count-text\"));\r\n\r\n        this.add(new ColorPickerModule(this, \"popup-color-picker\", \"popup-color-text\"));\r\n\r\n        this.add(new ICButtonModule(this, \"popup-ic-button\"));\r\n        this.add(new BusButtonModule(this, \"popup-bus-button\"));\r\n    }\r\n    onKeyDown(code) {\r\n        if ((code === DELETE_KEY || code === BACKSPACE_KEY) && !this.focused) {\r\n            RemoveObjects(getCurrentContext(), selectionTool.selections, true);\r\n            return;\r\n        }\r\n        if (code === ESC_KEY && !this.hidden) {\r\n            selectionTool.deselectAll();\r\n            render();\r\n            return;\r\n        }\r\n    }\r\n    onEnter() {\r\n        this.blur();\r\n    }\r\n    update() {\r\n        var selections = selectionTool.selections;\r\n        if (selections.length > 0) {\r\n            this.show();\r\n            this.onMove();\r\n        } else {\r\n            this.hide();\r\n        }\r\n    }\r\n    onMove() {\r\n        var camera = getCurrentContext().getCamera();\r\n        if (selectionTool.selections.length > 0) {\r\n            selectionTool.recalculateMidpoint();\r\n            var pos = camera.getScreenPos(selectionTool.midpoint);\r\n            pos.y -= this.div.clientHeight/2;\r\n            this.setPos(pos);\r\n        }\r\n    }\r\n    onWheel() {\r\n        this.onMove();\r\n    }\r\n}\r\n","class TitleModule extends Module {\r\n    constructor(parent, divName) {\r\n        super(parent, divName);\r\n    }\r\n    onShow() {\r\n        var allSame = true;\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++)\r\n            allSame = allSame && selections[i].getName() === selections[0].getName();\r\n        this.setValue(allSame ? selections[0].getName() : \"<Multiple>\");\r\n    }\r\n    onChange() {\r\n        var selections = selectionTool.selections;\r\n        for (var i = 0; i < selections.length; i++)\r\n            selections[i].setName(this.getValue());\r\n    }\r\n    onFocus() {\r\n        this.parent.focused = true;\r\n    }\r\n    onBlur() {\r\n        this.parent.focused = false;\r\n        this.onChange();\r\n    }\r\n}\r\n","var SideNavController = (function() {\r\n    var tab = document.getElementById(\"open-sive-nav-button\");\r\n    var tab2 = document.getElementById(\"open-items-tab\");\r\n    var container = document.getElementById(\"sidenav\");\r\n    var otherContent = document.getElementById(\"content\");\r\n    var overlay = document.getElementById(\"overlay\");\r\n    if (overlay) {\r\n        overlay.addEventListener(\"transitionend\", function(event) {\r\n            if (!SideNavController.isOpen)\r\n                overlay.style.visibility = \"hidden\";        \r\n        }, false);\r\n    }\r\n    \r\n    var open = function() {\r\n        container.style.width           = SIDENAV_WIDTH + \"px\";\r\n        otherContent.style.marginLeft   = SIDENAV_WIDTH + \"px\";\r\n        overlay.style.visibility        = \"visible\"; \r\n        overlay.style.opacity           = \"1\"; \r\n        overlay.onclick = function() { SideNavController.toggle(); }\r\n    }\r\n    var close = function() {\r\n        container.style.width           = \"0px\";\r\n        otherContent.style.marginLeft   = \"0px\";\r\n        overlay.style.opacity           = \"0\"; \r\n        overlay.onclick = function() {  }\r\n    }\r\n\r\n    return {\r\n        disabled: false,\r\n        isOpen: false,\r\n        toggle: function() {\r\n            if (this.isOpen) {\r\n                this.isOpen = false;\r\n                close();\r\n            } else {\r\n                this.isOpen = true;\r\n                open();\r\n            }\r\n        },\r\n        getWidth: function() {\r\n            return (this.isOpen ? SIDENAV_WIDTH : 0);\r\n        }\r\n    }\r\n})();\r\n// SideNavController.toggle();\r\n","class Tool {\r\n    constructor() {\r\n        this.isActive = false;\r\n    }\r\n    activate() {\r\n        if (CurrentTool)\r\n            CurrentTool.deactivate();\r\n\r\n        CurrentTool = this;\r\n        this.isActive = true;\r\n        render();\r\n    }\r\n    deactivate() {\r\n        this.isActive = false;\r\n    }\r\n    onKeyDown(code) {\r\n    }\r\n    onKeyUp(code) {\r\n    }\r\n    onMouseDown() {\r\n    }\r\n    onMouseMove() {\r\n    }\r\n    onMouseUp() {\r\n    }\r\n    onClick() {\r\n    }\r\n    draw() {\r\n    }\r\n}\r\nvar CurrentTool;","class ItemTool extends Tool {\r\n    constructor() {\r\n        super();\r\n        this.item = undefined;\r\n    }\r\n    activate(object, context) {\r\n        // If already active, remove current item\r\n        if (this.item != undefined)\r\n            context.remove(this.item);\r\n\r\n        super.activate();\r\n        this.item = object;\r\n        context.addObject(this.item);\r\n        this.onMouseMove();\r\n    }\r\n    deactivate() {\r\n        super.deactivate();\r\n        this.item = undefined;\r\n    }\r\n    onMouseMove() {\r\n        this.item.setPos(Input.getWorldMousePos());\r\n        return true;\r\n    }\r\n    onClick() {\r\n        this.item.setPos(Input.getWorldMousePos());\r\n        var action = new PlaceAction(this.item);\r\n        getCurrentContext().addAction(action);\r\n        selectionTool.activate();\r\n        return true;\r\n    }\r\n}\r\nvar itemTool = new ItemTool();\r\n","class SelectionTool extends Tool {\r\n    constructor() {\r\n        super();\r\n        this.selections = [];\r\n        this.midpoint = V(0, 0);\r\n    }\r\n    onKeyDown(code, input) {\r\n        console.log(code);\r\n        if (!icdesigner.hidden)\r\n            return false;\r\n\r\n        if (code === A_KEY && Input.getModifierKeyDown()) {\r\n            this.selectAll();\r\n            return true;\r\n        }\r\n    }\r\n    onMouseDown() {\r\n        var objects = getCurrentContext().getObjects();\r\n        var wires = getCurrentContext().getWires();\r\n        var worldMousePos = Input.getWorldMousePos();\r\n\r\n        if (!icdesigner.hidden)\r\n            return false;\r\n\r\n        // Go through objects backwards since objects on top are in the back\r\n        for (var i = objects.length-1; i >= 0; i--) {\r\n            var obj = objects[i];\r\n\r\n            // Check if object was pressed\r\n            if (obj.contains(worldMousePos)) {\r\n                if (obj.isPressable)\r\n                    obj.press();\r\n                return true;\r\n            }\r\n\r\n            // Ignore if object's selection box was pressed\r\n            if (obj.sContains(worldMousePos))\r\n                return;\r\n\r\n            // Ignore if a port was pressed\r\n            if (obj.oPortContains(worldMousePos) !== -1 ||\r\n                    obj.iPortContains(worldMousePos) !== -1) {\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    onMouseMove() {}\r\n    onMouseUp() {\r\n        var objects = getCurrentContext().getObjects();\r\n        var wires = getCurrentContext().getWires();\r\n        var worldMousePos = Input.getWorldMousePos();\r\n\r\n        if (!icdesigner.hidden)\r\n            return false;\r\n\r\n        popup.update();\r\n\r\n        for (var i = 0; i < objects.length; i++) {\r\n            var obj = objects[i];\r\n\r\n            // Release pressed object\r\n            if (obj.isPressable && obj.isOn && !Input.isDragging) {\r\n                obj.release();\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    onClick() {\r\n        var objects = getCurrentContext().getObjects();\r\n        var wires = getCurrentContext().getWires();\r\n        var worldMousePos = Input.getWorldMousePos();\r\n\r\n        if (!icdesigner.hidden || Input.getIsDragging())\r\n            return false;\r\n\r\n        // Go through objects backwards since objects on top are in the back\r\n        for (var i = objects.length-1; i >= 0; i--) {\r\n            var obj = objects[i];\r\n\r\n            // Check if object's selection box was clicked\r\n            if (obj.sContains(worldMousePos)) {\r\n                if (obj.selected)\r\n                    return false;\r\n\r\n                if (!Input.getShiftKeyDown() && this.selections.length > 0) {\r\n                    this.deselectAll(true);\r\n\r\n                    // Combine deselect and select actions\r\n                    var deselectAction = getCurrentContext().designer.history.undoStack.pop();\r\n                    this.select([obj], true);\r\n                    var selectAction = getCurrentContext().designer.history.undoStack.pop();\r\n                    var combined = new GroupAction();\r\n                    if (deselectAction != undefined)\r\n                        combined.add(deselectAction);\r\n                    combined.add(selectAction);\r\n                    getCurrentContext().addAction(combined);\r\n                } else {\r\n                    this.select([obj], true);\r\n                }\r\n\r\n                return true;\r\n            }\r\n\r\n            // Check if object was clicked\r\n            if (obj.contains(worldMousePos)) {\r\n                obj.click();\r\n                return true;\r\n            }\r\n        }\r\n\r\n        // Didn't click on anything so deselect everything\r\n        // And add a deselect action\r\n        if (!Input.getShiftKeyDown() && this.selections.length > 0) {\r\n            this.deselectAll(true);\r\n            return true;\r\n        }\r\n    }\r\n    select(objects, doAction) {\r\n        if (objects.length === 0)\r\n            return;\r\n\r\n        var action = new GroupAction();\r\n        for (var i = 0; i < objects.length; i++) {\r\n            var obj = objects[i];\r\n            if (obj.selected)\r\n                continue;\r\n            obj.selected = true;\r\n            this.selections.push(obj);\r\n            this.sendToFront(obj);\r\n            if (doAction)\r\n                action.add(new SelectAction(obj));\r\n        }\r\n        if (doAction)\r\n            getCurrentContext().addAction(action);\r\n        popup.update();\r\n        this.recalculateMidpoint();\r\n    }\r\n    deselect(objects, doAction) {\r\n        if (objects.length === 0)\r\n            return;\r\n\r\n        var action = new GroupAction();\r\n        for (var i = 0; i < objects.length; i++) {\r\n            var obj = objects[i];\r\n            if (!obj.selected) {\r\n                console.error(\"Can't deselect an unselected object! \" + obj);\r\n                continue;\r\n            }\r\n            obj.selected = false;\r\n            this.selections.splice(this.selections.indexOf(obj), 1);\r\n            if (doAction)\r\n                action.add(new SelectAction(obj, true));\r\n        }\r\n        if (doAction)\r\n            getCurrentContext().addAction(action);\r\n        popup.update();\r\n        this.recalculateMidpoint();\r\n    }\r\n    selectAll() {\r\n        this.deselectAll(true);\r\n        this.select(getCurrentContext().getObjects(), true);\r\n    }\r\n    deselectAll(doAction) {\r\n        // Copy selections array because just passing selections\r\n        // causes it to get mutated mid-loop at causes weirdness\r\n        var objects = [];\r\n        for (var i = 0; i < this.selections.length; i++)\r\n            objects.push(this.selections[i]);\r\n        this.deselect(objects, doAction);\r\n    }\r\n    sendToFront(obj) {\r\n        if (obj instanceof IOObject || obj instanceof Wire) {\r\n            getCurrentContext().remove(obj);\r\n            getCurrentContext().add(obj);\r\n        }\r\n    }\r\n    recalculateMidpoint() {\r\n        this.midpoint = V(0, 0);\r\n        for (var i = 0; i < this.selections.length; i++)\r\n            this.midpoint.translate(this.selections[i].getPos());\r\n        this.midpoint = this.midpoint.scale(1. / this.selections.length);\r\n    }\r\n    draw(renderer) {\r\n        var camera = renderer.getCamera();\r\n        if (this.selections.length > 0 && !this.drag) {\r\n            var pos = camera.getScreenPos(this.midpoint);\r\n            var r = ROTATION_CIRCLE_RADIUS / camera.zoom;\r\n            var br = ROTATION_CIRCLE_THICKNESS / camera.zoom;\r\n            TransformController.draw(renderer);\r\n            renderer.circle(pos.x, pos.y, r, undefined, '#ff0000', br, 0.5);\r\n        }\r\n        SelectionBox.draw(renderer);\r\n    }\r\n}\r\nvar selectionTool = new SelectionTool();\r\n","class WiringTool extends Tool {\r\n    constructor() {\r\n        super();\r\n\r\n        this.clickOPort = false;\r\n        this.wire = undefined;\r\n    }\r\n    onKeyUp(code, input) {\r\n        if (code === ESC_KEY)  {\r\n            this.removeWire();\r\n            selectionTool.activate();\r\n            render();\r\n        }\r\n    }\r\n    activate(object, context) {\r\n        super.activate();\r\n        \r\n        console.log(object);\r\n\r\n        this.wire = new Wire(context);\r\n        this.clickOPort = (object instanceof OPort);\r\n        var success;\r\n        if (this.clickOPort)\r\n            success = object.connect(this.wire);\r\n        else\r\n            success = this.wire.connect(object);\r\n        if (success) {\r\n            this.onMouseMove();\r\n            context.addWire(this.wire);\r\n        } else { // Illegal connection (ex. two inputs to IPort)\r\n            selectionTool.activate();\r\n        }\r\n    }\r\n    deactivate() {\r\n        super.deactivate();\r\n\r\n        this.wire = undefined;\r\n    }\r\n    removeWire() {\r\n        getCurrentContext().remove(this.wire);\r\n        if (this.clickOPort)\r\n            this.wire.input.disconnect(this.wire);\r\n        else\r\n            this.wire.disconnect();\r\n    }\r\n    onMouseMove() {\r\n        if (this.clickOPort)\r\n            this.wire.curve.update(this.wire.curve.p1, Input.getWorldMousePos(), this.wire.curve.c1, Input.getWorldMousePos());\r\n        else\r\n            this.wire.curve.update(Input.getWorldMousePos(), this.wire.curve.p2, Input.getWorldMousePos(), this.wire.curve.c2);\r\n        return true;\r\n    }\r\n    onClick() {\r\n        var objects = getCurrentContext().getObjects();\r\n        var worldMousePos = Input.getWorldMousePos();\r\n\r\n        for (var i = 0; i < objects.length; i++) {\r\n            var ii = -1;\r\n            if (this.clickOPort && (ii = objects[i].iPortContains(worldMousePos)) !== -1) {\r\n                if (!this.wire.connect(objects[i].inputs[ii]))\r\n                    this.removeWire();\r\n            }\r\n            if (!this.clickOPort && (ii = objects[i].oPortContains(worldMousePos)) !== -1) {\r\n                if (!objects[i].outputs[ii].connect(this.wire))\r\n                    this.removeWire();\r\n            }\r\n            if (ii !== -1) {\r\n                var action = new PlaceWireAction(this.wire);\r\n                getCurrentContext().addAction(action);\r\n\r\n                selectionTool.activate();\r\n                return true;\r\n            }\r\n         }\r\n\r\n        this.removeWire();\r\n        selectionTool.activate();\r\n        return true;\r\n    }\r\n}\r\nvar wiringTool = new WiringTool();","var TransformController = (function() {\r\n    var pressedObj = undefined;\r\n    \r\n    var isDragging = false;\r\n    var isRotating = false;\r\n    \r\n    var dragPos = V(0,0);\r\n    var dragObjects = [];\r\n    \r\n    var startAngle = 0;\r\n    var prevAngle = 0\r\n    var realAngles = [];\r\n    var rotateObjects = [];\r\n    \r\n    var startTransforms = []; // For undoing\r\n    \r\n    var drag = function(pos, shift) {\r\n        var dPos = V(pos).sub(pressedObj.getPos()).sub(dragPos);\r\n        for (var i = 0; i < dragObjects.length; i++) {\r\n            var obj = dragObjects[i];\r\n            var newPos = obj.getPos().add(dPos);\r\n            if (shift) {\r\n                newPos = V(Math.floor(newPos.x/GRID_SIZE+0.5)*GRID_SIZE,\r\n                           Math.floor(newPos.y/GRID_SIZE+0.5)*GRID_SIZE);\r\n            }\r\n            obj.setPos(newPos);\r\n        }\r\n        selectionTool.recalculateMidpoint();\r\n    }\r\n    var rotate = function(pos, shift) {\r\n        var origin = selectionTool.midpoint;\r\n        var dAngle = Math.atan2(pos.y - origin.y, pos.x - origin.x) - prevAngle;\r\n        for (var i = 0; i < rotateObjects.length; i++) {\r\n            var newAngle = realAngles[i] + dAngle;\r\n            realAngles[i] = newAngle;\r\n            if (shift)\r\n                newAngle = Math.floor(newAngle/(Math.PI/4))*Math.PI/4;\r\n            rotateObjects[i].setRotationAbout(newAngle, origin);\r\n        }\r\n        prevAngle = dAngle + prevAngle;\r\n    }\r\n\r\n    return {\r\n        disabled: false,\r\n        startDrag: function(obj, worldMousePos) {\r\n            if (!obj.selected) {\r\n                selectionTool.deselectAll(true);\r\n                selectionTool.select([obj], true);\r\n            }\r\n            dragObjects = selectionTool.selections;\r\n            \r\n            startTransforms = [];\r\n            for (var i = 0; i < dragObjects.length; i++) {\r\n                if (!dragObjects[i].transform)\r\n                    return true;\r\n                startTransforms[i] = dragObjects[i].transform.copy();\r\n            }\r\n            isDragging = true;\r\n            dragPos = worldMousePos.copy().sub(obj.getPos());\r\n            pressedObj = obj;\r\n            popup.hide();\r\n            return true;\r\n        },\r\n        startRotation(objs, pos) {\r\n            rotateObjects = objs;\r\n            realAngles = [];\r\n            startTransforms = [];\r\n            for (var i = 0; i < rotateObjects.length; i++) {\r\n                if (!rotateObjects[i].transform)\r\n                    return true;\r\n                realAngles[i] = rotateObjects[i].getAngle();\r\n                startTransforms[i] = rotateObjects[i].transform.copy();\r\n            }\r\n            isRotating = true;\r\n            startAngle = Math.atan2(pos.y-selectionTool.midpoint.y, pos.x-selectionTool.midpoint.x);\r\n            prevAngle = startAngle;\r\n            popup.hide();\r\n            return true;\r\n        },\r\n        onMouseDown: function() {\r\n            var objects = getCurrentContext().getObjects();\r\n            var worldMousePos = Input.getWorldMousePos();\r\n\r\n            // Check if rotation circle was pressed\r\n            if (!isRotating && selectionTool.selections.length > 0) {\r\n                var d = worldMousePos.sub(selectionTool.midpoint).len2();\r\n                if (d <= ROTATION_CIRCLE_R2 && d >= ROTATION_CIRCLE_R1) {\r\n                    return this.startRotation(selectionTool.selections, worldMousePos);\r\n                }\r\n            }\r\n            \r\n            // Go through objects backwards since objects on top are in the back\r\n            for (var i = objects.length-1; i >= 0; i--) {\r\n                var obj = objects[i];\r\n\r\n                // Check if object's selection box was pressed\r\n                if (obj.contains(worldMousePos) || obj.sContains(worldMousePos)) {\r\n                    pressedObj = obj;\r\n                    return;\r\n                }\r\n            }\r\n        },\r\n        onMouseMove: function() {\r\n            var objects = getCurrentContext().getObjects();\r\n            var worldMousePos = Input.getWorldMousePos();\r\n            \r\n            // Begin dragging\r\n            if (!isDragging && pressedObj != undefined) {\r\n                return this.startDrag(pressedObj, worldMousePos);\r\n            }\r\n            \r\n            // Actually move the object(s)\r\n            if (isDragging) {\r\n                drag(worldMousePos, Input.getShiftKeyDown());\r\n                return true;\r\n            }\r\n            if (isRotating) {\r\n                rotate(worldMousePos, Input.getShiftKeyDown());\r\n                return true;\r\n            }\r\n        },\r\n        onMouseUp: function() {\r\n            pressedObj = undefined;\r\n\r\n            // Stop dragging\r\n            if (isDragging) {\r\n                // Add transform action\r\n                getCurrentContext().addAction(createTransformAction(dragObjects, startTransforms));\r\n                isDragging = false;\r\n                return true;\r\n            }\r\n\r\n            // Stop rotating\r\n            if (isRotating) {\r\n                // Add transform action\r\n                getCurrentContext().addAction(createTransformAction(rotateObjects, startTransforms));\r\n                isRotating = false;\r\n                return true;\r\n            }\r\n        },\r\n        onClick: function() {\r\n        },\r\n        draw: function(renderer) {\r\n            // Draw rotation circle\r\n            var camera = renderer.getCamera();\r\n            var pos = camera.getScreenPos(selectionTool.midpoint);\r\n            var r = ROTATION_CIRCLE_RADIUS / camera.zoom;\r\n            if (isRotating) {\r\n                renderer.save();\r\n                renderer.context.fillStyle = '#fff';\r\n                renderer.context.strokeStyle = '#000'\r\n                renderer.context.lineWidth = 5;\r\n                renderer.context.globalAlpha = 0.4;\r\n                renderer.context.beginPath();\r\n                renderer.context.moveTo(pos.x, pos.y);\r\n                var da = (prevAngle - startAngle) % (2*Math.PI);\r\n                if (da < 0) da += 2*Math.PI;\r\n                renderer.context.arc(pos.x, pos.y, r, startAngle, prevAngle, da > Math.PI);\r\n                renderer.context.fill();\r\n                renderer.context.closePath();\r\n                renderer.restore();\r\n            }\r\n        }\r\n    };\r\n})();\r\n","var WireController = (function() {\r\n    var pressedPort = undefined;\r\n    \r\n    var pressedWire = undefined;\r\n    var wireSplitPoint = -1;\r\n\r\n    return {\r\n        disabled: false,\r\n        onMouseDown: function(somethingHappened) {\r\n            var objects = getCurrentContext().getObjects();\r\n            var wires = getCurrentContext().getWires();\r\n            var worldMousePos = Input.getWorldMousePos();\r\n                        \r\n            // Make sure nothing else has happened\r\n            if (somethingHappened)\r\n                return;\r\n            \r\n            // Check if a IOPort was clicked to start creating new wire\r\n            for (var i = objects.length-1; i >= 0; i--) {\r\n                var obj = objects[i];\r\n\r\n                // Check if port was clicked, then activate wire tool\r\n                var ii;\r\n                if ((ii = obj.oPortContains(worldMousePos)) !== -1) {\r\n                    pressedPort = obj.outputs[ii];\r\n                    return;\r\n                }\r\n                if ((ii = obj.iPortContains(worldMousePos)) !== -1) {\r\n                    pressedPort = obj.inputs[ii];\r\n                    return;\r\n                }\r\n            }\r\n            \r\n            // Check if a wire was pressed\r\n            for (var i = 0; i < wires.length; i++) {\r\n                var wire = wires[i];\r\n                var t;\r\n                if ((t = wire.getNearestT(worldMousePos.x, worldMousePos.y)) !== -1) {\r\n                    pressedWire = wire;\r\n                    wireSplitPoint = t;\r\n                    return true;\r\n                }\r\n            }\r\n        },\r\n        onMouseMove: function(somethingHappened) {\r\n            var worldMousePos = Input.getWorldMousePos();\r\n            \r\n            // Make sure nothing else has happened\r\n            if (somethingHappened)\r\n                return;\r\n                \r\n            // Begin dragging new wire\r\n            if (pressedPort != undefined) {\r\n                wiringTool.activate(pressedPort, getCurrentContext());\r\n                pressedPort = undefined;\r\n                return true;\r\n            }\r\n            \r\n            // Begin splitting wire\r\n            if (pressedWire != undefined) {\r\n                pressedWire.split(wireSplitPoint);\r\n                var action = new SplitWireAction(pressedWire);\r\n                getCurrentContext().addAction(action);\r\n                selectionTool.deselectAll(true);\r\n                selectionTool.select([pressedWire.connection], true);\r\n                TransformController.startDrag(pressedWire.connection, worldMousePos);\r\n                pressedWire = undefined;\r\n                return true;\r\n            }\r\n        },\r\n        onMouseUp: function() {   \r\n        },\r\n        onClick: function(somethingHappened) {\r\n            // Make sure nothing else has happened\r\n            if (somethingHappened) {\r\n                pressedPort = undefined;\r\n                pressedWire = undefined;\r\n                return;\r\n            }\r\n\r\n            // Clicking also begins dragging\r\n            if (pressedPort != undefined) {\r\n                wiringTool.activate(pressedPort, getCurrentContext());\r\n                pressedPort = undefined;\r\n                return true;\r\n            }\r\n\r\n            // Select wire\r\n            if (pressedWire != undefined) {\r\n                if (!Input.getShiftKeyDown())\r\n                    selectionTool.deselectAll(true);\r\n                selectionTool.select([pressedWire], true);\r\n                pressedWire = undefined;\r\n                return true;\r\n            }\r\n        }\r\n    };\r\n})();\r\n","class IOObject {\r\n    constructor(context, x, y, w, h, img, isPressable, maxInputs, maxOutputs, selectionBoxWidth, selectionBoxHeight) {\r\n        if (context == undefined)\r\n            context = getCurrentContext();\r\n        this.context = context;\r\n        x = (x == undefined ? 0 : x);\r\n        y = (y == undefined ? 0 : y)\r\n        this.transform = new Transform(V(x, y), V(w, h), 0, context.getCamera());\r\n        this.cullTransform = new Transform(this.transform.getPos(), V(0,0), 0, this.context.getCamera());\r\n\r\n        this.name = this.getDisplayName();\r\n        this.img = img;\r\n        this.isOn = false;\r\n        this.isPressable = isPressable;\r\n        this.maxInputs = maxInputs;\r\n        this.maxOutputs = maxOutputs;\r\n        this.selected = false;\r\n\r\n        if (this.isPressable)\r\n            this.selectionBoxTransform = new Transform(V(x, y), V(selectionBoxWidth, selectionBoxHeight), 0, context.getCamera());\r\n\r\n        this.outputs = [];\r\n        this.inputs = [];\r\n\r\n        if (maxOutputs > 0)\r\n            this.setOutputAmount(1);\r\n    }\r\n    setInputAmount(target) {\r\n        target = clamp(target, 0, this.maxInputs);\r\n        while (this.inputs.length > target)\r\n            this.inputs.splice(this.inputs.length-1, 1);\r\n        while (this.inputs.length < target)\r\n            this.inputs.push(new IPort(this));\r\n\r\n        for (var i = 0; i < this.inputs.length; i++)\r\n            this.inputs[i].updatePosition();\r\n        this.onTransformChange();\r\n    }\r\n    setOutputAmount(target) {\r\n        target = clamp(target, 0, this.maxOutputs);\r\n        while (this.outputs.length > target)\r\n            this.outputs.splice(this.outputs.length-1, 1);\r\n        while (this.outputs.length < target)\r\n            this.outputs.push(new OPort(this));\r\n\r\n        for (var i = 0; i < this.outputs.length; i++)\r\n            this.outputs[i].updatePosition();\r\n        this.onTransformChange();\r\n    }\r\n    onTransformChange() {\r\n        if (this.isPressable && this.selectionBoxTransform != undefined) {\r\n            this.selectionBoxTransform.setPos(this.transform.getPos());\r\n            this.selectionBoxTransform.setAngle(this.transform.getAngle());\r\n            this.selectionBoxTransform.setScale(this.transform.getScale());\r\n        }\r\n        this.updateCullTransform();\r\n        for (var i = 0; i < this.inputs.length; i++)\r\n            this.inputs[i].onTransformChange();\r\n        for (var i = 0; i < this.outputs.length; i++)\r\n            this.outputs[i].onTransformChange();\r\n    }\r\n    updateCullTransform() {\r\n        // Find min/max points on the object\r\n        var min = V(-this.transform.size.x/2, -this.transform.size.y/2);\r\n        var max = V(this.transform.size.x/2, this.transform.size.y/2);\r\n        if (this.selectionBoxTransform != undefined) {\r\n            min.x = Math.min(-this.selectionBoxTransform.size.x/2, min.x);\r\n            min.y = Math.min(-this.selectionBoxTransform.size.y/2, min.y);\r\n            max.x = Math.max(this.selectionBoxTransform.size.x/2, max.x);\r\n            max.y = Math.max(this.selectionBoxTransform.size.y/2, max.y);\r\n        }\r\n        for (var i = 0; i < this.inputs.length; i++) {\r\n            var iport = this.inputs[i];\r\n            min.x = Math.min(iport.target.x, min.x);\r\n            min.y = Math.min(iport.target.y, min.y);\r\n            max.x = Math.max(iport.target.x, max.x);\r\n            max.y = Math.max(iport.target.y, max.y);\r\n        }\r\n        for (var i = 0; i < this.outputs.length; i++) {\r\n            var oport = this.outputs[i];\r\n            min.x = Math.min(oport.target.x, min.x);\r\n            min.y = Math.min(oport.target.y, min.y);\r\n            max.x = Math.max(oport.target.x, max.x);\r\n            max.y = Math.max(oport.target.y, max.y);\r\n        }\r\n        this.cullTransform.setSize(V(max.x - min.x, max.y - min.y));\r\n        var c = Math.cos(this.transform.getAngle());\r\n        var s = Math.sin(this.transform.getAngle());\r\n        var x = (min.x - (-this.cullTransform.size.x/2)) * c + (min.y - (-this.cullTransform.size.y/2)) * s;\r\n        var y = (min.y - (-this.cullTransform.size.y/2)) * c + (min.x - (-this.cullTransform.size.x/2)) * s;\r\n        this.cullTransform.setPos(this.transform.getPos().add(V(x, y)));\r\n        this.cullTransform.setAngle(this.transform.getAngle());\r\n        this.cullTransform.setScale(this.transform.getScale());\r\n        this.cullTransform.setSize(this.cullTransform.size.add(V(2*IO_PORT_RADIUS, 2*IO_PORT_RADIUS)));\r\n    }\r\n    click() {\r\n        // console.log(this);\r\n    }\r\n    press() {\r\n    }\r\n    release() {\r\n    }\r\n    activate(on, i) {\r\n        if (i == undefined)\r\n            i = 0;\r\n\r\n        this.isOn = on;\r\n        if (this.outputs[i] != undefined)\r\n            this.outputs[i].activate(on);\r\n    }\r\n    localSpace() {\r\n        var renderer = this.context.getRenderer();\r\n        renderer.save();\r\n        this.transform.transformCtx(renderer.context);\r\n    }\r\n    draw() {\r\n        this.localSpace();\r\n        for (var i = 0; i < this.inputs.length; i++)\r\n            this.inputs[i].draw();\r\n\r\n        for (var i = 0; i < this.outputs.length; i++)\r\n            this.outputs[i].draw(i);\r\n\r\n        var renderer = this.context.getRenderer();\r\n        if (this.isPressable && this.selectionBoxTransform != undefined)\r\n            renderer.rect(0, 0, this.selectionBoxTransform.size.x, this.selectionBoxTransform.size.y, this.getCol(), this.getBorderColor());\r\n\r\n        if (this.img != undefined)\r\n            renderer.image(this.img, 0, 0, this.transform.size.x, this.transform.size.y, this.getImageTint());\r\n        renderer.restore();\r\n    }\r\n    remove() {\r\n        this.context.remove(this);\r\n        for (var i = 0; i < this.outputs.length; i++)\r\n            this.outputs[i].remove();\r\n        for (var i = 0; i < this.inputs.length; i++)\r\n            this.inputs[i].remove();\r\n    }\r\n    contains(pos) {\r\n        return rectContains(this.transform, pos);\r\n    }\r\n    sContains(pos) {\r\n        return (!this.isPressable &&  this.contains(pos)) ||\r\n                (this.isPressable && !this.contains(pos) && rectContains(this.selectionBoxTransform, pos));\r\n    }\r\n    iPortContains(pos) {\r\n        for (var i = 0; i < this.inputs.length; i++) {\r\n            if (this.inputs[i].contains(pos))\r\n                return i;\r\n        }\r\n        return -1;\r\n    }\r\n    oPortContains(pos) {\r\n        for (var i = 0; i < this.outputs.length; i++) {\r\n            if (this.outputs[i].contains(pos))\r\n                return i;\r\n        }\r\n        return -1;\r\n    }\r\n    setContext(context) {\r\n        this.context = context;\r\n        this.transform.setCamera(this.context.getCamera());\r\n        if (this.selectionBoxTransform != undefined)\r\n            this.selectionBoxTransform.setCamera(this.context.getCamera());\r\n    }\r\n    setTransform(t) {\r\n        this.transform = t;\r\n        this.onTransformChange();\r\n    }\r\n    setPos(v) {\r\n        this.transform.setPos(v);\r\n        this.onTransformChange();\r\n    }\r\n    setAngle(a) {\r\n        this.transform.setAngle(a);\r\n        this.onTransformChange();\r\n    }\r\n    // setRotationAbout(a, c) {\r\n    //     this.transform.rotateAbout(a-this.getAngle(), c);\r\n    //     this.onTransformChange();\r\n    // }\r\n    setRotationAbout(a, c) {\r\n        this.transform.rotateAbout(-this.getAngle(), c);\r\n        this.transform.rotateAbout(a, c);\r\n        this.onTransformChange();\r\n    }\r\n    setName(name) {\r\n        this.name = name;\r\n    }\r\n    getCullBox() {\r\n        return this.cullTransform;\r\n    }\r\n    getInputAmount() {\r\n        return this.inputs.length;\r\n    }\r\n    getImageTint() {\r\n        return this.getCol();\r\n    }\r\n    getCol() {\r\n        return (this.selected ? '#1cff3e' : undefined);\r\n    }\r\n    getBorderColor() {\r\n        return (this.selected ? '#0d7f1f' : undefined);\r\n    }\r\n    getPos() {\r\n        return this.transform.pos.copy();\r\n    }\r\n    getAngle() {\r\n        return this.transform.angle;\r\n    }\r\n    getSize() {\r\n        return this.transform.size;\r\n    }\r\n    getMaxInputFieldCount() {\r\n        return 8;\r\n    }\r\n    getMinInputFieldCount() {\r\n        return 2;\r\n    }\r\n    getName() {\r\n        return this.name;\r\n    }\r\n    getDisplayName() {\r\n        return \"IOObject\";\r\n    }\r\n    getRenderer() {\r\n        return this.context.getRenderer();\r\n    }\r\n    copy() {\r\n        var copy = new this.constructor(this.context);\r\n        copy.transform = this.transform.copy();\r\n        copy.name = this.name;\r\n        if (this.selectionBoxTransform != undefined)\r\n            copy.selectionBoxTransform = this.selectionBoxTransform.copy();\r\n        for (var i = 0; i < this.inputs.length; i++) {\r\n            copy.inputs[i] = this.inputs[i].copy();\r\n            copy.inputs[i].parent = copy;\r\n        }\r\n        for (var i = 0; i < this.outputs.length; i++) {\r\n            copy.outputs[i] = this.outputs[i].copy();\r\n            copy.outputs[i].parent = copy;\r\n        }\r\n        return copy;\r\n    }\r\n    writeTo(node) {\r\n        var objNode = createChildNode(node, this.constructor.getXMLName());\r\n        createTextElement(objNode, \"uid\", this.uid);\r\n        createTextElement(objNode, \"name\", this.getName());\r\n        createTextElement(objNode, \"x\", this.getPos().x);\r\n        createTextElement(objNode, \"y\", this.getPos().y);\r\n        createTextElement(objNode, \"angle\", this.getAngle());\r\n        return objNode;\r\n    }\r\n    load(node) {\r\n        var uid = getIntValue(getChildNode(node, \"uid\"));\r\n        var name = getStringValue(getChildNode(node, \"name\"));\r\n        var x = getFloatValue(getChildNode(node, \"x\"));\r\n        var y = getFloatValue(getChildNode(node, \"y\"));\r\n        var angle = getFloatValue(getChildNode(node, \"angle\"));\r\n        var isOn = getBooleanValue(getChildNode(node, \"isOn\"), false);\r\n        this.uid = uid;\r\n        this.setName(name);\r\n        if (isOn)\r\n            this.click(isOn);\r\n        this.setPos(V(x, y));\r\n        this.setAngle(angle);\r\n        return this;\r\n    }\r\n}\r\n","class SRFlipFlop extends Gate {\r\n    constructor(context, x, y) {\r\n        super(context, false, x, y, undefined);\r\n        this.noChange = true;\r\n        this.setInputAmount(3);\r\n        this.setOutputAmount(2);\r\n        this.transform.setSize(this.transform.size.scale(1.5));\r\n    }\r\n    onTransformChange() {\r\n        this.transform.setSize(V(DEFAULT_SIZE, DEFAULT_SIZE));\r\n        super.onTransformChange();\r\n        this.transform.setSize(V(DEFAULT_SIZE*1.5, DEFAULT_SIZE*1.5));\r\n    }\r\n    activate(x) {\r\n        var on = this.outputs[0].isOn;\r\n\r\n        var set = this.inputs[0].isOn;\r\n        var clock = this.inputs[1].isOn;\r\n        var reset = this.inputs[2].isOn;\r\n        if (clock) {\r\n            if (set && reset) {\r\n                // undefined behavior\r\n            } else if (set) {\r\n                on = true;\r\n            } else if (reset) {\r\n                on = false;\r\n            }\r\n        }\r\n\r\n        super.activate(on, 0);\r\n        super.activate(!on, 1);\r\n    }\r\n    draw() {\r\n        super.draw();\r\n\r\n        var renderer = this.context.getRenderer();\r\n        this.localSpace();\r\n        renderer.rect(0, 0, this.transform.size.x, this.transform.size.y, this.getCol(), this.getBorderColor());\r\n        renderer.restore();\r\n    }\r\n    getDisplayName() {\r\n        return \"SR Flip Flop\";\r\n    }\r\n}\r\nSRFlipFlop.getXMLName = function() { return \"srff\"; }\r\nImporter.types.push(SRFlipFlop);\r\n","class Gate extends IOObject {\r\n    constructor(context, not, x, y, img) {\r\n        super(context, x, y, DEFAULT_SIZE*(img != undefined ? img.ratio : 1), DEFAULT_SIZE, img, false, 512, 512);\r\n        this._not = (not ? true : false);\r\n        this.name = this.getDisplayName();\r\n\r\n        this.setInputAmount(2);\r\n    }\r\n    set not(value) {\r\n        this._not = value;\r\n        if (value)\r\n            this.outputs[0].isOn = !this.isOn;\r\n    }\r\n    get not() {\r\n        return this._not;\r\n    }\r\n    activate(on, i) {\r\n        super.activate((this.not ? !on : on), i);\r\n    }\r\n    draw() {\r\n        super.draw();\r\n\r\n        var renderer = this.context.getRenderer();\r\n\r\n        this.localSpace();\r\n        if (this.not) {\r\n            var l = this.transform.size.x/2+5;\r\n            renderer.circle(l, 0, 5, (this.getCol() == undefined ? '#fff' : this.getCol()), this.getBorderColor(), 2);\r\n        }\r\n        renderer.restore();\r\n    }\r\n    getDisplayName() {\r\n        return \"Gate\";\r\n    }\r\n    copy() {\r\n        var copy = super.copy();\r\n        copy.not = this.not;\r\n        return copy;\r\n    }\r\n    writeTo(node) {\r\n        var gateNode = super.writeTo(node);\r\n        createTextElement(gateNode, \"not\", this.not);\r\n        createTextElement(gateNode, \"inputcount\", this.getInputAmount());\r\n        return gateNode;\r\n    }\r\n    load(node) {\r\n        super.load(node);\r\n        var not = getBooleanValue(getChildNode(node, \"not\"));\r\n        var inputCount = getIntValue(getChildNode(node, \"inputcount\"), 1);\r\n        this.not = not;\r\n        this.setInputAmount(inputCount);\r\n        return this;\r\n    }\r\n}\r\n","class ANDGate extends Gate {\r\n    constructor(context, not, x, y) {\r\n        super(context, not, x, y, images[\"and.svg\"]);\r\n    }\r\n    setInputAmount(target) {\r\n        super.setInputAmount(target);\r\n\r\n        for (var i = 0; i < this.inputs.length; i++) {\r\n            var input = this.inputs[i];\r\n            input.origin = V(-(this.transform.size.x-2)/2, input.origin.y);\r\n        }\r\n    }\r\n    activate(x) {\r\n        var on = true;\r\n        for (var i = 0; i < this.inputs.length; i++)\r\n            on = (on && this.inputs[i].isOn);\r\n        super.activate(on);\r\n    }\r\n    draw() {\r\n        var renderer = this.context.getRenderer();\r\n\r\n        this.localSpace();\r\n        var l1 = -(this.transform.size.y/2)*(0.5-this.inputs.length/2);\r\n        var l2 = -(this.transform.size.y/2)*(this.inputs.length/2-0.5);\r\n\r\n        var s = (this.transform.size.x-2)/2;\r\n        var p1 = V(-s, l1);\r\n        var p2 = V(-s, l2);\r\n\r\n        renderer.line(p1.x, p1.y, p2.x, p2.y, this.getBorderColor(), 2);\r\n        renderer.restore();\r\n\r\n        super.draw();\r\n\r\n    }\r\n    getDisplayName() {\r\n        return this.not ? \"NAND Gate\" : \"AND Gate\";\r\n    }\r\n}\r\nANDGate.getXMLName = function() { return \"andgate\"; }\r\nImporter.types.push(ANDGate);\r\n","class BUFGate extends Gate {\r\n    constructor(context, not, x, y) {\r\n        super(context, not, x, y, images[\"buffer.svg\"]);\r\n        this.maxInputs = 1;\r\n\r\n        this.setInputAmount(1);\r\n        this.activate(false);\r\n    }\r\n    activate(x) {\r\n        var on = false;\r\n        for (var i = 0; i < this.inputs.length; i++)\r\n            on = this.inputs[i].isOn;\r\n        super.activate(on);\r\n    }\r\n    getDisplayName() {\r\n        return this.not ? \"NOT Gate\" : \"Buffer Gate\";\r\n    }\r\n}\r\nBUFGate.getXMLName = function() { return \"bufgate\"; }\r\nImporter.types.push(BUFGate);\r\n","class ORGate extends Gate {\r\n    constructor(context, not, x, y) {\r\n        super(context, not, x, y, images[\"or.svg\"]);\r\n    }\r\n    quadCurveXAt(t) {\r\n        var s = this.transform.size.x/2 - 2;\r\n        var l = this.transform.size.x/5 - 2;\r\n        var t2 = 1 - t;\r\n        return (t2*t2)*(-s) + 2*t*(t2)*(-l) + (t*t)*(-s);\r\n    }\r\n    setInputAmount(target) {\r\n        super.setInputAmount(target);\r\n\r\n        for (var i = 0; i < this.inputs.length; i++) {\r\n            var input = this.inputs[i];\r\n            var t = ((input.origin.y) / this.transform.size.y + 0.5) % 1.0;\r\n            if (t < 0)\r\n                t += 1.0;\r\n            var x = this.quadCurveXAt(t);\r\n            input.origin = V(x, input.origin.y);\r\n        }\r\n    }\r\n    activate(x) {\r\n        var on = false;\r\n        for (var i = 0; i < this.inputs.length; i++)\r\n            on = (on || this.inputs[i].isOn);\r\n        super.activate(on);\r\n    }\r\n    draw() {\r\n        var renderer = this.context.getRenderer();\r\n\r\n        this.localSpace();\r\n        var amt = 2 * Math.floor(this.inputs.length / 4) + 1;\r\n        for (var i = 0; i < amt; i++) {\r\n            var d = (i - Math.floor(amt/2)) * this.transform.size.y;\r\n            var h = 2;\r\n            var l1 = -this.transform.size.y/2;\r\n            var l2 = +this.transform.size.y/2;\r\n\r\n            var s = this.transform.size.x/2 - h;\r\n            var l = this.transform.size.x/5 - h;\r\n\r\n            var p1 = V(-s, l1 + d);\r\n            var p2 = V(-s, l2 + d);\r\n            var c  = V(-l, d);\r\n\r\n            renderer.quadCurve(p1.x, p1.y, p2.x, p2.y, c.x, c.y, this.getBorderColor(), 2);\r\n        }\r\n        renderer.restore();\r\n\r\n        super.draw();\r\n    }\r\n    getDisplayName() {\r\n        return this.not ? \"NOR Gate\" : \"OR Gate\";\r\n    }\r\n}\r\nORGate.getXMLName = function() { return \"orgate\"; }\r\nImporter.types.push(ORGate);\r\n","class XORGate extends Gate {\r\n    constructor(context, not, x, y) {\r\n        super(context, not, x, y, images[\"or.svg\"]);\r\n    }\r\n    quadCurveXAt(t) {\r\n        var s = this.transform.size.x/2 - 2;\r\n        var l = this.transform.size.x/5 - 2;\r\n        var t2 = 1 - t;\r\n        return (t2*t2)*(-s) + 2*t*(t2)*(-l) + (t*t)*(-s);\r\n    }\r\n    setInputAmount(target) {\r\n        super.setInputAmount(target);\r\n\r\n        for (var i = 0; i < this.inputs.length; i++) {\r\n            var input = this.inputs[i];\r\n            var t = ((input.origin.y) / this.transform.size.y + 0.5) % 1.0;\r\n            if (t < 0)\r\n                t += 1.0;\r\n            var x = this.quadCurveXAt(t);\r\n            input.origin = V(x, input.origin.y);\r\n        }\r\n    }\r\n    activate(x) {\r\n        var on = false;\r\n        for (var i = 0; i < this.inputs.length; i++)\r\n            on = (on !== this.inputs[i].isOn);\r\n        super.activate(on);\r\n    }\r\n    draw() {\r\n        super.draw();\r\n\r\n        var renderer = this.context.getRenderer();\r\n\r\n        this.localSpace();\r\n        var amt = 2 * Math.floor(this.inputs.length / 4) + 1;\r\n        for (var i = 0; i < amt; i++) {\r\n            var d = (i - Math.floor(amt/2)) * this.transform.size.y;\r\n            var h = 2;\r\n            var x = 12;\r\n            var l1 = -this.transform.size.y/2;\r\n            var l2 = +this.transform.size.y/2;\r\n\r\n            var s = this.transform.size.x/2 - h;\r\n            var l = this.transform.size.x/5 - h;\r\n\r\n            var p1 = V(-s, l1 + d);\r\n            var p2 = V(-s, l2 + d);\r\n            var c  = V(-l, d);\r\n\r\n            renderer.quadCurve(p1.x, p1.y, p2.x, p2.y, c.x, c.y, this.getBorderColor(), 2);\r\n            renderer.quadCurve(p1.x - x, p1.y, p2.x - x, p2.y, c.x - x, c.y, this.getBorderColor(), 2);\r\n        }\r\n\r\n        renderer.restore();\r\n    }\r\n    getDisplayName() {\r\n        return this.not ? \"XNOR Gate\" : \"XOR Gate\";\r\n    }\r\n    getXMLName() {\r\n        return \"xorgate\";\r\n    }\r\n}\r\nXORGate.getXMLName = function() { return \"xorgate\"; }\r\nImporter.types.push(XORGate);\r\n","// key board input inputs\r\n\r\nclass Button extends IOObject {\r\n    constructor(context, x, y) {\r\n        super(context, x, y, DEFAULT_SIZE, DEFAULT_SIZE, images[\"buttonUp.svg\"], true, 0, 1, 60, 60);\r\n    }\r\n    press() {\r\n        super.activate(true);\r\n        this.img = images[\"buttonDown.svg\"];\r\n    }\r\n    release() {\r\n        super.activate(false);\r\n        this.img = images[\"buttonUp.svg\"];\r\n    }\r\n    contains(pos) {\r\n        return circleContains(this.transform, pos);\r\n    }\r\n    getDisplayName() {\r\n        return \"Button\";\r\n    }\r\n}\r\nButton.getXMLName = function() { return \"button\"; }\r\nImporter.types.push(Button);\r\n","class Clock extends IOObject {\r\n    constructor(context, x, y) {\r\n        super(context, x, y, 60, 60/images[\"clock.svg\"].ratio, images[\"clock.svg\"], false, 0, 1);\r\n        this.frequency = 1000;\r\n        setTimeout(() => this.tick(), this.frequency);\r\n    }\r\n    tick() {\r\n        this.activate(!this.isOn);\r\n        setTimeout(() => this.tick(), this.frequency);\r\n    }\r\n    activate(on) {\r\n        super.activate(on);\r\n        this.img = (on ? images[\"clockOn.svg\"] : images[\"clock.svg\"]);\r\n        render();\r\n    }\r\n    getDisplayName() {\r\n        return \"Clock\";\r\n    }\r\n}\r\nClock.getXMLName = function() { return \"clock\"; }\r\nImporter.types.push(Clock);\r\n","class ConstantHigh extends IOObject {\r\n    constructor(context, x, y) {\r\n        super(context, x, y, DEFAULT_SIZE, DEFAULT_SIZE, images[\"constHigh.svg\"], false, 0, 1);\r\n        super.activate(true);\r\n    }\r\n    getDisplayName() {\r\n        return \"Constant High\";\r\n    }\r\n}\r\nConstantHigh.getXMLName = function() { return \"consthigh\"; }\r\nImporter.types.push(ConstantHigh);\r\n","class ConstantLow extends IOObject {\r\n    constructor(context, x, y) {\r\n        super(context, x, y, DEFAULT_SIZE, DEFAULT_SIZE, images[\"constLow.svg\"], false, 0, 1);\r\n        super.activate(false);\r\n    }\r\n    getDisplayName() {\r\n        return \"Constant Low\";\r\n    }\r\n}\r\nConstantLow.getXMLName = function() { return \"constlow\"; }\r\nImporter.types.push(ConstantLow);\r\n","class Keyboard extends IOObject {\r\n    constructor(context, x, y) {\r\n        super(context, x, y, 3.5*DEFAULT_SIZE, 3.5*DEFAULT_SIZE/images[\"keyboard.svg\"].ratio, images[\"keyboard.svg\"], false, 0, 7);\r\n\r\n        this.setOutputAmount(7);\r\n        for (var i = 0; i < 7; i++) {\r\n            var output = this.outputs[i];\r\n\r\n            var l = -DEFAULT_SIZE/2*(i - 7/2 + 0.5);\r\n            if (i === 0) l -= 1;\r\n            if (i === 7-1) l += 1;\r\n\r\n            output.setOrigin(V(l, 0));\r\n            output.setTarget(V(l, -IO_PORT_LENGTH-(this.transform.size.y-DEFAULT_SIZE)/2));\r\n            output.dir = V(0, -1);\r\n        }\r\n    }\r\n    onKeyDown(code) {\r\n        var code = Keyboard.codeMap[code];\r\n        if (code == undefined)\r\n            return;\r\n\r\n        // Down bit\r\n        this.activate(true, this.outputs.length-1);\r\n\r\n        for (var i = this.outputs.length-2; i >= 0; i--) {\r\n            var num = 1 << i;\r\n            if (num > code) {\r\n                this.outputs[i].activate(false);\r\n            } else {\r\n                this.outputs[i].activate(true);\r\n                code -= num;\r\n            }\r\n        }\r\n    }\r\n    onKeyUp(code) {\r\n        var code = Keyboard.codeMap[code];\r\n        if (code == undefined)\r\n            return;\r\n\r\n        // Up bit\r\n        this.activate(false, this.outputs.length-1);\r\n\r\n        for (var i = this.outputs.length-2; i >= 0; i--) {\r\n            this.outputs[i].activate(false);\r\n            // var num = 1 << i;\r\n            // if (num > code) {\r\n            //     this.outputs[i].activate(false);\r\n            // } else {\r\n            //     this.outputs[i].activate(true);\r\n            //     code -= num;\r\n            // }\r\n        }\r\n    }\r\n    getDisplayName() {\r\n        return \"Keyboard\";\r\n    }\r\n}\r\nKeyboard.getXMLName = function() { return \"keyboard\"; }\r\nImporter.types.push(Keyboard);\r\n\r\nKeyboard.codeMap = [];\r\nKeyboard.codeCount = 0;\r\n\r\nKeyboard.addKey = function(code) {\r\n    Keyboard.codeMap[code] = (++Keyboard.codeCount);\r\n}\r\n\r\n// Add numbers 0-9\r\nfor (var code = 48; code <= 57; code++)\r\n    Keyboard.addKey(code);\r\n\r\n// Add letters a-z\r\nfor (var code = 65; code <= 90; code++)\r\n    Keyboard.addKey(code);\r\n\r\nKeyboard.addKey(32); // Space\r\nKeyboard.addKey(13); // Enter\r\nKeyboard.addKey(8); // Delete\r\nKeyboard.addKey(9); // Tab\r\nKeyboard.addKey(16); // LShift\r\nKeyboard.addKey(17); // LCtrl\r\nKeyboard.addKey(18); // LOption\r\nKeyboard.addKey(91); // LCommand\r\nKeyboard.addKey(20); // Caps lock\r\nKeyboard.addKey(27); // Escape\r\nKeyboard.addKey(192); // Tilda\r\nKeyboard.addKey(189); // Minus\r\nKeyboard.addKey(187); // Plus\r\nKeyboard.addKey(219); // LBracket\r\nKeyboard.addKey(221); // RBracket\r\nKeyboard.addKey(220); // Backslash\r\nKeyboard.addKey(186); // Semicolon\r\nKeyboard.addKey(222); // Quote\r\nKeyboard.addKey(188); // Comma\r\nKeyboard.addKey(190); // Period\r\nKeyboard.addKey(191); // Forwardslash\r\nKeyboard.addKey(37); // Left\r\nKeyboard.addKey(38); // Up\r\nKeyboard.addKey(39); // Right\r\nKeyboard.addKey(40); // Down\r\nKeyboard.addKey(112); // F1\r\nKeyboard.addKey(112); // F2\r\n\r\nconsole.log(Keyboard.codeCount);\r\n","class Switch extends IOObject {\r\n    constructor(context, x, y) {\r\n        super(context, x, y, 60*images[\"switchUp.svg\"].ratio, 60, images[\"switchUp.svg\"], true, 0, 1, 77*images[\"switchUp.svg\"].ratio, 77);\r\n    }\r\n    activate(on) {\r\n        super.activate(on);\r\n        this.img = images[this.isOn ? \"switchDown.svg\" : \"switchUp.svg\"];\r\n    }\r\n    click() {\r\n        super.click();\r\n        this.activate(!this.isOn);\r\n    }\r\n    getDisplayName() {\r\n        return \"Switch\";\r\n    }\r\n    writeTo(node) {\r\n        var switchNode = super.writeTo(node);\r\n        createTextElement(switchNode, \"isOn\", this.outputs[0].isOn);\r\n        return switchNode;\r\n    }\r\n}\r\nSwitch.getXMLName = function() { return \"switch\"; }\r\nImporter.types.push(Switch);\r\n","class Decoder extends Gate {\r\n    constructor(context, x, y) {\r\n        super(context, false, x, y, undefined);\r\n        this.activate(0);\r\n    }\r\n    onTransformChange() {\r\n        this.transform.setSize(V(DEFAULT_SIZE, DEFAULT_SIZE));\r\n        super.onTransformChange();\r\n        this.transform.setSize(V(DEFAULT_SIZE, DEFAULT_SIZE/2*(2 << (this.inputs.length-1))));\r\n    }\r\n    setInputAmount(target) {\r\n        target = clamp(target, 0, 8);\r\n        super.setInputAmount(target);\r\n        super.setOutputAmount(2 << (target-1));\r\n    }\r\n    getInputAmount() {\r\n        return this.inputs.length;\r\n    }\r\n    activate(x) {\r\n        var num = 0;\r\n        for (var i = 0; i < this.inputs.length; i++)\r\n            num = num | ((this.inputs[i].isOn ? 1 : 0) << i);\r\n        for (var i = 0; i < this.outputs.length; i++)\r\n            this.outputs[i].activate(i === num, i);\r\n    }\r\n    draw() {\r\n        super.draw();\r\n\r\n        var renderer = this.context.getRenderer();\r\n        this.localSpace();\r\n        renderer.rect(0, 0, this.transform.size.x, this.transform.size.y, this.getCol(), this.getBorderColor());\r\n        renderer.restore();\r\n    }\r\n    getMinInputFieldCount() {\r\n        return 1;\r\n    }\r\n    getDisplayName() {\r\n        return \"Decoder\";\r\n    }\r\n}\r\nDecoder.getXMLName = function() { return \"decoder\"; }\r\nImporter.types.push(Decoder);\r\n","class Demultiplexer extends Gate {\r\n    constructor(context, x, y) {\r\n        super(context, false, x, y, undefined);\r\n    }\r\n    setInputAmount(target) {\r\n        super.setInputAmount(target + 1);\r\n        super.setOutputAmount(2 << (target-1));\r\n\r\n        var width = Math.max(DEFAULT_SIZE/2*(target-1), DEFAULT_SIZE);\r\n        var height = DEFAULT_SIZE/2*(2 << (target-1));\r\n        this.transform.setSize(V(width+10, height));\r\n\r\n        this.selectLines = [];\r\n        for (var i = 0; i < target; i++) {\r\n            var input = this.inputs[i];\r\n            this.selectLines.push(input);\r\n\r\n            var l = -DEFAULT_SIZE/2*(i - target/2 + 0.5);\r\n            if (i === 0) l -= 1;\r\n            if (i === target-1) l += 1;\r\n\r\n            input.setOrigin(V(l, 0));\r\n            input.setTarget(V(l, IO_PORT_LENGTH+height/2-DEFAULT_SIZE/2));\r\n        }\r\n        for (var i = 0; i < this.outputs.length; i++) {\r\n            var output = this.outputs[i];\r\n\r\n            var l = -DEFAULT_SIZE/2*(i - (this.outputs.length)/2 + 0.5);\r\n            if (i === 0) l -= 1;\r\n            if (i === this.outputs.length-1) l += 1;\r\n\r\n            output.setOrigin(V(0, l));\r\n            output.setTarget(V(IO_PORT_LENGTH+(width/2-DEFAULT_SIZE/2), l));\r\n        }\r\n        var input = this.inputs[this.inputs.length-1];\r\n        input.setOrigin(V(0, 0));\r\n        input.setTarget(V(-IO_PORT_LENGTH-(width/2-DEFAULT_SIZE/2), 0));\r\n    }\r\n    getInputAmount() {\r\n        return this.selectLines.length;\r\n    }\r\n    activate(x) {\r\n        var num = 0;\r\n        for (var i = 0; i < this.selectLines.length; i++) {\r\n            num = num | ((this.selectLines[i].isOn ? 1 : 0) << i);\r\n        }\r\n        super.activate(this.inputs[this.inputs.length-1].isOn, num);\r\n        // var num = 0;\r\n        // for (var i = 0; i < this.selectLines.length; i++)\r\n        //     num = num | ((this.selectLines[i].isOn ? 1 : 0) << i);\r\n        // super.activate(this.inputs[num + this.selectLines.length].isOn);\r\n    }\r\n    draw() {\r\n        super.draw();\r\n\r\n        var renderer = this.context.getRenderer();\r\n        this.localSpace();\r\n\r\n        var p1 = V(this.transform.size.x/2, this.transform.size.y/2);\r\n        var p2 = V(this.transform.size.x/2, -this.transform.size.y/2);\r\n        var p3 = V(-this.transform.size.x/2, -this.transform.size.y/2+20);\r\n        var p4 = V(-this.transform.size.x/2, this.transform.size.y/2-20);\r\n\r\n        renderer.shape([p1, p2, p3, p4], this.getCol(), this.getBorderColor(), 2);\r\n\r\n        renderer.restore();\r\n    }\r\n    getMinInputFieldCount() {\r\n        return 1;\r\n    }\r\n    getDisplayName() {\r\n        return \"Demultiplexer\";\r\n    }\r\n}\r\nDemultiplexer.getXMLName = function() { return \"demux\"; }\r\nImporter.types.push(Demultiplexer);\r\n","class Encoder extends Gate {\r\n    constructor(context, x, y) {\r\n        super(context, false, x, y, undefined);\r\n    }\r\n    onTransformChange() {\r\n        this.transform.setSize(V(DEFAULT_SIZE, DEFAULT_SIZE));\r\n        super.onTransformChange();\r\n        this.transform.setSize(V(DEFAULT_SIZE, DEFAULT_SIZE/2*(2 << (this.outputs.length-1))));\r\n    }\r\n    setInputAmount(target) {\r\n        target = clamp(target, 0, 8);\r\n        super.setInputAmount(2 << (target-1));\r\n        super.setOutputAmount(target);\r\n    }\r\n    getInputAmount() {\r\n        return this.outputs.length;\r\n    }\r\n    activate(x) {\r\n        var indx = -1;\r\n        for (var i = 0; i < this.inputs.length; i++) {\r\n            if (this.inputs[i].isOn) {\r\n                if (indx !== -1)\r\n                    return; // undefined behavior\r\n                indx = i;\r\n            }\r\n        }\r\n        if (indx === -1)\r\n            return; // undefined behavior\r\n        for (var i = this.outputs.length-1; i >= 0; i--) {\r\n            var num = 1 << i;\r\n            if (num > indx) {\r\n                this.outputs[i].activate(false);\r\n            } else {\r\n                this.outputs[i].activate(true);\r\n                indx -= num;\r\n            }\r\n        }\r\n    }\r\n    draw() {\r\n        super.draw();\r\n\r\n        var renderer = this.context.getRenderer();\r\n        this.localSpace();\r\n        renderer.rect(0, 0, this.transform.size.x, this.transform.size.y, this.getCol(), this.getBorderColor());\r\n        renderer.restore();\r\n    }\r\n    getMinInputFieldCount() {\r\n        return 1;\r\n    }\r\n    getDisplayName() {\r\n        return \"Encoder\";\r\n    }\r\n}\r\nEncoder.getXMLName = function() { return \"encoder\"; }\r\nImporter.types.push(Encoder);\r\n","class IC extends IOObject {\r\n    constructor(context, data, x, y) {\r\n        super(context, x, y, 50, 50, undefined, false, 999, 999);\r\n        this.data = data;\r\n        this.setup();\r\n    }\r\n    setup() {\r\n        if (this.data == undefined)\r\n            return;\r\n\r\n        // Setup input and outputs\r\n        this.setInputAmount(this.data.getInputAmount());\r\n        this.setOutputAmount(this.data.getOutputAmount());\r\n\r\n        // Copy object references\r\n        var copy = this.data.copy();\r\n        this.inputObjects = copy.inputs;\r\n        this.outputObjects = copy.outputs;\r\n        this.components = copy.components;\r\n        for (var i = 0; i < this.outputObjects.length; i++) {\r\n            var ii = i;\r\n            var port = this.outputs[i];\r\n            this.outputObjects[i].activate = function(on) {\r\n                port.activate(on);\r\n            }\r\n        }\r\n        this.noChange = true;\r\n\r\n        this.update();\r\n    }\r\n    update() {\r\n        if (this.data == undefined)\r\n            return;\r\n\r\n        // Update size\r\n        this.transform.setWidth(this.data.getWidth());\r\n        this.transform.setHeight(this.data.getHeight());\r\n\r\n        // Update port positions\r\n        for (var i = 0; i < this.inputs.length; i++) {\r\n            this.inputs[i].setOrigin(this.data.iports[i].origin);\r\n            this.inputs[i].setTarget(this.data.iports[i].target);\r\n        }\r\n        for (var i = 0; i < this.outputs.length; i++) {\r\n            this.outputs[i].setOrigin(this.data.oports[i].origin);\r\n            this.outputs[i].setTarget(this.data.oports[i].target);\r\n        }\r\n\r\n        this.activate();\r\n    }\r\n    activate() {\r\n        for (var i = 0; i < this.inputs.length; i++) {\r\n            this.inputObjects[i].activate(this.inputs[i].isOn);\r\n        }\r\n    }\r\n    draw() {\r\n        var renderer = this.context.getRenderer();\r\n\r\n        super.draw();\r\n\r\n        this.localSpace();\r\n\r\n        var size = this.transform.size;\r\n        renderer.rect(0, 0, size.x, size.y, this.getCol(), '#000000', 1);\r\n\r\n        for (var i = 0; i < this.inputs.length; i++) {\r\n            var name = this.inputObjects[i].getName();\r\n            var pos1 = this.transform.toLocalSpace(this.inputs[i].getPos());\r\n            var align = \"center\";\r\n            var padding = 8;\r\n            var ww = renderer.getTextWidth(name)/2;\r\n            var pos = getNearestPointOnRect(V(-size.x/2, -size.y/2), V(size.x/2, size.y/2), pos1);\r\n            pos = pos.sub(pos1).normalize().scale(padding).add(pos);\r\n            pos.x = clamp(pos.x, -size.x/2+padding+ww, size.x/2-padding-ww);\r\n            pos.y = clamp(pos.y, -size.y/2+14, size.y/2-14);\r\n            renderer.text(name, pos.x, pos.y, 0, 0, align);\r\n        }\r\n        for (var i = 0; i < this.outputs.length; i++) {\r\n            var name = this.outputObjects[i].getName();\r\n            var pos1 = this.transform.toLocalSpace(this.outputs[i].getPos());\r\n            var align = \"center\";\r\n            var padding = 8;\r\n            var ww = renderer.getTextWidth(name)/2;\r\n            var pos = getNearestPointOnRect(V(-size.x/2, -size.y/2), V(size.x/2, size.y/2), pos1);\r\n            pos = pos.sub(pos1).normalize().scale(padding).add(pos);\r\n            pos.x = clamp(pos.x, -size.x/2+padding+ww, size.x/2-padding-ww);\r\n            pos.y = clamp(pos.y, -size.y/2+14, size.y/2-14);\r\n            renderer.text(name, pos.x, pos.y, 0, 0, align);\r\n        }\r\n\r\n        renderer.restore();\r\n    }\r\n    getDisplayName() {\r\n        return \"IC\";\r\n    }\r\n    copy() {\r\n        return new IC(this.context, this.data, this.transform.pos.x, this.transform.pos.y);\r\n    }\r\n    writeTo(node) {\r\n        var ICNode = super.writeTo(node);\r\n        createTextElement(ICNode, \"icuid\", this.data.getUID());\r\n        return ICNode;\r\n    }\r\n    load(node, ics) {\r\n        super.load(node);\r\n        var icuid = getIntValue(getChildNode(node, \"icuid\"));\r\n        var data = findIC(icuid, ics);\r\n        this.data = data;\r\n        this.setup();\r\n        return this;\r\n    }\r\n}\r\nIC.getXMLName = function() { return \"ic\"; }\r\nImporter.types.push(IC);\r\n","class ICData {\r\n    constructor(inputs, outputs, components) {\r\n        this.transform = new Transform(V(0,0),V(0,0),0);\r\n        this.inputs = inputs;\r\n        this.outputs = outputs;\r\n        this.components = components;\r\n        this.wires = getAllWires(this.getObjects());\r\n\r\n        this.uidmanager = new UIDManager(this);\r\n\r\n        // Give everything a uid\r\n        var objects = this.getObjects();\r\n        for (var i = 0; i < objects.length; i++)\r\n            this.uidmanager.giveUIDTo(objects[i]);\r\n        for (var i = 0; i < this.wires.length; i++)\r\n            this.uidmanager.giveUIDTo(this.wires[i]);\r\n\r\n        // Set start size based on length of names and amount of ports\r\n        var longestName = 0;\r\n        for (var i = 0; i < this.inputs.length; i++)\r\n            longestName = Math.max(this.inputs[i].getName().length, longestName);\r\n        for (var i = 0; i < this.outputs.length; i++)\r\n            longestName = Math.max(this.outputs[i].getName().length, longestName);\r\n        var w = DEFAULT_SIZE + 20*longestName;\r\n        var h = DEFAULT_SIZE/2*(Math.max(this.inputs.length, this.outputs.length));\r\n        this.transform.setSize(V(w, h));\r\n\r\n        // Create and position ioports\r\n        this.iports = [];\r\n        this.oports = [];\r\n        for (var i = 0; i < this.inputs.length; i++) {\r\n            this.iports[i] = new IPort();\r\n\r\n            var l = -DEFAULT_SIZE/2*(i - (this.inputs.length)/2 + 0.5);\r\n            if (i === 0) l -= 1;\r\n            if (i === this.inputs.length-1) l += 1;\r\n\r\n            this.iports[i].setOrigin(V(0, l));\r\n            this.iports[i].setTarget(V(-IO_PORT_LENGTH-(w/2-DEFAULT_SIZE/2), l));\r\n        }\r\n        for (var i = 0; i < this.outputs.length; i++) {\r\n            this.oports[i] = new OPort();\r\n\r\n            var l = -DEFAULT_SIZE/2*(i - (this.outputs.length)/2 + 0.5);\r\n            if (i === 0) l -= 1;\r\n            if (i === this.outputs.length-1) l += 1;\r\n\r\n            this.oports[i].setOrigin(V(0, l));\r\n            this.oports[i].setTarget(V(IO_PORT_LENGTH+(w/2-DEFAULT_SIZE/2), l));\r\n        }\r\n\r\n        this.recalculatePorts();\r\n    }\r\n    recalculatePorts() {\r\n        var size = this.transform.size;\r\n\r\n        var inputs = this.iports;\r\n        for (var i = 0; i < inputs.length; i++) {\r\n            var inp = inputs[i];\r\n            // Scale by large number to make sure that the target pos is not in the IC\r\n            var targ = this.transform.getMatrix().mul(inp.target);\r\n            var orig = this.transform.getMatrix().mul(inp.origin);\r\n            var pos = targ.add(targ.sub(orig).normalize().scale(10000));\r\n            var p = getNearestPointOnRect(V(-size.x/2, -size.y/2), V(size.x/2, size.y/2), pos);\r\n            var v1 = p.sub(pos).normalize().scale(size.scale(0.5)).add(p);\r\n            var v2 = p.sub(pos).normalize().scale(size.scale(0.5).sub(V(IO_PORT_LENGTH+size.x/2-25, IO_PORT_LENGTH+size.y/2-25))).add(p);\r\n            inp.setOrigin(v1);\r\n            inp.setTarget(v2);\r\n        }\r\n        var outputs = this.oports;\r\n        for (var i = 0; i < outputs.length; i++) {\r\n            var out = outputs[i];\r\n            // Scale by large number to make sure that the target pos is not in the IC\r\n            var targ = this.transform.getMatrix().mul(out.target);\r\n            var orig = this.transform.getMatrix().mul(out.origin);\r\n            var pos = targ.add(targ.sub(orig).normalize().scale(10000));\r\n            var p = getNearestPointOnRect(V(-size.x/2, -size.y/2), V(size.x/2, size.y/2), pos);\r\n            var v1 = p.sub(pos).normalize().scale(size.scale(0.5)).add(p);\r\n            var v2 = p.sub(pos).normalize().scale(size.scale(0.5).sub(V(IO_PORT_LENGTH+size.x/2-25, IO_PORT_LENGTH+size.y/2-25))).add(p);\r\n            out.setOrigin(v1);\r\n            out.setTarget(v2);\r\n        }\r\n    }\r\n    getInputAmount() {\r\n        return this.inputs.length;\r\n    }\r\n    getOutputAmount() {\r\n        return this.outputs.length;\r\n    }\r\n    copy() {\r\n        return separateGroup(copyGroup(this.getObjects()).objects);\r\n    }\r\n    getUID() {\r\n        return this.icuid;\r\n    }\r\n    getObjects() {\r\n        return this.inputs.concat(this.components, this.outputs);\r\n    }\r\n    getWires() {\r\n        return this.wires;\r\n    }\r\n    getWidth() {\r\n        return this.transform.getSize().x;\r\n    }\r\n    getHeight() {\r\n        return this.transform.getSize().y;\r\n    }\r\n}\r\nICData.create = function(objects) {\r\n    objects = copyGroup(objects).objects;\r\n    var separate = separateGroup(objects);\r\n    for (var i = 0; i < separate.inputs.length; i++) {\r\n        var input = separate.inputs[i];\r\n        if (input instanceof Clock && input.getName() === input.getDisplayName())\r\n            input.setName(\">\");\r\n    }\r\n    return new ICData(separate.inputs, separate.outputs, separate.components);\r\n}\r\nICData.add = function(data) {\r\n    data.icuid = ICData.ICs.length;\r\n    ICData.ICs.push(data);\r\n}\r\nICData.redistributeUIDs = function() {\r\n    var ics = [];\r\n    for (var i = 0; i < ICData.ICs.length; i++)\r\n        ics[i] = ICData.ICs[i];\r\n    ICData.ICs = [];\r\n    for (var i = 0; i < ics.length; i++) {\r\n        ics[i].icuid = i;\r\n        ICData.ICs[i] = ics[i];\r\n    }\r\n}\r\nICData.ICs = [];\r\n","class Label extends IOObject {\r\n    constructor(context, x, y) {\r\n        super(context, x, y, 0, 0, undefined, true, 0, 0, 60, 30);\r\n        this.setName(\"LABEL\");\r\n\r\n        this.setInputAmount(0);\r\n        this.setOutputAmount(0);\r\n    }\r\n    activate(x) {\r\n    }\r\n    draw() {\r\n        super.draw();\r\n\r\n        var renderer = this.context.getRenderer();\r\n\r\n        this.localSpace();\r\n\r\n        var align = \"center\";\r\n        var padding = 8;\r\n        var ww = renderer.getTextWidth(this.text)/2;\r\n        var pos = V(0, 0);\r\n        renderer.text(this.name, pos.x, pos.y, 0, 0, align);\r\n\r\n        renderer.restore();\r\n    }\r\n    setName(name) {\r\n        super.setName(name);\r\n        var renderer = this.context.getRenderer();\r\n        var width = renderer.getTextWidth(this.name) + 20;\r\n        this.selectionBoxTransform.setSize(V(width, this.selectionBoxTransform.size.y));\r\n        this.onTransformChange();\r\n        render();\r\n    }\r\n    getDisplayName() {\r\n        return this.name;\r\n    }\r\n}\r\nLabel.getXMLName = function() { return \"label\"; }\r\nImporter.types.push(Label);\r\n","class Multiplexer extends Gate {\r\n    constructor(context, x, y) {\r\n        super(context, false, x, y, undefined);\r\n    }\r\n    setInputAmount(target) {\r\n        super.setInputAmount(target + (2 << (target-1)));\r\n\r\n        var width = Math.max(DEFAULT_SIZE/2*(target-1), DEFAULT_SIZE);\r\n        var height = DEFAULT_SIZE/2*(2 << (target-1));\r\n        this.transform.setSize(V(width+10, height));\r\n\r\n        this.selectLines = [];\r\n        for (var i = 0; i < target; i++) {\r\n            var input = this.inputs[i];\r\n            this.selectLines.push(input);\r\n\r\n            var l = -DEFAULT_SIZE/2*(i - target/2 + 0.5);\r\n            if (i === 0) l -= 1;\r\n            if (i === target-1) l += 1;\r\n\r\n            input.setOrigin(V(l, 0));\r\n            input.setTarget(V(l, IO_PORT_LENGTH+height/2-DEFAULT_SIZE/2));\r\n        }\r\n        for (var ii = target; ii < this.inputs.length; ii++) {\r\n            var input = this.inputs[ii];\r\n\r\n            var i = ii - target;\r\n\r\n            var l = -DEFAULT_SIZE/2*(i - (this.inputs.length-target)/2 + 0.5);\r\n            if (i === 0) l -= 1;\r\n            if (i === this.inputs.length-target-1) l += 1;\r\n\r\n            input.setOrigin(V(0, l));\r\n            input.setTarget(V(-IO_PORT_LENGTH-(width/2-DEFAULT_SIZE/2), l));\r\n        }\r\n        var output = this.outputs[0];\r\n        output.target = V(IO_PORT_LENGTH+(width/2-DEFAULT_SIZE/2), output.target.y);\r\n    }\r\n    getInputAmount() {\r\n        return this.selectLines.length;\r\n    }\r\n    activate(x) {\r\n        var num = 0;\r\n        for (var i = 0; i < this.selectLines.length; i++)\r\n            num = num | ((this.selectLines[i].isOn ? 1 : 0) << i);\r\n        super.activate(this.inputs[num + this.selectLines.length].isOn);\r\n    }\r\n    draw() {\r\n        super.draw();\r\n\r\n        var renderer = this.context.getRenderer();\r\n        this.localSpace();\r\n\r\n        var p1 = V(-this.transform.size.x/2, this.transform.size.y/2);\r\n        var p2 = V(-this.transform.size.x/2, -this.transform.size.y/2);\r\n        var p3 = V(this.transform.size.x/2, -this.transform.size.y/2+20);\r\n        var p4 = V(this.transform.size.x/2, this.transform.size.y/2-20);\r\n\r\n        renderer.shape([p1, p2, p3, p4], this.getCol(), this.getBorderColor(), 2);\r\n\r\n        renderer.restore();\r\n    }\r\n    getMinInputFieldCount() {\r\n        return 1;\r\n    }\r\n    getDisplayName() {\r\n        return \"Multiplexer\";\r\n    }\r\n    getXMLName() {\r\n        return \"mux\";\r\n    }\r\n}\r\nMultiplexer.getXMLName = function() { return \"mux\"; }\r\nImporter.types.push(Multiplexer);\r\n","class LED extends IOObject {\r\n    constructor(context, x, y, color) {\r\n        super(context, x, y, DEFAULT_SIZE, DEFAULT_SIZE, images[\"led.svg\"], false, 1, 0);\r\n        this.transform.setPos(V(this.transform.pos.x, this.transform.pos.y - 2*this.transform.size.y));\r\n        this.color = (color == undefined) ? (\"#ffffff\") : (color);\r\n        this.connectorWidth = 5;\r\n\r\n        this.setInputAmount(1);\r\n        this.inputs[0].setOrigin(V(0, 0));\r\n        this.inputs[0].setTarget(V(0, 2*this.transform.size.y));\r\n        this.inputs[0].lineColor = '#ffffff';\r\n        this.inputs[0].dir = V(0, 1);\r\n    }\r\n    updateCullTransform() {\r\n        super.updateCullTransform();\r\n        if (this.isOn) {\r\n            this.cullTransform.setSize(V(3*this.transform.size.x, 4*this.transform.size.y));\r\n            this.cullTransform.setPos(this.transform.pos.add(V(0, (this.inputs[0].target.y - this.transform.size.y*3/2)/2)));\r\n        }\r\n    }\r\n    activate(on, i) {\r\n        super.activate(on, i);\r\n        this.updateCullTransform();\r\n    }\r\n    getImageTint() {\r\n        return this.color;\r\n    }\r\n    draw() {\r\n        super.draw();\r\n\r\n        var renderer = this.context.getRenderer();\r\n\r\n        this.localSpace();\r\n        if (this.isOn)\r\n            renderer.image(images[\"ledLight.svg\"], 0, 0, 3*this.transform.size.x, 3*this.transform.size.y, this.color);\r\n        renderer.restore();\r\n    }\r\n    getDisplayName() {\r\n        return \"LED\";\r\n    }\r\n    copy() {\r\n        var copy = super.copy();\r\n        copy.color = this.color;\r\n        copy.connectorWidth = this.connectorWidth;\r\n        return copy;\r\n    }\r\n    writeTo(node) {\r\n        var LEDNode = super.writeTo(node);\r\n        createTextElement(LEDNode, \"color\", this.color);\r\n        return LEDNode;\r\n    }\r\n    load(node) {\r\n        super.load(node);\r\n        var color = getStringValue(getChildNode(node, \"color\"));\r\n        this.color = color;\r\n        return this;\r\n    }\r\n}\r\nLED.getXMLName = function() { return \"led\"; }\r\nImporter.types.push(LED);\r\n","class SevenSegmentDisplay extends IOObject {\r\n    constructor(context, x, y) {\r\n        super(context, x, y, 100*7/10, 100, undefined, false, 7, 0);\r\n        this.setInputAmount(7);\r\n        this.noChange = true;\r\n        this.segmentWidth = 45;\r\n        this.segmentHeight = 10;\r\n\r\n        for (var ii = 0; ii < 7; ii++) {\r\n            var iport = this.inputs[ii];\r\n            var i = iport.getIndex();\r\n\r\n            var l = -15*(i - iport.getArray().length/2.0 + 0.5);\r\n\r\n            iport.setOrigin(V(iport.origin.x, l));\r\n            iport.setTarget(V(iport.target.x, l));\r\n        }\r\n        var w = this.transform.size.x;\r\n        var h = this.transform.size.y;\r\n\r\n        var padding = 15;\r\n\r\n        var sw = this.segmentWidth;\r\n        var sh = this.segmentHeight;\r\n\r\n        this.segmentPositions = [V(0, -sw+sh),\r\n                                 V(sw/2-sh/2, (-sw+sh)/2),\r\n                                 V(sw/2-sh/2, (+sw-sh)/2),\r\n                                 V(0, sw-sh),\r\n                                 V(-sw/2+sh/2, (+sw-sh)/2),\r\n                                 V(-sw/2+sh/2, (-sw+sh)/2),\r\n                                 V(0, 0)];\r\n        this.segmentSizes = [V(sw,sh), V(sh,sw), V(sh, sw), V(sw, sh), V(sh, sw), V(sh, sw), V(sw, sh)];\r\n        this.segmentImages = [images[\"segment1.svg\"], images[\"segment2.svg\"], images[\"segment2.svg\"], images[\"segment1.svg\"], images[\"segment2.svg\"], images[\"segment2.svg\"], images[\"segment1.svg\"]];\r\n        this.segmentOnImages = [images[\"segment3.svg\"], images[\"segment4.svg\"], images[\"segment4.svg\"], images[\"segment3.svg\"], images[\"segment4.svg\"], images[\"segment4.svg\"], images[\"segment3.svg\"]];\r\n    }\r\n    draw() {\r\n        super.draw();\r\n\r\n        this.localSpace();\r\n        var renderer = this.context.getRenderer();\r\n        renderer.rect(0, 0, this.transform.size.x, this.transform.size.y, this.getCol(), this.getBorderColor());\r\n\r\n        for (var i = 0; i < 7; i++) {\r\n            var pos = this.segmentPositions[i];\r\n            var size = this.segmentSizes[i];\r\n            var on = this.inputs[i].isOn;\r\n            var img = (on ? this.segmentOnImages[i] : this.segmentImages[i]);\r\n\r\n            renderer.image(img, pos.x, pos.y, size.x, size.y, undefined);\r\n        }\r\n\r\n        renderer.restore();\r\n    }\r\n    getDisplayName() {\r\n        return \"7 Segment Display\";\r\n    }\r\n    getXMLName() {\r\n        return \"sevensegmentdisplay\";\r\n    }\r\n}\r\nSevenSegmentDisplay.getXMLName = function() { return \"sevensegmentdisplay\"; }\r\nImporter.types.push(SevenSegmentDisplay);\r\n","class IOPort {\r\n    constructor(parent, dir) {\r\n        this.isOn = false;\r\n        this.parent = parent;\r\n        this.connections = [];\r\n\r\n        this.lineColor = DEFAULT_BORDER_COLOR;\r\n\r\n        this.origin = V(0, 0);\r\n        this.target = dir.scale(IO_PORT_LENGTH);\r\n        this.dir = dir;\r\n\r\n        this.set = false;\r\n\r\n        if (parent != undefined)\r\n            this.updatePosition();\r\n    }\r\n    getArray() {\r\n    }\r\n    getIndex() {\r\n        for (var i = 0; (i < this.getArray().length) && (this.getArray()[i] !== this); i++);\r\n        return i;\r\n    }\r\n    getCol() {\r\n        return (this.parent.selected || this.selected ? '#1cff3e' : undefined);\r\n    }\r\n    getBorderColor() {\r\n        return (this.parent.selected || this.selected ? '#0d7f1f' : undefined);\r\n    }\r\n    updatePosition() {\r\n        var i = this.getIndex();\r\n\r\n        var l = -this.parent.transform.size.y/2*(i - this.getArray().length/2 + 0.5);\r\n        if (i === 0) l -= 1;\r\n        if (i === this.getArray().length-1) l += 1;\r\n\r\n        this.origin.y = l;\r\n        this.target.y = l;\r\n        this.prevParentLength = this.getArray().length;\r\n    }\r\n    onTransformChange() {\r\n        if (!this.set)\r\n            this.updatePosition();\r\n\r\n        for (var i = 0; i < this.connections.length; i++) {\r\n            if (this.connections[i] != undefined)\r\n                this.connections[i].onTransformChange();\r\n        }\r\n    }\r\n    activate(on) {\r\n    }\r\n    contains(pos) {\r\n        var transform = new Transform(this.target, V(IO_PORT_RADIUS, IO_PORT_RADIUS).scale(2), 0, this.parent.context.getCamera());\r\n        transform.setParent(this.parent.transform);\r\n        return circleContains(transform, pos);\r\n    }\r\n    sContains(pos) {\r\n        var angle = Math.atan2(this.target.y - this.origin.y, this.target.x - this.origin.x);\r\n        var len = this.origin.distanceTo(this.target);\r\n        var pos0 = this.target.add(this.origin).scale(0.5);\r\n        var transform = new Transform(pos0, V(len, IO_PORT_LINE_WIDTH*2), angle, this.parent.context.getCamera());\r\n        transform.setParent(this.parent.transform);\r\n        return rectContains(transform, pos);\r\n    }\r\n    draw() {\r\n        if (!this.set && this.getArray().length !== this.prevParentLength)\r\n            this.updatePosition();\r\n\r\n        var o = this.origin;\r\n        var v = this.target;\r\n        var renderer = this.parent.getRenderer();\r\n\r\n        var lineCol = (this.parent.getBorderColor() ? this.parent.getBorderColor() : this.lineColor);\r\n        renderer.line(o.x, o.y, v.x, v.y, lineCol, IO_PORT_LINE_WIDTH);\r\n\r\n        var circleFillCol = (this.getCol() ? this.getCol() : DEFAULT_FILL_COLOR);\r\n        var circleBorderCol = (this.getBorderColor() ? this.getBorderColor() : DEFAULT_BORDER_COLOR);\r\n        renderer.circle(v.x, v.y, IO_PORT_RADIUS, circleFillCol, circleBorderCol, IO_PORT_BORDER_WIDTH);\r\n    }\r\n    remove() {\r\n    }\r\n    setOrigin(v) {\r\n        this.origin.x = v.x;\r\n        this.origin.y = v.y;\r\n        this.set = true;\r\n        if (this.parent != undefined)\r\n            this.parent.onTransformChange();\r\n    }\r\n    setTarget(v) {\r\n        this.target.x = v.x;\r\n        this.target.y = v.y;\r\n        this.set = true;\r\n        if (this.parent != undefined)\r\n            this.parent.onTransformChange();\r\n    }\r\n    getPos() {\r\n        return this.parent.transform.getMatrix().mul(this.target);\r\n    }\r\n    getOPos() {\r\n        return this.parent.transform.getMatrix().mul(this.origin);\r\n    }\r\n    getDir() {\r\n        return this.parent.transform.getMatrix().mul(this.dir).sub(this.parent.getPos()).normalize();\r\n    }\r\n    get uid() {\r\n        return this.parent.uid;\r\n    }\r\n    setName(n) {\r\n    }\r\n    setPos() {\r\n    }\r\n    getInputAmount() {\r\n        return 1;\r\n    }\r\n    getMaxInputFieldCount() {\r\n        return 1;\r\n    }\r\n    getMinInputFieldCount() {\r\n        return 1;\r\n    }\r\n    getName() {\r\n        return this.getDisplayName();\r\n    }\r\n    getDisplayName() {\r\n        return \"ioport\";\r\n    }\r\n    getXMLName() {\r\n        return this.getDisplayName().toLowerCase().replace(/\\s+/g, '');\r\n    }\r\n    copy() {\r\n        var port = new this.constructor();\r\n        port.origin = this.origin.copy();\r\n        port.target = this.target.copy();\r\n        port.set = this.set;\r\n        port.lineColor = this.lineColor;\r\n        return port;\r\n    }\r\n    writeTo(node) {\r\n        var ioPortNode = createChildNode(node, this.getXMLName());\r\n        createTextElement(ioPortNode, \"originx\", this.origin.x);\r\n        createTextElement(ioPortNode, \"originy\", this.origin.y);\r\n        createTextElement(ioPortNode, \"targetx\", this.target.x);\r\n        createTextElement(ioPortNode, \"targety\", this.target.y);\r\n    }\r\n    load(node) {\r\n        var originx = getFloatValue(getChildNode(node, \"originx\"));\r\n        var originy = getFloatValue(getChildNode(node, \"originy\"));\r\n        var targetx = getFloatValue(getChildNode(node, \"targetx\"));\r\n        var targety = getFloatValue(getChildNode(node, \"targety\"));\r\n        this.setOrigin(V(originx, originy));\r\n        this.setTarget(V(targetx, targety));\r\n        return this;\r\n    }\r\n}\r\n","class IPort extends IOPort {\r\n    constructor(parent) {\r\n        super(parent, V(-1, 0))\r\n    }\r\n    getArray() {\r\n        return this.parent.inputs;\r\n    }\r\n    set input(obj) {\r\n        if (obj == undefined)\r\n            this.connections = [];\r\n        else\r\n            this.connections[0] = obj;\r\n    }\r\n    get input() {\r\n        if (this.connections.length > 0)\r\n            return this.connections[0];\r\n        else\r\n            return undefined;\r\n    }\r\n    activate(on) {\r\n        if (this.isOn === on)\r\n            return;\r\n\r\n        this.isOn = on;\r\n        this.parent.context.propogate(this, this.parent, this.isOn);\r\n    }\r\n    remove() {\r\n        if (this.input != undefined)\r\n            this.input.disconnect(this);\r\n    }\r\n    getDisplayName() {\r\n        return \"iport\";\r\n    }\r\n}\r\n","class OPort extends IOPort {\r\n    constructor(parent) {\r\n        super(parent, V(1, 0));\r\n    }\r\n    getArray() {\r\n        return this.parent.outputs;\r\n    }\r\n    activate(on) {\r\n        if (this.isOn === on)\r\n            return;\r\n\r\n        this.isOn = on;\r\n        for (var i = 0; i < this.connections.length; i++)\r\n            this.parent.context.propogate(this, this.connections[i], this.isOn);\r\n    }\r\n    remove() {\r\n        for (var i = 0; i < this.connections.length; i++)\r\n            this.disconnect(this.connections[i]);\r\n    }\r\n    connect(wire) {\r\n        this.connections.push(wire);\r\n        wire.input = this;\r\n        wire.onTransformChange();\r\n        wire.activate(this.isOn);\r\n        return true;\r\n    }\r\n    disconnect(obj) {\r\n        for (var i = 0; (i < this.connections.length) && (this.connections[i] !== obj); i++);\r\n        this.connections[i].input = undefined;\r\n        this.connections.splice(i, 1);\r\n    }\r\n    getDisplayName() {\r\n        return \"oport\";\r\n    }\r\n}\r\n","class Wire {\r\n    constructor(context) {\r\n        this.context = context;\r\n\r\n        this.input = undefined;\r\n        this.connection = undefined;\r\n\r\n        this.curve = new BezierCurve(V(0,0),V(0,0),V(0,0),V(0,0));\r\n        this.isOn = false;\r\n        this.set = false; // Manually set bezier control points\r\n\r\n        this.straight = false;\r\n        this.dirty = true;\r\n        this.boundingBox = new Transform(0,0,0,context.getCamera());\r\n    }\r\n    activate(on) {\r\n        if (this.isOn === on)\r\n            return;\r\n\r\n        this.isOn = on;\r\n        if (this.connection != undefined)\r\n            this.connection.activate(on);\r\n    }\r\n    split(t) {\r\n        var pos = this.curve.getPos(t);\r\n\r\n        var wire = new Wire(this.context);\r\n\r\n        var prevConnection = this.connection;\r\n        this.disconnect();\r\n\r\n        var port = new WirePort(this.context);\r\n        this.connect(port);\r\n        wire.connect(prevConnection);\r\n        port.connect(wire);\r\n\r\n        this.connection.setPos(pos);\r\n\r\n        getCurrentContext().addObject(port);\r\n        getCurrentContext().addWire(wire);\r\n    }\r\n    updateBoundingBox() {\r\n        if (!this.dirty)\r\n            return;\r\n        this.dirty = false;\r\n\r\n        var end1 = this.getPos(0);\r\n        var end2 = this.getPos(1);\r\n        var min = V(Math.min(end1.x, end2.x), Math.min(end1.y, end2.y));\r\n        var max = V(Math.max(end1.x, end2.x), Math.max(end1.y, end2.y));\r\n        this.boundingBox.setSize(V(max.x - min.x + 2, max.y - min.y + 2));\r\n        this.boundingBox.setPos(V((max.x - min.x)/2 + min.x, (max.y - min.y)/2 + min.y));\r\n    }\r\n    onTransformChange() {\r\n        if (this.input != undefined) {\r\n            var pos = this.input.getPos();\r\n            if (this.set) {\r\n                this.curve.c1.x += pos.x - this.curve.p1.x;\r\n                this.curve.c1.y += pos.y - this.curve.p1.y;\r\n            } else {\r\n                var dir = (this.input instanceof WirePort ? this.input.getODir() : this.input.getDir());\r\n                var c = dir.scale(DEFAULT_SIZE).add(pos);\r\n                this.curve.c1.x = c.x;\r\n                this.curve.c1.y = c.y;\r\n            }\r\n            this.curve.p1.x = pos.x;\r\n            this.curve.p1.y = pos.y;\r\n            this.curve.dirty = true;\r\n            this.dirty = true;\r\n        }\r\n        if (this.connection != undefined) {\r\n            var pos = this.connection.getPos();\r\n            if (this.set) {\r\n                this.curve.c2.x += pos.x - this.curve.p2.x;\r\n                this.curve.c2.y += pos.y - this.curve.p2.y;\r\n            } else {\r\n                var dir = this.connection.getDir();\r\n                var c = dir.scale(DEFAULT_SIZE).add(pos);\r\n                this.curve.c2.x = c.x;\r\n                this.curve.c2.y = c.y;\r\n            }\r\n            this.curve.p2.x = pos.x;\r\n            this.curve.p2.y = pos.y;\r\n            this.curve.dirty = true;\r\n            this.dirty = true;\r\n        }\r\n    }\r\n    connect(obj) {\r\n        if (this.connection != undefined || obj.input != undefined)\r\n            return false;\r\n\r\n        this.connection = obj;\r\n        obj.input = this;\r\n        this.onTransformChange();\r\n        obj.activate(this.isOn);\r\n\r\n        return true;\r\n    }\r\n    disconnect() {\r\n        if (this.connection == undefined)\r\n            return false;\r\n\r\n        this.connection.input = undefined;\r\n        this.connection.activate(false);\r\n        this.connection = undefined;\r\n    }\r\n    draw() {\r\n        var renderer = this.context.getRenderer();\r\n        var camera = this.context.getCamera();\r\n\r\n        var color = (this.isOn ? '#3cacf2' : (this.selected ? '#1cff3e' : DEFAULT_FILL_COLOR));\r\n        if (this.straight) {\r\n            var p1 = camera.getScreenPos(this.curve.p1);\r\n            var p2 = camera.getScreenPos(this.curve.p2);\r\n            renderer.line(p1.x, p1.y, p2.x, p2.y, color, 7 / camera.zoom);\r\n        } else {\r\n            this.curve.draw(color, 7 / camera.zoom, renderer);\r\n        }\r\n    }\r\n    remove() {\r\n        this.context.remove(this);\r\n        if (this.input != undefined)\r\n            this.input.disconnect(this);\r\n        if (this.connection != undefined)\r\n            this.disconnect(this.connection);\r\n    }\r\n    contains(pos) {\r\n        return this.curve.getNearestT(pos.x, pos.y) !== -1;\r\n    }\r\n    setName(n) {\r\n    }\r\n    setPos() {\r\n    }\r\n    getPos(t) {\r\n        if (t == undefined)\r\n            t = 0.5;\r\n        return this.curve.getPos(t);\r\n    }\r\n    getNearestT(mx, my) {\r\n        return (this.straight) ? (getNearestT(this.curve.p1, this.curve.p2, mx, my)) : (this.curve.getNearestT(mx, my));\r\n    }\r\n    getCullBox() {\r\n        return (this.straight) ? (this.getBoundingBox()) : (this.curve.getBoundingBox());\r\n    }\r\n    getBoundingBox() {\r\n        if (!this.straight)\r\n            return undefined;\r\n\r\n        this.updateBoundingBox();\r\n        return this.boundingBox;\r\n    }\r\n    getInputAmount() {\r\n        return 1;\r\n    }\r\n    getMaxInputFieldCount() {\r\n        return 1;\r\n    }\r\n    getMinInputFieldCount() {\r\n        return 1;\r\n    }\r\n    getName() {\r\n        return this.getDisplayName();\r\n    }\r\n    getDisplayName() {\r\n        return \"Wire\";\r\n    }\r\n    copy() {\r\n        var copy = new Wire(this.context);\r\n        copy.curve = this.curve.copy();\r\n        copy.straight = this.straight;\r\n        return copy;\r\n    }\r\n    writeTo(node, objects, wires) {\r\n        var wireNode = createChildNode(node, \"wire\");\r\n\r\n        createTextElement(wireNode, \"uid\", this.uid);\r\n\r\n        var inputNode = createChildNode(wireNode, \"input\");\r\n        createTextElement(inputNode, \"uid\", this.input.uid);\r\n        createTextElement(inputNode, \"index\", this.input.getIndex());\r\n\r\n        var connectionNode = createChildNode(wireNode, \"connection\");\r\n        createTextElement(connectionNode, \"uid\", this.connection.uid);\r\n        createTextElement(connectionNode, \"index\", this.connection.getIndex());\r\n\r\n        this.curve.writeTo(wireNode);\r\n\r\n        createTextElement(wireNode, \"straight\", this.straight);\r\n    }\r\n    load(node) {\r\n        var objects = this.context.getObjects();\r\n        var wires = this.context.getWires();\r\n\r\n        var uid = getIntValue(getChildNode(node, \"uid\"));\r\n        this.uid = uid;\r\n\r\n        var bezier = getChildNode(node, \"bezier\");\r\n        this.curve.load(bezier);\r\n\r\n        var straight = getBooleanValue(getChildNode(node, \"straight\"));\r\n        this.straight = straight;\r\n\r\n        return this;\r\n    }\r\n    loadConnections(node, objects) {\r\n        var inputNode = getChildNode(node, \"input\");\r\n        var sourceUID = getIntValue(getChildNode(inputNode, \"uid\"));\r\n        var sourceIndx = getIntValue(getChildNode(inputNode, \"index\"));\r\n        var source = findByUID(objects, sourceUID);\r\n        source = (source instanceof WirePort ? source : source.outputs[sourceIndx]);\r\n\r\n        var connectionNode = getChildNode(node, \"connection\");\r\n        var targetUID = getIntValue(getChildNode(connectionNode, \"uid\"));\r\n        var targetIndx = getIntValue(getChildNode(connectionNode, \"index\"));\r\n        var target = findByUID(objects, targetUID);\r\n        console.log(targetUID);\r\n        console.log(targetIndx);\r\n        console.log(target);\r\n        target = (target instanceof WirePort ? target : target.inputs[targetIndx]);\r\n\r\n        source.connect(this);\r\n        this.connect(target);\r\n    }\r\n}\r\n","class WirePort extends IOObject {\r\n    constructor(context) {\r\n        super(context, 0, 0, 2*IO_PORT_RADIUS, 2*IO_PORT_RADIUS);\r\n        this._input = undefined;\r\n        this.connection = undefined;\r\n        this.isOn = false;\r\n        this.selected = false;\r\n        this.hasSetTransform = false;\r\n    }\r\n    set input(input) {\r\n        this._input = input;\r\n        if (!this.hasSetTransform) {\r\n            this.hasSetTransform = true;\r\n            this.transform = new Transform(input.curve.p2.copy(), V(15,15), 0, this.context.getCamera());\r\n        }\r\n    }\r\n    get input() {\r\n        return this._input;\r\n    }\r\n    activate(on) {\r\n        if (this.isOn === on)\r\n            return;\r\n\r\n        this.isOn = on;\r\n        if (this.connection != undefined)\r\n            this.connection.activate(on);\r\n    }\r\n    remove() {\r\n        this.context.remove(this);\r\n        if (this.input != undefined)\r\n            this.input.disconnect(this);\r\n        if (this.connection != undefined)\r\n            this.disconnect(this.connection);\r\n    }\r\n    setTransform(t) {\r\n        this.transform = t;\r\n        this.setPos(t.pos);\r\n    }\r\n    onTransformChange() {\r\n        if (this.input != undefined)\r\n            this.input.onTransformChange();\r\n        if (this.connection != undefined)\r\n            this.connection.onTransformChange();\r\n    }\r\n    connect(wire) {\r\n        if (this.connection != undefined)\r\n            return false;\r\n\r\n        this.connection = wire;\r\n        wire.input = this;\r\n        wire.onTransformChange();\r\n        wire.activate(this.isOn);\r\n\r\n        return true;\r\n    }\r\n    disconnect() {\r\n        if (this.connection == undefined)\r\n            return;\r\n\r\n        this.connection.input = undefined;\r\n        this.connection = undefined;\r\n    }\r\n    draw() {\r\n        var renderer = this.context.getRenderer();\r\n        var camera = this.context.getCamera();\r\n\r\n        var v = camera.getScreenPos(this.getPos());\r\n        renderer.circle(v.x, v.y, 7 / camera.zoom, (this.selected ? '#1cff3e' : '#ffffff'), (this.selected ? '#0d7f1f' : '#000000'), 1 / camera.zoom);\r\n    }\r\n    contains(pos) {\r\n        return circleContains(this.transform, pos);\r\n    }\r\n    sContains(pos) {\r\n        return this.contains(pos);\r\n    }\r\n    setPos(v) {\r\n        if (this.input != undefined && this.connection != undefined) {\r\n            // Snap to end points of wires\r\n            this.input.straight = false;\r\n            this.connection.straight = false;\r\n            v.x = snap(this.input, v.x, this.input.curve.p1.x);\r\n            v.y = snap(this.input, v.y, this.input.curve.p1.y);\r\n            v.x = snap(this.connection, v.x, this.connection.curve.p2.x);\r\n            v.y = snap(this.connection, v.y, this.connection.curve.p2.y);\r\n        }\r\n\r\n        super.setPos(v);\r\n    }\r\n    getIndex() {\r\n        return 0;\r\n    }\r\n    getDir() {\r\n        return this.transform.getMatrix().mul(V(-1, 0)).sub(this.transform.pos).normalize();\r\n    }\r\n    getODir() {\r\n        return this.transform.getMatrix().mul(V(1, 0)).sub(this.transform.pos).normalize();\r\n    }\r\n    getCullBox() {\r\n        return this.transform;\r\n    }\r\n    getInputAmount() {\r\n        return 1;\r\n    }\r\n    getName() {\r\n        return this.getDisplayName();\r\n    }\r\n    getDisplayName() {\r\n        return \"Port\";\r\n    }\r\n}\r\nWirePort.getXMLName = function() { return \"port\"; }\r\nImporter.types.push(WirePort);\r\n\r\nfunction snap(wire, x, c) {\r\n    if (Math.abs(x - c) <= WIRE_SNAP_THRESHOLD) {\r\n        wire.straight = true;\r\n        return c;\r\n    }\r\n    return x;\r\n}\r\n","class CircuitDesigner {\r\n    constructor(canvas, vw, vh) {\r\n        this.renderer = new Renderer(this, canvas, vw, vh);\r\n        this.camera = new Camera(this);\r\n        this.history = new HistoryManager();\r\n\r\n        this.wires = [];\r\n        this.objects = [];\r\n\r\n        this.propogationQueue = [];\r\n\r\n        window.addEventListener('resize', e => this.resize(), false);\r\n\r\n        this.resize();\r\n    }\r\n    reset() {\r\n        for (var i = 0; i < this.objects.length; i++)\r\n            this.objects[i].remove();\r\n        for (var i = 0; i < this.wires.length; i++)\r\n            this.wires[i].remove();\r\n        this.objects = [];\r\n        this.wires = [];\r\n        this.propogationQueue = [];\r\n    }\r\n    propogate(sender, receiver, signal) {\r\n        this.propogationQueue.push(new Propogation(sender, receiver, signal, () => this.update(sender, receiver)));//() => this.update()));\r\n    }\r\n    update(sender, receiver) {\r\n        var tempQueue = [];\r\n        while (this.propogationQueue.length > 0)\r\n            tempQueue.push(this.propogationQueue.pop());\r\n\r\n        while (tempQueue.length > 0)\r\n            tempQueue.pop().send();\r\n\r\n        if (this.propogationQueue.length > 0)\r\n            updateRequests++;\r\n\r\n        updateRequests--;\r\n\r\n        console.log(\"update\");\r\n\r\n        // See if the sender/receiver is a wire in the scene (not in an IC) to render\r\n        var inScene = false;\r\n        if (sender instanceof Wire || receiver instanceof Wire) {\r\n            for (var i = 0; i < this.wires.length; i++) {\r\n                if (this.wires[i] === sender || this.wires[i] === receiver) {\r\n                    inScene = true;\r\n                    break;\r\n                }\r\n            }\r\n        } else {\r\n            render();\r\n        }\r\n\r\n        if (inScene)\r\n            render();\r\n\r\n        if (updateRequests > 0) {\r\n            setTimeout(() => this.update(sender, receiver), PROPOGATION_TIME);\r\n        }\r\n    }\r\n    render() {\r\n        // console.log(\"RENDER\");\r\n\r\n        this.renderer.clear();\r\n\r\n        var step = GRID_SIZE/this.camera.zoom;\r\n\r\n        var cpos = V(this.camera.pos.x/this.camera.zoom - this.renderer.canvas.width/2, this.camera.pos.y/this.camera.zoom - this.renderer.canvas.height/2);\r\n\r\n        var cpx = cpos.x - Math.floor(cpos.x / step) * step;\r\n        if (cpx < 0) cpx += step;\r\n        var cpy = cpos.y - Math.floor(cpos.y / step) * step;\r\n        if (cpy < 0) cpy += step;\r\n\r\n        // Batch-render the lines = uglier code + way better performance\r\n        this.renderer.save();\r\n        this.renderer.setStyles(undefined, '#999', 1 / this.camera.zoom);\r\n        this.renderer.context.beginPath();\r\n        for (var x = -cpx; x <= this.renderer.canvas.width-cpx+step; x += step) {\r\n            this.renderer._line(x, 0, x, this.renderer.canvas.height);\r\n        }\r\n        for (var y = -cpy; y <= this.renderer.canvas.height-cpy+step; y += step) {\r\n            this.renderer._line(0, y, this.renderer.canvas.width, y);\r\n        }\r\n        this.renderer.context.closePath();\r\n        this.renderer.context.stroke();\r\n        this.renderer.restore();\r\n\r\n        // Cull objects/wires if they aren't on the screen\r\n        for (var i = 0; i < this.wires.length; i++) {\r\n            if (this.camera.cull(this.wires[i].getCullBox()))\r\n                this.wires[i].draw();\r\n        }\r\n        for (var i = 0; i < this.objects.length; i++) {\r\n            if (this.camera.cull(this.objects[i].getCullBox()))\r\n                this.objects[i].draw();\r\n        }\r\n\r\n        CurrentTool.draw(this.renderer);\r\n    }\r\n    resize() {\r\n        this.renderer.resize();\r\n        this.camera.resize();\r\n\r\n        render();\r\n    }\r\n    addObject(o) {\r\n        if (this.getIndexOfObject(o) === -1)\r\n            this.objects.push(o);\r\n        else\r\n            console.error(\"Attempted to add an object that already existed!\");\r\n    }\r\n    addWire(w) {\r\n        if (this.getIndexOfWire(w) === -1)\r\n            this.wires.push(w);\r\n        else\r\n            console.error(\"Attempted to add a wire that already existed!\");\r\n    }\r\n    getRenderer() {\r\n        return this.renderer;\r\n    }\r\n    getObjects() {\r\n        return this.objects;\r\n    }\r\n    getWires() {\r\n        return this.wires;\r\n    }\r\n    getIndexOfObject(obj) {\r\n        for (var i = 0; i < this.objects.length; i++) {\r\n            if (obj === this.objects[i])\r\n                return i;\r\n        }\r\n        return -1;\r\n    }\r\n    getIndexOfWire(wire) {\r\n        for (var i = 0; i < this.wires.length; i++) {\r\n            if (wire === this.wires[i])\r\n                return i;\r\n        }\r\n        return -1;\r\n    }\r\n}\r\n","class ICDesigner {\r\n    constructor() {\r\n        this.canvas = document.getElementById(\"designer-canvas\");\r\n\r\n        this.designer = new CircuitDesigner(this.canvas, 0.84, 0.76);\r\n        this.context = new Context(this.designer);\r\n\r\n        this.ic = undefined;\r\n        this.data = undefined;\r\n\r\n        this.drag = false;\r\n        this.dragObj = undefined;\r\n\r\n        this.dragEdge = undefined;\r\n        \r\n        this.disabled = true;\r\n\r\n        this.confirmButton = document.getElementById(\"ic-confirmbutton\");\r\n        this.cancelButton = document.getElementById(\"ic-cancelbutton\");\r\n\r\n        this.hide();\r\n    }\r\n    confirm() {\r\n        if (this.ic != undefined) {\r\n            ICData.add(this.data);\r\n            var out = this.ic.copy();\r\n            out.setContext(context);\r\n            context.getDesigner().addObject(out);\r\n            this.hide();\r\n        }\r\n    }\r\n    cancel() {\r\n        if (this.ic != undefined) {\r\n            this.hide();\r\n        }\r\n    }\r\n    show(selections) {\r\n        currentContext = this.context;\r\n        this.disabled = false;\r\n        TransformController.disabled = true;\r\n        WireController.disabled = true;\r\n        SelectionBox.disabled = true;\r\n        \r\n        this.hidden = false;\r\n        this.canvas.style.visibility = \"visible\";\r\n        this.confirmButton.style.visibility = \"visible\";\r\n        this.cancelButton.style.visibility = \"visible\";\r\n        if (ItemNavController.isOpen)\r\n            ItemNavController.toggle();\r\n        popup.hide();\r\n\r\n        this.data = ICData.create(selections);\r\n        this.ic = new IC(this.context, this.data, 0, 0);\r\n\r\n        this.designer.addObject(this.ic);\r\n        selectionTool.deselectAll();\r\n        this.context.getCamera().zoom = 0.5 + 0.1*(this.ic.transform.size.x-50)/20;\r\n        render();\r\n    }\r\n    hide() {\r\n        currentContext = context;\r\n        this.disabled = true;\r\n        TransformController.disabled = false;\r\n        WireController.disabled = false;\r\n        SelectionBox.disabled = false;\r\n        \r\n        this.hidden = true;\r\n        this.canvas.style.visibility = \"hidden\";\r\n        this.confirmButton.style.visibility = \"hidden\";\r\n        this.cancelButton.style.visibility = \"hidden\";\r\n        if (this.ic != undefined) {\r\n            this.ic.remove();\r\n            this.ic = undefined;\r\n            this.data = undefined;\r\n        }\r\n        render();\r\n    }\r\n    onMouseDown() {\r\n        if (this.ic == undefined)\r\n            return false;\r\n\r\n        var worldMousePos = Input.getWorldMousePos();\r\n\r\n        var inputs = this.ic.inputs;\r\n        for (var i = 0; i < inputs.length; i++) {\r\n            var inp = inputs[i];\r\n            if (inp.sContains(worldMousePos)) {\r\n                this.drag = true;\r\n                this.dragObj = this.data.iports[i];\r\n                return true;\r\n            }\r\n        }\r\n        var outputs = this.ic.outputs;\r\n        for (var i = 0; i < outputs.length; i++) {\r\n            var out = outputs[i];\r\n            if (out.sContains(worldMousePos)) {\r\n                this.drag = true;\r\n                this.dragObj = this.data.oports[i];\r\n                return true;\r\n            }\r\n        }\r\n\r\n        var pos = this.ic.getPos();\r\n        var size = this.ic.getSize();\r\n        var transform1 = new Transform(pos, size.scale(1.2), 0, this.context.getCamera());\r\n        var transform2 = new Transform(pos, size.scale(0.8), 0, this.context.getCamera());\r\n        if (rectContains(transform1, worldMousePos) && !rectContains(transform2, worldMousePos)) {\r\n            if (worldMousePos.y < pos.y+size.y/2-4 && worldMousePos.y > pos.y-size.y/2+4) {\r\n                this.dragEdge = \"horizontal\";\r\n            } else {\r\n                this.dragEdge = \"vertical\";\r\n            }\r\n            return true;\r\n        }\r\n    }\r\n    onMouseUp() {\r\n        if (this.ic == undefined)\r\n            return false;\r\n\r\n        this.drag = false;\r\n        this.dragObj = undefined;\r\n        this.dragEdge = undefined;\r\n    }\r\n    onMouseMove() {\r\n        if (this.ic == undefined)\r\n            return false;\r\n\r\n        var worldMousePos = Input.getWorldMousePos();\r\n\r\n        if (this.drag) {\r\n            var size = this.ic.getSize();\r\n            var p = getNearestPointOnRect(V(-size.x/2, -size.y/2), V(size.x/2, size.y/2), worldMousePos);\r\n            var v1 = p.sub(worldMousePos).normalize().scale(size.scale(0.5)).add(p);\r\n            var v2 = p.sub(worldMousePos).normalize().scale(size.scale(0.5).sub(V(IO_PORT_LENGTH+size.x/2-25, IO_PORT_LENGTH+size.y/2-25))).add(p);\r\n            this.dragObj.setOrigin(v1);\r\n            this.dragObj.setTarget(v2);\r\n\r\n            this.ic.update();\r\n\r\n            return true;\r\n        }\r\n        if (this.dragEdge != undefined) {\r\n            if (this.dragEdge === \"horizontal\") {\r\n                this.data.transform.setWidth(Math.abs(2*worldMousePos.x));\r\n            } else {\r\n                this.data.transform.setHeight(Math.abs(2*worldMousePos.y));\r\n            }\r\n            this.data.recalculatePorts();\r\n\r\n            this.ic.update();\r\n\r\n            return true;\r\n        }\r\n    }\r\n    onClick() {\r\n    }\r\n}\r\n","\r\nvar images = [];\r\n\r\nvar popup;\r\nvar contextmenu;\r\nvar icdesigner;\r\n\r\nvar context;\r\n\r\nvar currentContext;\r\n\r\nvar browser = getBrowser();\r\n\r\nvar saved = true;\r\n\r\n// Prompt for exit\r\nwindow.onbeforeunload = function(e) {\r\n    if (!saved) {\r\n        var dialogText = \"You have unsaved changes.\";\r\n        e.returnValue = dialogText;\r\n        return dialogText;\r\n    }\r\n};\r\n\r\nfunction start() {\r\n    var designer = new CircuitDesigner(document.getElementById(\"canvas\"));\r\n    context = new Context(designer);\r\n    currentContext = context;\r\n\r\n    popup = new SelectionPopup();\r\n    icdesigner = new ICDesigner();\r\n    contextmenu = new ContextMenu();\r\n\r\n    Input.registerContext(context);\r\n    Input.registerContext(icdesigner.context);\r\n    Input.addMouseListener(icdesigner);\r\n    Input.addMouseListener(TransformController);\r\n    Input.addMouseListener(WireController);\r\n    Input.addMouseListener(SelectionBox);\r\n\r\n    selectionTool.activate();\r\n\r\n    loadImage(images,\r\n        [\"constLow.svg\", \"constHigh.svg\",\r\n         \"buttonUp.svg\", \"buttonDown.svg\",\r\n         \"switchUp.svg\", \"switchDown.svg\",\r\n         \"led.svg\", \"ledLight.svg\",\r\n         \"buffer.svg\", \"and.svg\",\r\n         \"or.svg\", \"xor.svg\",\r\n         \"segment1.svg\", \"segment2.svg\",\r\n         \"segment3.svg\", \"segment4.svg\",\r\n         \"clock.svg\", \"clockOn.svg\",\r\n         \"keyboard.svg\", \"base.svg\"], 0, onFinishLoading);\r\n}\r\n\r\nfunction wire(source, target) {\r\n    var wire = new Wire(getCurrentContext(), source);\r\n    source.connect(wire);\r\n    wire.connect(target);\r\n}\r\n\r\nfunction reset() {\r\n    ICData.ICs = [];\r\n    currentContext = context;\r\n    context.reset();\r\n}\r\n\r\nfunction onFinishLoading() {\r\n    render();\r\n}\r\n\r\nvar renderQueue = 0;\r\n\r\nfunction render() {\r\n    if (renderQueue === 0)\r\n        requestAnimationFrame(actualRender);\r\n    renderQueue++;\r\n}\r\n\r\nfunction actualRender() {\r\n    // console.log(\"Saved : \" + (renderQueue - 1) + \" render calls!\");\r\n    renderQueue = 0;\r\n    getCurrentContext().render();\r\n}\r\n\r\nfunction loadImage(imgs, imageNames, index, onFinish) {\r\n    var img = new Image();\r\n    img.onload = function() {\r\n        imgs[imageNames[index]] = img;\r\n        img.dx = 0;\r\n        img.dy = 0;\r\n        img.ratio = img.width / img.height;\r\n        if (index === imageNames.length-1)\r\n            onFinish(imgs);\r\n        else\r\n            loadImage(imgs, imageNames, index+1, onFinish);\r\n    };\r\n    img.src = \"img/items/\" + imageNames[index];\r\n}\r\n","class Renderer {\r\n    constructor(parent, canvas, vw, vh) {\r\n        this.parent = parent;\r\n        this.canvas = canvas;\r\n        this.tintCanvas = document.createElement(\"canvas\");\r\n        this.vw = (vw == undefined ? 1 : vw);\r\n        this.vh = (vh == undefined ? 1 : vh);\r\n\r\n        this.context = this.canvas.getContext(\"2d\");\r\n\r\n        this.tintCanvas.width = 100;\r\n        this.tintCanvas.height = 100;\r\n        this.tintContext = this.tintCanvas.getContext(\"2d\");\r\n    }\r\n    getCamera() {\r\n        return this.parent.camera;\r\n    }\r\n    setCursor(cursor) {\r\n        this.canvas.style.cursor = cursor;\r\n    }\r\n    resize() {\r\n        this.canvas.width = window.innerWidth * this.vw;\r\n        this.canvas.height = window.innerHeight * this.vh;\r\n    }\r\n    clear() {\r\n        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    }\r\n    save() {\r\n        this.context.save();\r\n    }\r\n    restore() {\r\n        this.context.restore();\r\n    }\r\n    translate(v) {\r\n        this.context.translate(v.x, v.y);\r\n    }\r\n    scale(s) {\r\n        this.context.scale(s.x, s.y);\r\n    }\r\n    rotate(a) {\r\n        this.context.rotate(a);\r\n    }\r\n    rect(x, y, w, h, fillStyle, borderStyle, borderSize, alpha) {\r\n        this.save();\r\n        this.setStyles(fillStyle, borderStyle, borderSize, alpha);\r\n        this.context.beginPath();\r\n        this.context.rect(x - w/2, y - h/2, w, h);\r\n        this.context.fill();\r\n        if (borderSize > 0 || borderSize == undefined)\r\n            this.context.stroke();\r\n        this.context.closePath();\r\n        this.restore();\r\n    }\r\n    circle(x, y, r, fillStyle, borderStyle, borderSize, alpha) {\r\n        this.save();\r\n        this.setStyles(fillStyle, borderStyle, borderSize, alpha);\r\n        this.context.beginPath();\r\n        this.context.arc(x, y, r, 0, 2*Math.PI);\r\n        if (fillStyle != undefined)\r\n            this.context.fill();\r\n        if (borderSize > 0 || borderSize == undefined)\r\n            this.context.stroke();\r\n        this.context.closePath();\r\n        this.restore();\r\n    }\r\n    image(img, x, y, w, h, tint) {\r\n        this.context.drawImage(img, x - w/2, y - h/2, w, h);\r\n        if (tint != undefined)\r\n            this.tintImage(img, x, y, w, h, tint);\r\n    }\r\n    tintImage(img, x, y, w, h, tint) {\r\n        this.tintContext.clearRect(0, 0, this.tintCanvas.width, this.tintCanvas.height);\r\n        this.tintContext.fillStyle = tint;\r\n        this.tintContext.fillRect(0, 0, this.tintCanvas.width, this.tintCanvas.height);\r\n        if (browser.name !== \"Firefox\")\r\n            this.tintContext.globalCompositeOperation = \"destination-atop\";\r\n        else\r\n            this.tintContext.globalCompositeOperation = \"source-atop\";\r\n        this.tintContext.drawImage(img, 0, 0, this.tintCanvas.width, this.tintCanvas.height);\r\n\r\n        this.context.globalAlpha = 0.5;\r\n        this.context.drawImage(this.tintCanvas, x - w/2, y - h/2, w, h);\r\n        this.context.globalAlpha = 1.0;\r\n    }\r\n    text(txt, x, y, w, h, textAlign) {\r\n        this.save();\r\n        this.context.font = \"lighter 15px arial\";\r\n        this.context.fillStyle = '#000';\r\n        this.context.textAlign = textAlign;\r\n        this.context.textBaseline = \"middle\";\r\n        this.context.fillText(txt, x, y);\r\n        this.restore();\r\n    }\r\n    getTextWidth(txt) {\r\n        var width = 0;\r\n        this.save();\r\n        this.context.font = \"lighter 15px arial\";\r\n        this.context.fillStyle = '#000';\r\n        this.context.textBaseline = \"middle\";\r\n        width = this.context.measureText(txt).width;\r\n        this.restore();\r\n        return width;\r\n    }\r\n    line(x1, y1, x2, y2, style, size) {\r\n        this.save();\r\n        this.setStyles(undefined, style, size);\r\n        this.context.beginPath();\r\n        this.context.moveTo(x1, y1);\r\n        this.context.lineTo(x2, y2);\r\n        this.context.stroke();\r\n        this.context.closePath();\r\n        this.restore();\r\n    }\r\n    _line(x1, y1, x2, y2) {\r\n        this.context.moveTo(x1, y1);\r\n        this.context.lineTo(x2, y2);\r\n    }\r\n    curve(x1, y1, x2, y2, cx1, cy1, cx2, cy2, style, size) {\r\n        this.save();\r\n        this.setStyles(undefined, style, size);\r\n        this.context.beginPath();\r\n        this.context.moveTo(x1, y1);\r\n        this.context.bezierCurveTo(cx1, cy1, cx2, cy2, x2, y2);\r\n        this.context.stroke();\r\n        this.context.closePath();\r\n        this.restore();\r\n    }\r\n    quadCurve(x1, y1, x2, y2, cx, cy, style, size) {\r\n        this.save();\r\n        this.setStyles(undefined, style, size);\r\n        this.context.beginPath();\r\n        this.context.moveTo(x1, y1);\r\n        this.context.quadraticCurveTo(cx, cy, x2, y2);\r\n        this.context.stroke();\r\n        this.context.closePath();\r\n        this.restore();\r\n    }\r\n    shape(points, fillStyle, borderStyle, borderSize) {\r\n        this.save();\r\n        this.setStyles(fillStyle, borderStyle, borderSize);\r\n        this.context.beginPath();\r\n        this.context.moveTo(points[0].x, points[0].y);\r\n        for (var i = 1; i < points.length; i++)\r\n            this.context.lineTo(points[i].x, points[i].y);\r\n        this.context.lineTo(points[0].x, points[0].y);\r\n        this.context.fill();\r\n        this.context.closePath();\r\n        if (borderSize > 0)\r\n            this.context.stroke();\r\n        this.restore();\r\n    }\r\n    setStyles(fillStyle, borderStyle, borderSize, alpha) {\r\n        if (alpha != undefined && alpha !== this.context.globalAlpha)\r\n            this.context.globalAlpha = alpha;\r\n\r\n        fillStyle = (fillStyle == undefined) ? ('#ffffff') : (fillStyle);\r\n        if (fillStyle != undefined && fillStyle !== this.context.fillStyle)\r\n            this.context.fillStyle = fillStyle;\r\n\r\n        borderStyle = (borderStyle == undefined) ? ('#000000') : (borderStyle);\r\n        if (borderStyle != undefined && borderStyle !== this.context.strokeStyle)\r\n            this.context.strokeStyle = borderStyle;\r\n\r\n        borderSize = (borderSize == undefined) ? (2) : (borderSize);\r\n        if (borderSize != undefined && borderSize !== this.context.lineWidth)\r\n            this.context.lineWidth = borderSize;\r\n    }\r\n}\r\n"]}